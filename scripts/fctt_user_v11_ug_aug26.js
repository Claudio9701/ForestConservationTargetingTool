function registerEvents(a){a.events.register("loadstart",a,function(){app.mapPanel.body.dom.style.cursor="wait",imgWait.style.visibility="visible"}),a.events.register("loadend",a,function(){app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden"})}function updateStyling(){0==Ext.getCmp("colorAttribute").getSelectionModel().selections.items.length&&Ext.getCmp("colorAttribute").getSelectionModel().selectRow(0);var a=Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name,b=1;"risk"==a&&(b=100);var e='<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>'+dataSourceLayerName+"</sld:Name><sld:UserStyle><sld:FeatureTypeStyle>",f='<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>'+workspaceName+":dummyDataLayerForWMSLegend</sld:Name><sld:UserStyle><sld:Title>"+workspaceName+":dummyDataLayerForWMSLegend</sld:Title><sld:FeatureTypeStyle>",g="<ogc:Filter><ogc:Not><ogc:PropertyIsNull><ogc:PropertyName>"+a+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Not></ogc:Filter>";if(1==Ext.getCmp("methodCombo").selectedIndex&colorSchemeOn&fillOn){Ext.getCmp("numQuantiles").setValue(parseInt(Ext.getCmp("numQuantiles").getValue())),Ext.getCmp("numQuantiles").getValue()>0||Ext.getCmp("numQuantiles").setValue("10");var h=parseInt(Ext.getCmp("numQuantiles").getValue());updateDataLayerParams();for(var i=[],j=1;h>j;j++){if(userLayerActive)var k="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getQuantile_userdata",l="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var k="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getQuantile",l="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";dataSource:"+dataSourceName;updateDataLayerParams();var m=k+"&viewparams="+l+";"+theViewParams+";percentage:"+j/h,n=new XMLHttpRequest;if(n.open("POST","../../geoserver/"+workspaceName+"/ows",!1),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(m),byTagNS(n.responseXML,"value",workspaceName))i.push(Number(byTagNS(n.responseXML,"value",workspaceName)));else{var m=k+"&viewparams="+l+";percentage:"+j/h;n.open("POST","../../geoserver/"+workspaceName+"/ows",!1),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(m),1==curLanguage&&Ext.Msg.alert("Warning","Due to a problem communicating with the server, the quantiles used may not precisely reflect the quantiles of "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+" for your exact region of interest."),2==curLanguage&&Ext.Msg.alert("Aviso","Debido a un problema de comunicaci\xf3n con el servidor, los cuantiles utilizados pueden no reflejar con precisi\xf3n los cuantiles de "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+" para su regi\xf3n exacta de inter\xe9s."),byTagNS(n.responseXML,"value",workspaceName)?i.push(Number(byTagNS(n.responseXML,"value",workspaceName))):i.push(0)}}e+="<sld:Rule><Title>Below "+cleanUpIfNumber(i[0])+"</Title>"+g+"<ogc:Filter><ogc:PropertyIsLessThan><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+i[0]+'</ogc:Literal></ogc:PropertyIsLessThan></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&(f+="<sld:Rule><Title>Below "+cleanUpIfNumber(i[0]*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),2==curLanguage&&(f+="<sld:Rule><Title>Menos de "+cleanUpIfNumber(i[0]*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(e+="<sld:Stroke/>",f+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>",f+="</PolygonSymbolizer></sld:Rule>";for(var j=1;h-1>j;j++)e+="<sld:Rule><Title>["+cleanUpIfNumber(i[j-1]*b)+", "+cleanUpIfNumber(i[j]*b)+"]"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</Title>"+g,f+="<sld:Rule><Title>["+cleanUpIfNumber(i[j-1]*b)+", "+cleanUpIfNumber(i[j]*b)+"]"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</Title>",e+="<ogc:Filter><ogc:And><ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+i[j-1]+"</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo>",e+="<ogc:PropertyIsLessThan><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+i[j]+"</ogc:Literal></ogc:PropertyIsLessThan></ogc:And></ogc:Filter>",e+='<PolygonSymbolizer><Fill><CssParameter name="fill">'+mixLowAndHighColors(j/(h-1))+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',f+='<PolygonSymbolizer><Fill><CssParameter name="fill">'+mixLowAndHighColors(j/(h-1))+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(e+="<sld:Stroke/>",f+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>",f+="</PolygonSymbolizer></sld:Rule>";e+="<sld:Rule><Title>At least "+cleanUpIfNumber(i[h-2])+"</Title>"+g+"<ogc:Filter><ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+i[h-2]+'</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&(f+="<sld:Rule><Title>Above "+cleanUpIfNumber(i[h-2]*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),2==curLanguage&&(f+="<sld:Rule><Title>Mas de "+cleanUpIfNumber(i[h-2]*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(e+="<sld:Stroke/>",f+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>",f+="</PolygonSymbolizer></sld:Rule>"}if(Ext.getCmp("methodCombo").selectedIndex<1&colorSchemeOn&fillOn){if(userLayerActive)var k="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_userdata",l="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var k="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere",l="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";dataSource:"+dataSourceName;updateDataLayerParams();var m=k+"&viewparams="+l+";"+theViewParams,n=new XMLHttpRequest;if(n.open("POST","../../geoserver/"+workspaceName+"/ows",!1),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(m),byTagNS(n.responseXML,"max",workspaceName))minVal=Number(byTagNS(n.responseXML,"min",workspaceName)),avgVal=Number(byTagNS(n.responseXML,"avg",workspaceName)),maxVal=Number(byTagNS(n.responseXML,"max",workspaceName));else{var m=k+"&viewparams="+l;n.open("POST","../../geoserver/"+workspaceName+"/ows",!1),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(m),1==curLanguage&&Ext.Msg.alert("Warning","Due to a problem communicating with the server, the high and low values displayed in the legend may not reflect the maximum and minimum values for your exact region of interest."),2==curLanguage&&Ext.Msg.alert("Aviso","Debido a un problema de comunicaci\xf3n con el servidor, los valores altos y bajos que se muestran en la leyenda no siempre son representativas de los valores m\xe1ximo y m\xednimo para su regi\xf3n de inter\xe9s exacta."),byTagNS(n.responseXML,"max",workspaceName)?(minVal=Number(byTagNS(n.responseXML,"min",workspaceName)),avgVal=Number(byTagNS(n.responseXML,"avg",workspaceName)),maxVal=Number(byTagNS(n.responseXML,"max",workspaceName))):(minVal=0,avgVal=.5,maxVal=1)}e+="<sld:Rule>"+g+'<PolygonSymbolizer><Fill><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill"><ogc:Function name="Interpolate"><ogc:PropertyName>'+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+"</ogc:PropertyName>",e+="<ogc:Literal>"+minVal+"</ogc:Literal><ogc:Literal>#"+lowColor+"</ogc:Literal>",e+="<ogc:Literal>"+avgVal+"</ogc:Literal><ogc:Literal>"+mixLowAndHighColors(.5)+"</ogc:Literal>",e+="<ogc:Literal>"+maxVal+"</ogc:Literal><ogc:Literal>#"+highColor+"</ogc:Literal>",e+="<ogc:Literal>color</ogc:Literal><ogc:Literal>cubic</ogc:Literal></ogc:Function>",1==curLanguage&&(f+="<sld:Rule><sld:Title>Low Value: "+cleanUpIfNumber(minVal*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(f+="<sld:Rule><sld:Title>Valor Bajo: "+cleanUpIfNumber(minVal*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),fillOn&&(f+='<Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(f+="<sld:Stroke/>"),f+="</PolygonSymbolizer></sld:Rule>",1==curLanguage&&(f+="<sld:Rule><sld:Title>Middle Value: "+cleanUpIfNumber(avgVal*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(f+="<sld:Rule><sld:Title>Valor Medio: "+cleanUpIfNumber(avgVal*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),fillOn&&(f+='<Fill><CssParameter name="fill">'+mixLowAndHighColors(.5)+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(f+="<sld:Stroke/>"),f+="</PolygonSymbolizer></sld:Rule>",1==curLanguage&&(f+="<sld:Rule><sld:Title>High Value: "+cleanUpIfNumber(maxVal*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(f+="<sld:Rule><sld:Title>Valor Alto: "+cleanUpIfNumber(maxVal*b)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),fillOn&&(f+='<Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(f+="<sld:Stroke/>"),f+="</PolygonSymbolizer></sld:Rule>",e+='</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(e+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>"}Ext.getCmp("chkNull").checked&&(e+="<sld:Rule><sld:Title>Conservation ROI Layer (null values)</sld:Title><ogc:Filter><ogc:PropertyIsNull><ogc:PropertyName>"+a+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Filter><PolygonSymbolizer>",1==curLanguage&&(f+="<sld:Rule><sld:Title>Null Values </sld:Title><PolygonSymbolizer>"),2==curLanguage&&(f+="<sld:Rule><sld:Title>Valores Nulos </sld:Title><PolygonSymbolizer>"),fillOn&&(e+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',f+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(e+="<sld:Stroke/>",f+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>",f+="</PolygonSymbolizer></sld:Rule>"),!colorSchemeOn|!fillOn&&(e+="<sld:Rule><sld:Title>Conservation ROI Layer</sld:Title><PolygonSymbolizer>",1==curLanguage&&(f+="<sld:Rule><sld:Title>Data Layer</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(f+="<sld:Rule><sld:Title>Capa de Datos</sld:Title><PolygonSymbolizer>"),fillOn&&(e+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',f+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(e+="<sld:Stroke/>",f+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>",f+="</PolygonSymbolizer></sld:Rule>"),e+="</sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>",updateDataLayerParams(),dataLayer.mergeNewParams({sld_body:e});var o=Ext.getCmp("datasource").getRawValue()+" Layer";2==curLanguage&&(o="Capa de "+Ext.getCmp("datasource").getRawValue()),colorSchemeOn&&fillOn||colorSchemeLegendLayer.setName(o),colorSchemeOn&&1==curLanguage&&colorSchemeLegendLayer.setName(Ext.getCmp("datasource").getRawValue()+" Layer Colored By: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName),colorSchemeOn&&2==curLanguage&&colorSchemeLegendLayer.setName(Ext.getCmp("datasource").getRawValue()+" Capa Matizada por: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName),f+="</sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>",colorSchemeLegendLayer.mergeNewParams({sld_body:f}),colorSchemeLegendLayer.setVisibility(!0),hansenLegendLayer.setVisibility(ghan.getVisibility()),1==ghan.getVisibility()&&(1==curLanguage&&(hansenLegendLayer.setName("Basemap: Forest Change 2000-2012"),hansenLegendLayer.mergeNewParams({styles:"hansenLegend"})),2==curLanguage&&(hansenLegendLayer.setName("Basemap: Cambio Forestal 2000-2012"),hansenLegendLayer.mergeNewParams({styles:"hansenLegend_span"})),hansenLegendLayer.setVisibility(!0))}function checkMedian(a){if(userLayerActive)var b="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_userdata",c="theAttribute:"+a+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var b="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere",c="theAttribute:"+a+";dataSource:"+dataSourceName;updateDataLayerParams();var d=b+"&viewparams="+c+";"+theViewParams,e=new XMLHttpRequest;if(e.open("POST","../../geoserver/"+workspaceName+"/ows",!1),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(d),byTagNS(e.responseXML,"median",workspaceName))return medianVal=Number(byTagNS(e.responseXML,"median",workspaceName)),medianVal;var d=b+"&viewparams="+c;return e.open("POST","../../geoserver/"+workspaceName+"/ows",!1),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(d),byTagNS(e.responseXML,"median",workspaceName)?(medianVal=Number(byTagNS(e.responseXML,"median",workspaceName)),medianVal):(1==curLanguage&&alert("Warning: median value for the benefit variable "+a+" could not be determined. All values may be null."),2==curLanguage&&alert("Advertencia: el valore de mediana para la variable de "+a+" no se pudo determinar . Todos los valores pueden ser nulo."),1)}function updatePrioritization(){var a=prioritizationLayer.getVisibility();if(a){Ext.getCmp("chkMean").getValue()||(0==checkMedian("carbon")||0==checkMedian("bio")||0==checkMedian("hydro"))&&(1==curLanguage&&alert("Error: within your study area, the median value of one or more of the benefit variables (carbon, biodiversity, and hydrological services) is zero. This means that prioritization cannot proceed (see Instructions for more details). Please change your region of interest, update your data, or choose 'mean' as the method of normalizing benefits. However, using the mean to normalize benefits requires caution due to the mean's sensitivity to outliers."),2==curLanguage&&alert("Error: dentro de su \xe1rea de estudio , el valor medio de una o m\xe1s de las variables de previsi\xf3n (de carbono , la biodiversidad , y servicios hidrol\xf3gicos) es cero . Esto significa que el establecimiento de prioridades no puede proceder (consulte Instrucciones para m\xe1s detalles). Por favor, cambiar su regi\xf3n de inter\xe9s , actualizar sus datos , o elegir 'promedio' como el m\xe9todo de los beneficios de la normalizaci\xf3n . Sin embargo, utilizando la media para normalizar beneficios requiere precauci\xf3n debido a la sensibilidad de la media de los valores at\xedpicos."),a=!1),prioritizationLayer.setVisibility(!1);var b="data_prioritize";if(userLayerActive&&(b+="_userdata"),priorityParams="dataSource:"+dataSourceName,userLayerActive&&(priorityParams+=";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName),(userLayerActive||1==dataSourceNum||2==dataSourceNum)&&(priorityParams+=";predAcessCode:519"),priorityParams+=";geomZero:519",priorityParams+=";locationParam:"+locationParamName+";budgetMax:",Ext.getCmp("rawRadio").getValue()?priorityParams+=Ext.getCmp("budget_raw").value:priorityParams+=Ext.getCmp("budget_percentage").value/100+"*(SELECT MAX(cumcost) FROM BenefitBudget)",priorityParams+=";"+whereClauseStr+";"+inClauseStr+";forestThreshold:"+forestThreshold,Ext.getCmp("chkRisk").getValue()?priorityParams+=";riskVar:risk":priorityParams+=";riskVar:1",Ext.getCmp("chkCost").getValue()?priorityParams+=";costVar:cost":priorityParams+=";costVar:1",Ext.getCmp("chkArea").getValue()?priorityParams+=";areaWeight:forarea*ST_Area(geom)":priorityParams+=";areaWeight:1",Ext.getCmp("chkMean").getValue()?priorityParams+=";medianOrMean:avg":priorityParams+=";medianOrMean:median",3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(priorityParams+=";carbonVar:"+Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field1+";bioVar:"+Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field1),"compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id)-1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(Ext.getCmp("compareObjectiveCombo").selectedIndex=0),0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CBH"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CBH_span"})),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CB"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CB_span"})),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CH"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CH_span"})),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_BH"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_BH_span"}));else{"combineTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id&&(priorityParams+=";weight1:"+Ext.getCmp("weight1").value,priorityParams+=";weight2:"+Ext.getCmp("weight2").value,priorityParams+=";weight3:"+Ext.getCmp("weight3").value);var c="";userLayerActive&&(c="_userdata"),1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_Default"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_Default_span"})}1==curLanguage&&prioritizationLayer.setName("Targeting:"),2==curLanguage&&prioritizationLayer.setName("Focalizaci\xf3n:"),prioritizationLayer.mergeNewParams({layers:b,viewparams:priorityParams}),0==app.mapPanel.map.getLayersByName("Prioritization Layer").length&&1==a&&(app.mapPanel.map.getLayersByName("Selection").length>0&&app.mapPanel.map.removeLayer(selectLayer),app.mapPanel.map.addLayer(prioritizationLayer),app.mapPanel.map.addLayer(selectLayer))}prioritizationLayer.setVisibility(a),prioritizationLayer.redraw(),dataLayer.redraw(),updateStyling()}function setDataSource(a){idAttribute="fctt_id",1==a&&(dataSourceName="mredd",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="nom_na",locationData=[[0,"Study Area"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoac\xe1n/Mexico"],[5,"Yucut\xe1n"],[6,"Chihuahua"]],spanishLocationData=[[0,"Zona de AATRs"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoac\xe1n/Mexico"],[5,"Yucut\xe1n"],[6,"Chihuahua"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide()),2==a&&(dataSourceName="mex_pred",userLayerActive=!1,locationParamName="region",nameAttribute="nombpred",userLayerActive=!1,locationData=[[0,"Entire Country"],[1,"North West"],[2,"North"],[3,"North East"],[4,"Central West"],[5,"Central South"],[6,"South Pacific"],[7,"Gulf"],[8,"Peninsula"]],spanishLocationData=[[0,"Pa\xeds \xcdntegro"],[1,"Noroeste"],[2,"Norte"],[3,"Nordeste"],[4,"Centro-Oeste"],[5,"Centro Sur"],[6,"Pacifico Sur"],[7,"Golfo"],[8,"Pen\xednsula"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide()),3==a&&(dataSourceName="ca_10km",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xedses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show()),4==a&&(dataSourceName="ca_1km",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xedses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show()),5==a&&(dataSourceName="ca_adm",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xedses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show()),a>5&&(dataSourceName=phpVarDataSetList[a-numOnBoardDataSets],userDataSourceUOA=phpVarDataSetUOA[a-numOnBoardDataSets],userLayerActive=!0,locationParamName="1",nameAttribute="",Ext.getCmp("adminSelect").hide(),locationData=[[0,"All"]],spanishLocationData=[[0,"Todos"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide()),userLayerActive?(dataSourceLayerName=workspaceName+":userlayer_query",2==selectMode&&(1==curLanguage&&Ext.Msg.alert("","Unfortunately, the Box/Manual Select Tool can not be used with user-defined layers at this time. Note that you can create an arbitrary region of interest for user-defined layers by restricting your shapefile to the fctt_id you are interested in before uploading the data in the User Console"),2==curLanguage&&Ext.Msg.alert("","Desafortunadamente, la Herramienta Caja/Selecci\xf3n Manual no se puede utilizar con capas definidas por el usuario en este momento. Tenga en cuenta que puede crear una regi\xf3n arbitraria de inter\xe9s para las capas definidas por el usuario mediante la restricci\xf3n de su archivo de formas a la fctt_id le interesa antes de cargar los datos en la consola de usuario."),Ext.getCmp("selectsubmitselection").disable())):dataSourceLayerName=workspaceName+":"+dataSourceName+"_query",1==curLanguage&&Ext.getCmp("regionSelectCombo").bindStore(locationData),2==curLanguage&&Ext.getCmp("regionSelectCombo").bindStore(spanishLocationData)}function updateLanguage(){if(0==phpVarIsLoggedIn&&Ext.getCmp("loginRegisterWindowBox").refreshMe("../../usersystem/splashscreen.php?lang="+curLanguage),1==phpVarIsLoggedIn&&0==Ext.getCmp("returnToFCTTItem").hidden&&(app.mapPanel.map.div.innerHTML="<iframe src='../../usersystem/userconsole.php?lang="+curLanguage+"' width = 100% height = 100%></iframe>"),1==curLanguage){Ext.getCmp("appCopyright").setText("\xa9 2014 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission."),Ext.getCmp("howToItem").setText("How To"),Ext.getCmp("instructionsItem").setText("Instructions"),Ext.getCmp("descriptionItem").setText("Description"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("User Questions"),Ext.getCmp("emailItem").setText("Email"),Ext.getCmp("aboutItem").setText("About"),Ext.getCmp("metadataItem").setText("Metadata"),Ext.getCmp("sponsorsItem").setText("Sponsors"),Ext.getCmp("teamItem").setText("Team"),Ext.getCmp("emailItem2").setText("Email"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("User Questions"),Ext.getCmp("userCommentsItem").setText("User Comments"),Ext.getCmp("emailItem3").setText("Email"),1==phpVarIsLoggedIn?Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName):Ext.getCmp("loginItem").setText("Use your own data"),Ext.getCmp("userConsoleItem").setText("User Console"),Ext.getCmp("returnToFCTTItem").setText("Reload FCTT"),Ext.getCmp("logoutItem").setText("Logout"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>"),Ext.getCmp("regionPanel").setTitle("DEFINE STUDY AREA"),Ext.getCmp("datasetLabel").label.update("Dataset:"),loadUserLayers([[5,"Central America Administrative"],[3,"Central America 10km"],[4,"Central America 1km"],[2,"Mexico Predios"],[1,"MREDD AATRs"]]),Ext.getCmp("regionLabel").label.update("Region:"),Ext.getCmp("regionSelectCombo").bindStore(locationData),Ext.getCmp("regionSelectCombo").setValue(Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field2),Ext.getCmp("thresholdLabel").label.update("Minimum forest cover:"),Ext.getCmp("adminSelect").setTitle("By administrative boundary"),Ext.getCmp("manuallySelect").setTitle("Using manual selection tool"),Ext.getCmp("selectionMode").label.update("Selection mode:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Polygon"],[2,"Box"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("DISPLAY OPTIONS"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),Ext.getCmp("shpLinesLabel").label.update("Shape lines"),Ext.getCmp("shpFillLabel").label.update("Shape fill"),Ext.getCmp("opacityLabel").label.update("Opacity"),Ext.getCmp("margLayerLabel").label.update("Marginality Layer"),Ext.getCmp("basemapLabel").label.update("Base map type"),Ext.getCmp("basemapCombo").bindStore([[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satellite"],[4,"OpenStreetMap"],[5,"Forest Change(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Show Scale"),Ext.getCmp("panZoomLabel").label.update("Pan/Zoom Tool"),Ext.getCmp("mouseWheelLabel").label.update("Mouse wheel zoom"),Ext.getCmp("colorByAttributePanel").setTitle("TARGETING DATA"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Low color</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">High color</div>'),Ext.getCmp("methodLabel").label.update("Method"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolate"],[1,"Quantiles"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Quantiles");var a=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();Ext.getCmp("colorAttribute").store=prioritizationVariables,3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(a),Ext.getCmp("chkNullLabel").label.update("Show null values"),Ext.getCmp("chkNull").wrap.child(".x-form-cb-label").update("(in default color)"),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("selectPanel").setTitle("TARGET"),Ext.getCmp("chooseBenefits").setTitle("Choose Benefit Variables"),Ext.getCmp("carbonBenefitLabel").label.update("Carbon:"),Ext.getCmp("bioBenefitLabel").label.update("Biodiversity:"),Ext.getCmp("carbonBenefitChoose").bindStore([["carbon","Non-soil carbon"],["carbon_total","Total carbon"],["carbon_soil","Carbon in soil"]]),Ext.getCmp("carbonBenefitChoose").setValue(Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field2),Ext.getCmp("bioBenefitChoose").bindStore([["bio","Global RWRI"],["bio_loc","National RWRI"],["bio_count","Threat. species count"]]),
Ext.getCmp("bioBenefitChoose").setValue(Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field2),Ext.getCmp("priorityBudget").setTitle("Choose Budget"),Ext.getCmp("percentageRadio").el.next("label").update('<span style="font-size: 12px;">Percentage of total:</span>'),Ext.getCmp("rawRadio").el.next("label").update('<span style="font-size: 12px;">Raw budget:</span>'),Ext.getCmp("combineTab").setTitle("Weight Benefits"),Ext.getCmp("carbonweightfield").label.update('<div style="color: green; font-weight: bold">Carbon:</div>'),Ext.getCmp("bioweightfield").label.update('<div style="color: red; font-weight: bold">Biodiversity:</div>'),Ext.getCmp("hydroweightfield").label.update('<div style="color: blue; font-weight: bold">Hydrological:</div>'),Ext.getCmp("compareTab").setTitle("Compare"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"All Benefits"],[1,"Carbon and Biodiversity"],[2,"Carbon and Hydro"],[3,"Biodiversity and Hydro"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),Ext.getCmp("chkRiskLabel").label.update("Scale benefits by deforestation risk"),Ext.getCmp("chkCostLabel").label.update("Divide expected benefits by cost"),Ext.getCmp("chkAreaLabel").label.update("Scale total costs by forest area"),Ext.getCmp("chkMeanLabel").label.update("Normalize benefits by mean instead of median"),Ext.getCmp("priorityOpacityLabel").label.update("Opacity:"),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("printButton").setText("<div style='color:black;font-size: 12'>Print/PDF</div>"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>"),Ext.getCmp("resetLegend").setText("Reset Legend Position"),Ext.getCmp("exportPanel").setTitle("EXPORT"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Export Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Export CSV</div>"),"undefined"!=typeof instructionsWindowSp&&(instructionsWindowSp.hidden||(instructionsWindow.show(),instructionsWindowSp.hide())),Ext.getCmp("myLegend").setTitle("Legend"),marginalityLayer.setName("Marginalization Index")}if(2==curLanguage){Ext.getCmp("appCopyright").setText("\xa9 2014 Resources for the Future. Reservados todos los derechos. Ninguna porci\xf3n de los datos o el modelo puede ser usado sin permiso."),Ext.getCmp("howToItem").setText("C\xf3mo"),Ext.getCmp("instructionsItem").setText("Instrucciones"),Ext.getCmp("descriptionItem").setText("Descripci\xf3n"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("Preguntas de Usuarios"),Ext.getCmp("emailItem").setText("Correo"),Ext.getCmp("aboutItem").setText("Acerca de"),Ext.getCmp("metadataItem").setText("Metadatos"),Ext.getCmp("sponsorsItem").setText("Promotores"),Ext.getCmp("teamItem").setText("Equipo"),Ext.getCmp("emailItem2").setText("Correo"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("Preguntas de Usuarios"),Ext.getCmp("userCommentsItem").setText("Comentarios de Usuarios"),Ext.getCmp("emailItem3").setText("Correo"),1==phpVarIsLoggedIn?Ext.getCmp("loginItem").setText("Conectado como "+phpVarUserName):Ext.getCmp("loginItem").setText("Utilice sus propios datos"),Ext.getCmp("userConsoleItem").setText("Consola de Usuario"),Ext.getCmp("returnToFCTTItem").setText("Recargar FCTT"),Ext.getCmp("logoutItem").setText("Cerrar Sesi\xf3n"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Caja de Herramientas</div>"),Ext.getCmp("regionPanel").setTitle("DEFINIR \xc1REA DE ESTUDIO"),Ext.getCmp("datasetLabel").label.update("Datos:"),loadUserLayers([[5,"Centroam\xe9rica Administrativa"],[3,"Centroam\xe9rica 10km"],[4,"Centroam\xe9rica 1km"],[2,"Predios de Mexico"],[1,"MREDD AATRs"]]),Ext.getCmp("regionLabel").label.update("Regi\xf3n:"),Ext.getCmp("regionSelectCombo").bindStore(spanishLocationData),Ext.getCmp("regionSelectCombo").setValue(Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field2),Ext.getCmp("thresholdLabel").label.update("Cubierta forestal m\xednima:"),Ext.getCmp("adminSelect").setTitle("Por l\xedmites administrativos"),Ext.getCmp("manuallySelect").setTitle("Seleccionar manualmente"),Ext.getCmp("selectionMode").label.update("Modo de selecci\xf3n:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Pol\xedgono"],[2,"Caja"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("OPCIONES DE VISUALIZACI\xd3N"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Color de Relleno Defecto</div>'),Ext.getCmp("shpLinesLabel").label.update("L\xedneas poligonales"),Ext.getCmp("shpFillLabel").label.update("Relleno de forma"),Ext.getCmp("opacityLabel").label.update("Opacidad"),Ext.getCmp("priorityOpacityLabel").label.update("Opacidad"),Ext.getCmp("margLayerLabel").label.update("Capa de Marginalidad"),Ext.getCmp("basemapLabel").label.update("Tipo de basemap"),Ext.getCmp("basemapCombo").bindStore([[0,"Ninguno"],[1,"Google F\xedsico"],[2,"Google H\xedbrido"],[3,"Google Sat\xe9lite"],[4,"OpenStreetMap"],[5,"Cambio Forestal(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Mostrar Escala"),Ext.getCmp("panZoomLabel").label.update("Ampliar/Recorrer"),Ext.getCmp("mouseWheelLabel").label.update("Zoom con rueda del mouse"),Ext.getCmp("colorByAttributePanel").setTitle("DATOS DE FOCALIZACI\xd3N"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("methodLabel").label.update("M\xe9todo"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolar"],[1,"Cuantilas"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Cuantilas");var a=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish,3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(a),Ext.getCmp("chkNullLabel").label.update("Mostrar val. nulos"),Ext.getCmp("chkNull").wrap.child(".x-form-cb-label").update("(en color defecto)"),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Actualizar Visualizaci\xf3n</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("selectPanel").setTitle("FOCALIZAR"),Ext.getCmp("chooseBenefits").setTitle("Elegir Variables de Beneficios"),Ext.getCmp("carbonBenefitLabel").label.update("Carbono:"),Ext.getCmp("bioBenefitLabel").label.update("Biodiversidad:"),Ext.getCmp("carbonBenefitChoose").bindStore([["carbon","Carbono no suelo"],["carbon_total","Carbono total"],["carbon_soil","Carbono en el suelo"]]),Ext.getCmp("carbonBenefitChoose").setValue(Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field2),Ext.getCmp("bioBenefitChoose").bindStore([["bio","RWRI Global"],["bio_loc","RWRI Nacional"],["bio_count","N\xfam. esp. amenazadas"]]),Ext.getCmp("bioBenefitChoose").setValue(Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field2),Ext.getCmp("priorityBudget").setTitle("Elegir Presupuesto"),Ext.getCmp("percentageRadio").el.next("label").update('<span style="font-size: 12px;">Porcentaje del total:</span>'),Ext.getCmp("rawRadio").el.next("label").update('<span style="font-size: 12px;">Prima:</span>'),Ext.getCmp("combineTab").setTitle("Ponderar Beneficios"),Ext.getCmp("carbonweightfield").label.update('<div style="color: green; font-weight: bold">Carbono:</div>'),Ext.getCmp("bioweightfield").label.update('<div style="color: red; font-weight: bold">Biodiversidad:</div>'),Ext.getCmp("hydroweightfield").label.update('<div style="color: blue; font-weight: bold">Hidrol\xf3gico:</div>'),Ext.getCmp("compareTab").setTitle("Comparar"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"Todos Beneficios"],[1,"Carbono y Biodiversidad"],[2,"Carbon y Hidrol\xf3gico"],[3,"Biodiversidad y Hidrol\xf3gico"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("chkRiskLabel").label.update("Escalar lost beneficios por riesgo"),Ext.getCmp("chkCostLabel").label.update("Divida a los beneficios esperados por el costo"),Ext.getCmp("chkAreaLabel").label.update("Escalar los costos totales del \xe1rea de bosque"),Ext.getCmp("chkMeanLabel").label.update("Normalizar beneficios por la media en lugar de la mediana"),Ext.getCmp("priorityOpacityLabel").label.update("Opacidad:"),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Entregar/Actualizar</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("printButton").setText("<div style='color:black;font-size: 12'>Imprimir/PDF</div>"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Restablecer Todo</div>"),Ext.getCmp("resetLegend").setText("Restablecer Leyenda"),Ext.getCmp("exportPanel").setTitle("EXPORTAR"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Exportar Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Exportar CSV</div>"),"undefined"!=typeof instructionsWindow&&(instructionsWindow.hidden||(instructionsWindow.hide(),instructionsWindowSp.show())),Ext.getCmp("myLegend").setTitle("Leyenda"),marginalityLayer.setName("\xcdndice de Marginaci\xf3n")}resetLegendPosition(),updateStyling(),updatePrioritization(),updateOnZoom(app.mapPanel.map.getZoom())}function updateSelectionButtonLanguage(){1==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selecci\xf3n</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),"<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Clear/Cancel</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>")),2==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selecci\xf3n</div>"),"<div style='color:black;font-size: 12'>Clear/Cancel</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"))}function componentToHex(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function hexToRgb(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}function mixLowAndHighColors(a){var b=Math.floor(a*hexToRgb(highColor).r+(1-a)*hexToRgb(lowColor).r),c=Math.floor(a*hexToRgb(highColor).g+(1-a)*hexToRgb(lowColor).g),d=Math.floor(a*hexToRgb(highColor).b+(1-a)*hexToRgb(lowColor).b);return rgbToHex(b,c,d)}function openPage(a,b){new Ext.Window({title:b,width:.8*window.innerWidth,height:.9*window.innerHeight,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:a}}]}).show()}function zoomToRegion(){var a=new OpenLayers.Bounds;if(userLayerActive)var b="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents_userdata",c="layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var b="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents",c="dataSource:"+dataSourceName;updateDataLayerParams();var d=b+"&viewparams="+c+";"+theViewParams,e=new XMLHttpRequest;e.open("POST","../../geoserver/"+workspaceName+"/ows",!1),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(d),byTagNS(e.responseXML,"xmin",workspaceName)?(a.left=Number(byTagNS(e.responseXML,"xmin",workspaceName)),a.right=Number(byTagNS(e.responseXML,"xmax",workspaceName)),a.top=Number(byTagNS(e.responseXML,"ymin",workspaceName)),a.bottom=Number(byTagNS(e.responseXML,"ymax",workspaceName))):(a.left=-92.2223587033315,a.right=-68.3226394649928,a.top=5.49902677495186,a.bottom=19.9323616027744),a=a.scale(1.2),app.mapPanel.map.zoomToExtent(a.transform("EPSG:4326","EPSG:900913"),!1)}function resetLegendPosition(){myLegend.show();var a=app.mapPanel.el.getTop()+5;myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,a]),1==curLanguage&&(window.innerWidth<1200?(Ext.getCmp("appTitle").setText("Forest Conservation Targeting Tool (Beta)"),Ext.getCmp("appTitle").setWidth(window.innerWidth-700),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-700)):(Ext.getCmp("appTitle").setText("Forest Conservation Targeting Tool (Beta)"),Ext.getCmp("appTitle").setWidth(window.innerWidth-700),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-700))),2==curLanguage&&(window.innerWidth<1200?(Ext.getCmp("appTitle").setText("Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal (Beta)"),Ext.getCmp("appTitle").setWidth(window.innerWidth-700),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-700)):(Ext.getCmp("appTitle").setText("Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal (Beta)"),Ext.getCmp("appTitle").setWidth(window.innerWidth-700),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-700)))}function updateOnZoom(a){8>a&&4==dataSourceNum&&(1==curLanguage&&(imgZoomEng.style.visibility="visible",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="visible"),dataLayer.setVisibility(!1)),(a>=8||4!=dataSourceNum)&&(1==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),dataLayer.setVisibility(!0)),a>13&&1==ghan.getVisibility()&&(ghan.setVisibility(!1),ghanActive=!0),13>=a&&1==ghanActive&&ghan.setVisibility(!0),a>18&&1==gosm.getVisibility()&&(gosm.setVisibility(!1),gosmActive=!0),18>=a&&1==gosmActive&&gosm.setVisibility(!0)}function updateDataLayerParams(){theViewParams=inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold,userLayerActive&&(theViewParams+=";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName),(userLayerActive||1==dataSourceNum||2==dataSourceNum)&&(theViewParams+=";predAcessCode:519"),dataLayer.mergeNewParams({layers:dataSourceLayerName,viewparams:theViewParams})}function loadUserLayers(a){if(1==phpVarIsLoggedIn){phpVarNumDataSets>0&&a.push([-1,"----------------------"]);for(var b=1;b<=phpVarNumDataSets;b++){var c=b+numOnBoardDataSets;a.push([c.toString(),phpVarDataSetList[b]])}}Ext.getCmp("datasource").bindStore(a),Ext.getCmp("datasource").setValue(Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field2)}function featuresFromXY(a){var b=app.mapPanel.map.getLonLatFromPixel(a);b.transform("EPSG:900913","EPSG:4326");var c={method:"GET",async:!1};userLayerActive?c.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_userdata&viewparams=layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName+";predAcessCode:519":3==dataSourceNum||4==dataSourceNum||5==dataSourceNum?c.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_ca&viewparams=dataSource:"+dataSourceName.replace("ca_",""):c.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_mex&viewparams=layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName+";predAcessCode:519",c.url+=";latCoord:"+b.lat+";lonCoord:"+b.lon;var d=OpenLayers.Request.issue(c),e=new OpenLayers.Format.GML({extractAttributes:!0}),f=e.read(d.responseText);return f}function byTagNS(a,b,c){return gottenElement=a.getElementsByTagName(c+":"+b)[0],gottenElement&&null!=gottenElement&&0!=gottenElement.length||(gottenElement=a.getElementsByTagName(b)[0]),gottenElement&&null!=gottenElement&&0!=gottenElement.length?gottenElement.textContent:!1}function cleanUpIfNumber(a){return isNaN(a)?String(a):Number(a)>999999?String(Number(a).toExponential(3)):0==Number(a).toFixed(3)?String(Number(a).toExponential(3)):Number.isInteger(Number(a))?String(Number(a)):String(Number(a).toFixed(3))}if("undefined"==typeof phpVarUserName)var phpVarUserName="notloggedin",phpVarlayerPIN="notloggedin";Ext.BLANK_IMAGE_URL="ext/resources/images/default/s.gif";var app,items=[],controls=[],toolItems=[],lowColor="0000FF",highColor="FF0000",defaultColor="003300",selectedFillColor="e2ff00",linesOn=!1,fillOn=!0,colorSchemeOn=!1,navigationMode=!0,tilesLeftToLoad=1,inClauseStr="idAttribute:1;inSet:1";whereClauseStr="whereParam:1;whereValue:1",priorityParams="",prioritizationOn=!1,theViewParams="",selectMode=1,ghanActive=!1,gosmActive=!1,forestThreshold=25;var minVal=0,avgVal=.5,maxVal=1,curLanguage=2,userLayerActive=!1,locationParamName,nameAttribute,locationData,spanishLocationData,idAttribute,workspaceName="forestro_users_ws",dataSourceName="ca_adm",dataSourceLayerName="ca_adm_query",userDataSourceUOA="",topBarHeight=40,imgWait=document.createElement("IMG");imgWait.src="images/loading.gif",imgWait.style.pointerEvents="none",imgWait.style.position="absolute",imgWait.style.top=225,imgWait.style.left=450,imgWait.style.zIndex=9999,imgWait.style.visibility="hidden";var imgZoomEng=document.createElement("IMG");imgZoomEng.src="images/zoomin_english.gif",imgZoomEng.style.pointerEvents="none",imgZoomEng.style.position="absolute",imgZoomEng.style.top=225,imgZoomEng.style.left=450,imgZoomEng.style.zIndex=9998,imgZoomEng.style.visibility="hidden";var imgZoomSpan=document.createElement("IMG");imgZoomSpan.src="images/zoomin_spanish.gif",imgZoomSpan.style.pointerEvents="none",imgZoomSpan.style.position="absolute",imgZoomSpan.style.top=225,imgZoomSpan.style.left=450,imgZoomSpan.style.zIndex=9998,imgZoomSpan.style.visibility="hidden";var numOnBoardDataSets=5,dataSourceNum=5,isIE=!!document.documentMode,instructionsWindow=new Ext.Window({title:"Instructions",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define.html"}}],listeners:{minimize:{fn:function(){instructionsWindow.hide()}}}}),instructionsWindowSp=new Ext.Window({title:"Instrucciones",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define_sp.html"}}],listeners:{minimize:{fn:function(){instructionsWindowSp.hide()}}}}),loginRegisterWindow=new Ext.Window({width:.8*(window.innerWidth-0),height:.85*(window.innerHeight-topBarHeight),x:.1*(window.innerWidth-0)+0,y:.1*(window.innerHeight-topBarHeight)+topBarHeight,resizable:!1,draggable:!0,closable:!1,minimizable:!1,anchor:!0,frame:!1,shadow:!1,border:!0,bodyStyle:"opacity:1;",layout:"vbox",listeners:{minimize:function(){loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable()}},tools:[{id:"bigminimize",qtip:"Minimize",handler:function(a,b,c){loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable()}}],items:[{xtype:"box",id:"loginRegisterWindowBox",width:.8*(window.innerWidth-0),height:.85*(window.innerHeight-topBarHeight),margin:10,autoEl:{tag:"iframe",frameborder:0,src:"../../usersystem/splashscreen.php?lang="+curLanguage},refreshMe:function(a){var b;(b=this.el)&&(b.dom.src=a||this.imageSrc)},listeners:{render:function(){this.refreshMe()}}}]});Ext.onReady(function(){if(app=new Ext.Viewport({layout:"border",id:"app",border:0,items:[topbar,toolpanel,map,bottombar]}),setDataSource(dataSourceNum),Ext.getCmp("optionsPanel").collapse(),Ext.getCmp("colorByAttributePanel").collapse(),Ext.getCmp("selectPanel").collapse(),myLegend.show(),myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,app.mapPanel.el.getTop()+5]),Ext.getCmp("regionSelectCombo").setValue(0),Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("datasource").selectedIndex=0,Ext.getCmp("selectModeCombo").selectedIndex=0,Ext.getCmp("basemapCombo").selectedIndex=1,Ext.getCmp("methodCombo").selectedIndex=0,Ext.getCmp("compareObjectiveCombo").selectedIndex=0,Ext.getCmp("carbonBenefitChoose").selectedIndex=0,Ext.getCmp("bioBenefitChoose").selectedIndex=0,Ext.getCmp("topBar").getEl().dom.style.background="#4682B4",phpVarIsLocalHost){var a={method:"GET",async:!1};a.url="../../geoserver/wms?request=GetCapabilities",a.user="registereduser",a.password=phpVarGeoServerLogin;OpenLayers.Request.issue(a);a.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents&viewparams=dataSource:"+dataSourceName,a.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold;OpenLayers.Request.issue(a)}curLanguage=phpVarLanguageToLoadIn,updateLanguage(),1==curLanguage&&Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName),2==curLanguage&&Ext.getCmp("loginItem").setText("Conectado como "+phpVarUserName),Ext.getCmp("loginItem").show(),Ext.getCmp("returnToFCTTItem").hide(),Ext.getCmp("userConsoleItem").show(),Ext.getCmp("logoutItem").show(),Ext.getCmp("loginItem").getEl().removeClass("hidearrow"),app.mapPanel.map.addLayer(hansenLegendLayer),app.mapPanel.map.addLayer(colorSchemeLegendLayer),app.mapPanel.map.addLayer(marginalityLayer),app.mapPanel.map.addLayer(dataLayer),app.mapPanel.map.addLayer(selectLayer),1==phpVarIsLoggedIn||(loginRegisterWindow.show(),loginRegisterWindow.hide(),1==curLanguage&&Ext.getCmp("loginItem").setText("Use your own data"),2==curLanguage&&Ext.getCmp("loginItem").setText("Utilice sus propios datos"),Ext.getCmp("userConsoleItem").hide(),Ext.getCmp("logoutItem").hide(),Ext.getCmp("loginItem").getEl().addClass("hidearrow")),registerEvents(dataLayer),registerEvents(prioritizationLayer),imgWait.style.top=(parseInt(app.mapPanel.body.dom.style.height)-128)/2,imgWait.style.left=(parseInt(app.mapPanel.body.dom.style.width)-128)/2,document.getElementById("map").appendChild(imgWait),imgZoomEng.style.top=50,imgZoomEng.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomEng),imgZoomSpan.style.top=50,imgZoomSpan.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomSpan),updateLanguage(),app.mapPanel.map.addControl(infoClick),infoClick.activate(),app.mapPanel.map.addControl(infoHover),infoHover.deactivate(),ghan.setVisibility(!1),ghyb.setVisibility(!1),gsat.setVisibility(!1),gosm.setVisibility(!1),gphy.setVisibility(!0),marginalityLayer.setVisibility(!1),prioritizationLayer.setVisibility(!1),updateStyling(),myLegend.syncShadow()}),Ext.chromeVersion=Ext.isChrome?parseInt(/chrome\/(\d{2})/.exec(navigator.userAgent.toLowerCase())[1],10):NaN,Ext.grid.ColumnModel.override({getTotalWidth:function(a){if(!this.totalWidth){var b=Ext.isChrome&&Ext.chromeVersion>18?2:0;this.totalWidth=0;for(var c=0,d=this.config.length;d>c;c++)(a||!this.isHidden(c))&&(this.totalWidth+=this.getColumnWidth(c)+b)}return this.totalWidth}}),phpVarIsLocalHost&&(printCapabilities.createURL="../../geoserver/pdf/create.json",printCapabilities.printURL="../../geoserver/pdf/print.pdf");var printProvider=new GeoExt.data.PrintProvider({url:"../../geoserver/pdf",user:"registereduser",password:phpVarGeoServerLogin,method:"POST",capabilities:printCapabilities,timeout:1e5,customParams:{mapTitle:"",comment:"www.conservationroi.net",attributionText:""},listeners:{beforeprint:function(){app.mapPanel.body.dom.style.cursor="wait",imgWait.style.visibility="visible"},print:function(){app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden",Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy()},printexception:function(){1==curLanguage&&alert("Sorry, there was an error while generating the PDF file. Please contact support@conservationroi.net to report this problem."),2==curLanguage&&alert("Lo sentimos, hubo un error al generar el archivo PDF. Por favor, p\xf3ngase en contacto con support@conservationroi.net reportar este problema."),app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden",Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy()}}});if(printPage=new GeoExt.data.PrintPage({printProvider:printProvider}),printProvider.dpis.totalLength>2){var dpi=printProvider.dpis.getAt(printProvider.dpis.totalLength-2);printProvider.setDpi(dpi)}var myLegend=new Ext.Window({id:"myLegend",title:"Legend",width:250,collapsible:!0,autoScroll:!0,layout:"anchor",closable:!1,monitorResize:!0,items:[legendPanel=new GeoExt.LegendPanel({defaults:{id:"myLegendPanel",name:"legend",labelCls:"mylabel",style:"padding:5px",baseParams:{format:"image/png",legend_options:"forceLabels:on"}},preferredTypes:["gx_wmslegend"],dynamic:!0,bodyStyle:"padding:5px",autoScroll:!0,region:"west"})]}),gphy=new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),ghyb=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gsat=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gosm=new OpenLayers.Layer.OSM("OpenStreetMap",["http://otile1.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png"]),ghan=new OpenLayers.Layer.XYZ("Hansen Forest Cover","http://earthengine.google.org/static/hansen_2013/loss_forest_gain/${z}/${x}/${y}.png",{sphericalMercator:!0,attribution:"Hansen et al. 2014",isBaseLayer:!0}),dataLayer=new OpenLayers.Layer.WMS("Data Layer","../../geoserver/wms",{layers:dataSourceLayerName,transparent:!0},{singleTile:!0,transitionEffect:"resize",opacity:.65,displayInLayerSwitcher:!1,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),marginalityLayer=new OpenLayers.Layer.WMS("Marginalization Index","../../geoserver/wms",{layers:"forestro_users_ws:marginality",transparent:!0,styles:"marginality"},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!0,opacity:1,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),selectLayer=new OpenLayers.Layer.Vector("Selection",{displayInLayerSwitcher:!1,transparent:!0}),prioritizationLayer=new OpenLayers.Layer.WMS("Prioritization Results","../../geoserver/wms",{layers:workspaceName+":data_prioritize",transparent:!0},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!0,opacity:.9,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:5e3}});prioritizationLayer.setVisibility(!1);var highlightedFeaturesCopy=selectLayer.clone(),colorSchemeLegendLayer=new OpenLayers.Layer.WMS("Color By Attribute Scheme","../../geoserver/wms",{layers:workspaceName+":dummyDataLayerForWMSLegend",transparent:!0},{isBaseLayer:!1,displayInLayerSwitcher:!0}),hansenLegendLayer=new OpenLayers.Layer.WMS("Hansen Basemap","../../geoserver/wms",{layers:workspaceName+":dummyDataLayerForWMSLegend",transparent:!0},{isBaseLayer:!1,displayInLayerSwitcher:!0}),prioritizationVariables=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbon"," t/ha"],["bio","Biodiversity"," RWRI"],["hydro","Hydrological services index",""],["risk","Deforestation risk","%"],["cost","Cost"," ($ or pes)/ha"],["forarea","Percent forest coverage"," %"],["scenario1","Carbon  expected benefit per cost",""],["scenario2","Biodiversity expected benefit per cost",""],["scenario3","Hydro  expected benefit per cost",""]]}),prioritizationVariablesSpanish=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbono"," t/ha"],["bio","Biodiversidad"," RWRI"],["hydro","Indice de servicios hidrol\xf3gicos",""],["risk","Riesgo de deforestaci\xf3n","%"],["cost","Costo"," ($ o pes)/ha"],["forarea","Cubierta forestal porcentaje"," %"],["scenario1","Beneficio esperado de carbono por costo",""],["scenario2","Beneficio esperado biodiversidad  por costo",""],["scenario3","Beneficio esperado hidrol\xf3gico por costo",""]]}),prioritizationVariablesCA=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Non-soil carbon (biomass)"," t/ha"],["carbon_total","Total carbon (biomass and soil)"," t/ha"],["carbon_soil","Carbon in soil"," t/ha"],["bio","RWRI biodiversity index (global weights)"," RWRI"],["bio_loc","RWRI biodiversity index (national weights)"," RWRI"],["bio_count","Threatened species count"," #"],["hydro","Hydrological services index",""],["risk","Deforestation risk","%"],["cost","Cost"," ($ or pes)/ha"],["forarea","Percent forest coverage"," %"],["scenario1","Carbon (non-soil) expected benefit per cost",""],["scenario2","Biodiversity (glboal RWRI) expected benefit per cost",""],["scenario3","Hydro  expected benefit per cost",""]]}),prioritizationVariablesSpanishCA=new Ext.data.ArrayStore({
fields:["name","displayName","unit"],data:[["carbon","Carbono no suelo (biomasa)"," t/ha"],["carbon_total","Carbono total (biomasa y suelo)"," t/ha"],["carbon_soil","Carbono en el suelo"," t/ha"],["bio","\xcdndice RWRI de biodiversidad (pesos globales)"," RWRI"],["bio_loc","\xcdndice RWRI de biodiversidad (pesos nacionales)"," RWRI"],["bio_count","N\xfamero especies amenazadas"," #"],["hydro","Indice de servicios hidrol\xf3gicos",""],["risk","Riesgo de deforestaci\xf3n","%"],["cost","Costo"," ($ o pes)/ha"],["forarea","Cubierta forestal porcentaje"," %"],["scenario1","Beneficio esperado de carbono (no suelo) por costo",""],["scenario2","Beneficio esperado biodiversidad (RWRI global) por costo",""],["scenario3","Beneficio esperado hidrol\xf3gico por costo",""]]}),map={xtype:"gx_mappanel",id:"map",ref:"mapPanel",region:"center",fractionalZoom:!0,layers:[ghan,gosm,gsat,ghyb,gphy],map:{controls:controls,eventListeners:{zoomend:function(){updateOnZoom(this.getZoom())}}},extent:OpenLayers.Bounds.fromArray([-103e5,23e5,-75e5,76e4])};OpenLayers.Control.CustomNavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomBox({type:OpenLayers.Control.TYPE_TOGGLE,title:"Toggle Box Zoom Tool",zoomOnClick:!1})]),this.displayClass="olControlNavToolbar"},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return a}}),controls.push(navControl=new OpenLayers.Control.Navigation({zoomWheelEnabled:!0,mouseWheelOptions:{interval:250,cumulative:!1}}),panzoomControl=new OpenLayers.Control.PanZoom,attributionControl=new OpenLayers.Control.Attribution,keyboardPanZoomControl=new OpenLayers.Control.KeyboardDefaults,scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}),navZoomControl=new OpenLayers.Control.CustomNavToolbar,showCoordinates=new OpenLayers.Control.MousePosition({displayProjection:"ESPG:4326",separator:" | ",numDigits:2}));var selectBox=new OpenLayers.Control.GetFeature({id:"selectControl",protocol:OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer,{vendorParams:"predAcessCode:519"}),click:!1,clickTolerance:0,box:!0,multipleKey:"shiftKey",toggleKey:"ctrlKey"});selectBox.events.register("featureselected",this,function(a){selectLayer.addFeatures([a.feature])}),selectBox.events.register("featureunselected",this,function(a){selectLayer.removeFeatures([a.feature])});var selectPolygon=new OpenLayers.Control.DrawFeature(selectLayer,OpenLayers.Handler.Polygon);controls.push(selectBox,selectPolygon);var myToolTip=new Ext.ToolTip;OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions)},onPause:function(a){var b=featuresFromXY(a.xy);if(b.length>0){var c=b[0].attributes[Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name];"risk"==Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name&&(c=100*c),isNaN(c)||(c=cleanUpIfNumber(Number(c)));var d="Value of "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName+": "+c+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit;myToolTip.destroy(),myToolTip=new Ext.ToolTip({html:d,dismissDelay:2e3}),myToolTip.showAt([a.xy.x+275,a.xy.y])}}}),OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy();var b=featuresFromXY(a.xy);if(b.length>0){var c=[];selectLayer.removeAllFeatures();var d=new Array;Ext.each(Ext.getCmp("colorAttribute").store.data.items,function(a){""==a.data.unit?d[a.data.name]=a.data.displayName:d[a.data.name]=a.data.displayName+" ("+a.data.unit+")"}),1==curLanguage&&(d.identifying_info="Identifying information for unit"),2==curLanguage&&(d.identifying_info="Informaci\xf3n de identificaci\xf3n de la unidad"),Ext.each(b,function(a){Ext.each(Object.keys(a.attributes),function(b){a.attributes[b]=cleanUpIfNumber(a.attributes[b])});var b="";b=a.fid.replace("getFeatureInfo_ca.","fctt_id: ").replace("getFeatureInfo_mex.","fctt_id: ").replace("getFeatureInfo_userdata.","fctt_id: "),"string"==typeof a.attributes[nameAttribute]&&(b+=": "+a.attributes[nameAttribute]),c.push(new Ext.grid.PropertyGrid({xtype:"propertygrid",id:a.fid,title:b,source:a.attributes,propertyNames:d,autoActivate:!0,autoExpand:!0,listeners:{beforeedit:{fn:function(){return!1}},expand:function(a){selectLayer.removeAllFeatures();for(var b=0;b<highlightedFeaturesCopy.features.length;b++)highlightedFeaturesCopy.features[b].fid==a.id&&selectLayer.addFeatures(highlightedFeaturesCopy.features[b]);selectLayer.redraw()},render:function(a){a.getColumnModel().setColumnWidth(0,400)}}})),a.geometry.transform("EPSG:4326","EPSG:900913"),selectLayer.addFeatures(a),highlightedFeaturesCopy=selectLayer.clone();for(var e=0;e<highlightedFeaturesCopy.features.length;e++)highlightedFeaturesCopy.features[e].fid=selectLayer.features[e].fid}),selectLayer.redraw(),Ext.getCmp("attributePanel")&&Ext.getCmp("attributePanel").destroy(),new GeoExt.Popup({id:"attributePanel",title:"Feature Attributes",layout:"accordion",layoutConfig:{multi:!0},map:app.mapPanel,location:new OpenLayers.Pixel(300,425),panIn:!1,height:400,width:550,collapsible:!0,autoScroll:!0,anchored:!1,collapsed:!0,titleCollapse:!0,items:c,listeners:{close:{fn:function(){selectLayer.removeAllFeatures(),highlightedFeaturesCopy.removeAllFeatures()}}}}).show()}}});var infoClick=new OpenLayers.Control.Click,infoHover=new OpenLayers.Control.Hover,bottombar={xtype:"container",id:"bottomBar",ref:"bottomBar",height:15,padding:0,region:"south",border:!1,style:"padding:2px 0px 0px 0px",items:[{xtype:"label",id:"appCopyright",text:"\xa9 2015 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission.",style:"font: bold 9px arial; color: blue; text-align: center; display:inline-block",width:window.innerWidth}]},topbar={xtype:"toolbar",id:"topBar",ref:"topBar",height:topBarHeight,padding:0,region:"north",border:!1,style:"padding:0px 0px 0px 0px",cls:"topBar",items:[new Ext.Button({text:"How To",id:"howToItem",menu:[{text:"Description",id:"descriptionItem",listeners:{click:function(){1==curLanguage&&openPage("documents/description.pdf","Forest Conservation Targeting Tool Description"),2==curLanguage&&openPage("documents/description.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Descripci\xf3n")}}},{text:"Instructions",id:"instructionsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/instructions.pdf","Forest Conservation Targeting Tool Instructions"),2==curLanguage&&openPage("documents/instructions.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Instrucciones")}}},{text:"FAQ",id:"faqItem",listeners:{click:function(){1==curLanguage&&openPage("documents/faq.html","Forest Conservation Targeting Tool FAQ"),2==curLanguage&&openPage("documents/faq_sp.html","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - FAQ")}}},{text:"Video Tutorial",id:"videoTutorialItem",listeners:{click:function(){1==curLanguage&&openPage("documents/tutorial.html","Forest Conservation Targeting Tool Video Tutorial"),2==curLanguage&&openPage("documents/tutorial_sp.html","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Video Tutorial")}}},{text:"User Questions",id:"userQuestionsItem",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Preguntas de Usuarios")}}},{text:"Email",id:"emailItem",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"About",id:"aboutItem",menu:[{text:"Metadata",id:"metadataItem",listeners:{click:function(){1==curLanguage&&openPage("documents/metadata.pdf","Forest Conservation Targeting Tool Metadata"),2==curLanguage&&openPage("documents/metadata.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Metadatos")}}},{text:"Sponsors",id:"sponsorsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/sponsors.pdf","Forest Conservation Targeting Tool Sponsors"),2==curLanguage&&openPage("documents/sponsors.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Promotores")}}},{text:"Team",id:"teamItem",listeners:{click:function(){1==curLanguage&&openPage("documents/team.pdf","Forest Conservation Targeting Tool Team"),2==curLanguage&&openPage("documents/team.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Equipo")}}},{text:"Email",id:"emailItem2",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Feedback",id:"feedbackItem",menu:[{text:"User Questions",id:"userQuestionsItem2",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Preguntas de Usuarios")}}},{id:"userCommentsItem",id:"userCommentsItem",text:"User Comments",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/usercomments","Forest Conservation Targeting Tool User Comments"),2==curLanguage&&openPage("http://conservationroi.net/usercomments","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Comentarios de Usuarios")}}},{text:"Email",id:"emailItem3",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Use your own data",id:"loginItem",cls:"hidearrow",menu:[{id:"userConsoleItem",text:"User Console",listeners:{click:function(){var a=0;1==curLanguage&&confirm("Navigating to the User Console will restart your session in the FCTT. Do you wish to continue?")&&(a=1),2==curLanguage&&confirm("Navegaci\xf3n a la consola de usuario se reiniciar\xe1 la sesi\xf3n en el FCTT. \xbfDesea continuar?")&&(a=1),1==a&&(Ext.getCmp("app").toolPanel.el.setWidth(0),Ext.getCmp("app").doLayout(),app.mapPanel.map.div.innerHTML="<iframe src='../../usersystem/userconsole.php?lang="+curLanguage+"' width = 100% height = 100%></iframe>",myLegend.hide(),Ext.getCmp("userConsoleItem").hide(),Ext.getCmp("returnToFCTTItem").show())}}},{id:"returnToFCTTItem",text:"Reload FCTT",hidden:!0,listeners:{click:function(){window.top.location.href="../../index_user.html"}}},{id:"logoutItem",text:"Logout",listeners:{click:function(){1==curLanguage&&confirm("Logging out will restart your session in the FCTT. Do you wish to continue?")&&(window.location="../../usersystem/logout_fctt.php"),2==curLanguage&&confirm("Hacer clic en 'Logout' se reiniciar\xe1 su sesi\xf3n en el FCTT. \xbfDesea continuar?")&&(window.location="../../usersystem/logout_fctt.php")}}}],listeners:{mouseover:function(){this.showMenu()},click:function(){1==isIE?(1==curLanguage&&alert("Uploading your own data is only supported in the Chrome and Firefox browsers at this time, not Internet Explorer. Please use one of these other browsers to access this feature."),2==curLanguage&&alert("La carga de sus propios datos s\xf3lo se admite en los navegadores Chrome y Firefox en este momento, no Internet Explorer. Por favor, use uno de estos navegadores otras para acceder a esta funci\xf3n.")):1==loginRegisterWindow.hidden?0==phpVarIsLoggedIn&&(loginRegisterWindow.show(),app.mapPanel.disable(),Ext.getCmp("toolPanel").disable(),myLegend.disable()):(loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable())},menutriggerout:function(){}}}),{xtype:"spacer",width:10},{xtype:"container",layout:{type:"vbox",align:"stretch"},id:"appTitleContainer",style:"padding:5px 0px 0px;",width:window.innerWidth-625,height:topBarHeight,items:[{xtype:"label",id:"appTitle",text:"Forest Conservation Targeting Tool (Beta)",style:"font: bold "+topBarHeight/1.75+"px arial; color: white; text-align: center; display:inline-block"}]},"->",{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/nasa-logo.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/Mesoamerica2.png" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.rff.org" target="_blank"><img src="images/rff_transparent.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:5}]},toolpanel={id:"toolPanel",ref:"toolPanel",padding:"0 0 0 0",region:"west",title:"<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>",bodyStyle:"background-image:url(images/panel2.jpg);background-size: cover",collapsible:!0,width:255,autoScroll:!0,items:toolItems,tbar:new Ext.Toolbar({items:[{xtype:"spacer",width:20},new Ext.Toolbar.TextItem("Language/Idioma:"),{xtype:"combo",id:"language",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:110,queryMode:"local",value:"Espa\xf1ol",store:[[1,"English"],[2,"Espa\xf1ol"]],listeners:{select:function(a,b,c){curLanguage=c+1,updateLanguage()}}}]}),bbar:[{id:"resetButton",text:"<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>",handler:function(){dataSourceNum=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1,setDataSource(dataSourceNum),app.mapPanel.map.getZoom()<8&&4==dataSourceNum&&dataLayer.setVisibility(!1),Ext.getCmp("chkLines").setValue(linesOn),Ext.getCmp("chkRisk").setValue(!0),Ext.getCmp("chkCost").setValue(!0),Ext.getCmp("chkMean").setValue(!1),Ext.getCmp("chkArea").setValue(!0),whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",forestThreshold=25,Ext.getCmp("thresholdSlider").setValue(forestThreshold),updateDataLayerParams(),updatePrioritization(),Ext.getCmp("regionSelectCombo").setValue(0),Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("colorAttribute").getSelectionModel().clearSelections(),colorSchemeOn=!1,infoHover.deactivate(),Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),zoomToRegion(),updateOnZoom(app.mapPanel.map.getZoom()),updateStyling(),dataLayer.redraw(),resetLegendPosition()}},"->",{id:"resetLegend",text:"Reset Legend Position",handler:function(){resetLegendPosition()}}]},regionPanel={id:"regionPanel",title:"DEFINE STUDY AREA",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 3px;",labelWidth:80,items:[{xtype:"compositefield",fieldLabel:"Dataset",id:"datasetLabel",items:[{xtype:"combo",id:"datasource",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:130,queryMode:"local",value:"Central America 10km",store:[[5,"Central America Administrative"],[3,"Central America 10km"],[4,"Central America 1km"],[2,"Mexico Predios"],[1,"MREDD AATRs"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}],listeners:{beforeselect:function(a,b,c){return-1==Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1?!1:void 0},select:function(a,b,c){var d=dataSourceNum,e=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1;d!=e&&(Ext.getCmp("adminSelect").show(),dataSourceNum=e,setDataSource(dataSourceNum),app.mapPanel.map.getZoom()<8&&4==dataSourceNum&&dataLayer.setVisibility(!1),inClauseStr="idAttribute:1;inSet:1",(3!=d&&4!=d&&5!=d||3!=e&&4!=e&&5!=e)&&(whereClauseStr="whereParam:1;whereValue:1",Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("regionSelectCombo").setValue(0),zoomToRegion()),updateDataLayerParams(),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),Ext.getCmp("chkLines").setValue(linesOn),updateOnZoom(app.mapPanel.map.getZoom()),dataLayer.redraw(),updateStyling(),1==dataSourceNum||2==dataSourceNum?Ext.getCmp("chkMarginality").setDisabled(!1):(Ext.getCmp("chkMarginality").setDisabled(!0),Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1)),prioritizationLayer.setVisibility(!1),prioritizationLayer.redraw())}}}]},{xtype:"compositefield",fieldLabel:"Minimum Forest Cover",id:"thresholdLabel",hidden:!1,items:[{xtype:"slider",id:"thresholdSlider",aggressive:!0,vertical:!1,useTips:!1,value:25,maxValue:100,minValue:25,width:100,listeners:{change:function(a){Ext.getCmp("thresholdValueLabel").setText(a.getValue()+"%"),forestThreshold=a.getValue(),updatePrioritization()}}},{xtype:"label",id:"thresholdValueLabel",text:"25%",style:{padding:"3px 0px 0px 0px"}},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"panel",title:"By administrative boundary",id:"adminSelect",collapsible:!0,collapsed:!0,titleCollapse:!0,labelWidth:80,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"compositefield",fieldLabel:"Region",id:"regionLabel",items:[{xtype:"combo",id:"regionSelectCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:130,value:"All Countries",store:[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],queryMode:"local",listeners:{select:function(a,b,c){var d=Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field1;d>0?(whereClauseStr="whereParam:"+locationParamName+";whereValue:"+d,inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams()):(whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams()),prioritizationLayer.setVisibility(!1),zoomToRegion(),updateStyling()}}}]}]},{xtype:"panel",title:"Using manual selection tool",id:"manuallySelect",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"compositefield",fieldLabel:"Selection Mode",id:"selectionMode",items:[{xtype:"combo",id:"selectModeCombo",selectedIndex:0,width:110,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",value:"Polygon",store:[[1,"Polygon"],[2,"Box"]],listeners:{select:function(a,b,c){selectMode=c+1,Ext.getCmp("selectsubmitselection").enable(),2==selectMode&&(userLayerActive?(1==curLanguage&&Ext.Msg.alert("","Unfortunately, the Box/Manual Select Tool can not be used with user-defined layers at this time. Note that you can create an arbitrary region of interest for user-defined layers by restricting your shapefile to the fctt_id you are interested in before uploading the data in the User Console"),2==curLanguage&&Ext.Msg.alert("","Desafortunadamente, la Herramienta Caja/Selecci\xf3n Manual no se puede utilizar con capas definidas por el usuario en este momento. Tenga en cuenta que puede crear una regi\xf3n arbitraria de inter\xe9s para las capas definidas por el usuario mediante la restricci\xf3n de su archivo de formas a la fctt_id le interesa antes de cargar los datos en la consola de usuario."),Ext.getCmp("selectsubmitselection").disable()):(1==curLanguage&&Ext.Msg.alert("Note","Use of the Box/Manual Select Tool is not possible for selecting more than 10,000 shapes. In this case, please use the Within Polygon or Upload Shapefile tool."),2==curLanguage&&Ext.Msg.alert("Nota","De usuario de la herramienta de selecci\xf3n Caja/Clic Manual no se posible para la selecci\xf3n de m\xe1s de 10,000 formas. En este caso, por favor, utilice la herramienta de Dentro Pol\xedgono o Subir Shapefile.")))}}}]}],listeners:{expand:function(){"undefined"!=typeof instructionsWindow&&(1==curLanguage&&(instructionsWindow.show(),instructionsWindowSp.hide()),2==curLanguage&&(instructionsWindow.hide(),instructionsWindowSp.show()))}},bbar:[{xtype:"button",id:"selectsubmitselection",text:"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){if(navigationMode)navigationMode=!1,1==selectMode&&selectPolygon.activate(),2==selectMode&&selectBox.activate(),infoHover.deactivate(),infoClick.deactivate(),selectLayer.removeAllFeatures(),selectLayer.redraw(),Ext.getCmp("attributePanel")&&(Ext.getCmp("attributePanel").removeAll(),Ext.getCmp("attributePanel").close()),Ext.getCmp("cancelclearselection").show(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>");else{if(1==selectMode){if(0==selectLayer.features.length&&(Ext.Msg.alert("Whoops!","No feature drawn. Please use the mouse to draw a study area polygon. Double-click to complete."),2==curLanguage&&Ext.Msg.alert("\xa1Ay!","Sin Caracter\xedsticas dibujadas. Utilice el rat\xf3n para dibujar una \xe1rea de estudio pol\xedgono. Haga doble clic para completar.")),1==selectLayer.features.length){var a=selectLayer.features[0];if(a.geometry.components[0].components.length<4)Ext.Msg.alert("Whoops!","Polygon must have at least three vertices."),2==curLanguage&&Ext.Msg.alert("\xa1Ay!","Pol\xedgono debe tener al menos tres v\xe9rtices.");else{a.geometry.transform("EPSG:900913","EPSG:4326"),whereClauseStr=a.geometry.toString(),whereClauseStr=whereClauseStr.replace("POLYGON","LINESTRING"),whereClauseStr=whereClauseStr.replace("((","("),whereClauseStr=whereClauseStr.replace("))",")"),whereClauseStr="whereValue:TRUE;whereParam:ST_Intersects(geom, (SELECT ST_MakePolygon(ST_GeomFromText('"+whereClauseStr+"',4326))))",whereClauseStr=whereClauseStr.replace(/,/g,"\\,"),inClauseStr="idAttribute:1;inSet:1";var b=inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold+"layerPIN:"+phpVarlayerPIN;dataLayer.mergeNewParams({viewparams:b})}}selectLayer.features.length>1&&(Ext.Msg.alert("Whoops!","Multiple features drawn. Limit is one."),2==curLanguage&&Ext.Msg.alert("\xa1Ay!","M\xfaltiples caracter\xedsticas dibujadas. Limit es una."))}if(2==selectMode){var c=[];Ext.iterate(selectBox.features,function(a,b){c.push(b.fid.replace(dataSourceLayerName.replace(workspaceName+":","")+".",""))}),whereClauseStr="whereValue:1;whereParam:1",inClauseStr="idAttribute:"+idAttribute+";inSet:"+c,inClauseStr=inClauseStr.replace(/,/g,"\\,"),0==c.length&&(Ext.Msg.alert("Whoops!","No features selected! Click on features or draw a box to select."),inClauseStr="idAttribute:1;inSet:1"),0==c.length&2==curLanguage&&(Ext.Msg.alert("\xa1Ay!","No hay caracter\xedsticas seleccionadas! Haga clic en las caracter\xedsticas o dibujar un cuadro para seleccionar."),inClauseStr="idAttribute:1;inSet:1"),c.length>0&&updateDataLayerParams()}Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),navigationMode=!0,selectPolygon.deactivate(),selectBox.deactivate(),colorSchemeOn&&infoHover.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),prioritizationLayer.setVisibility(!1),updateStyling(),dataLayer.redraw()}updateSelectionButtonLanguage()}},"->",{xtype:"button",id:"cancelclearselection",text:"<div style='color:black;font-size: 12'>Clear/Cancel</div>",icon:"images/clear.gif",hidden:!0,handler:function(){var a=Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field1;0==a&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:1;whereValue:1",updateDataLayerParams()),a>0&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:"+locationParamName+";whereValue:"+a,updateDataLayerParams()),Ext.iterate(selectBox.features,function(a,b){delete selectBox.features[a]}),selectBox.deactivate(),selectPolygon.deactivate(),inClauseStr="idAttribute:1;inSet:1",updateStyling(),navigationMode?(Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()):(navigationMode=!0,colorSchemeOn&&infoHover.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()),updateSelectionButtonLanguage()}}]}]},optionsPanel={id:"optionsPanel",title:"DISPLAY OPTIONS",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 2;",items:[{xtype:"panel",id:"defaultColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>',listeners:{expand:function(a,b){document.getElementById("defaultColorPanel").doLayout}},items:[{xtype:"colorpalette",id:"defaultColorPicker",color:"blue",handler:function(a,b){defaultColor=b,Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Color de Relleno Defecto</div>'),Ext.getCmp("defaultColorPanel").collapse(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape lines",id:"shpLinesLabel",items:[{xtype:"checkbox",id:"chkLines",checked:!0,handler:function(){linesOn=Ext.getCmp("chkLines").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape fill",id:"shpFillLabel",items:[{xtype:"checkbox",id:"chkFill",checked:!0,handler:function(){selectLayer.setVisibility(Ext.getCmp("chkFill").checked),fillOn=Ext.getCmp("chkFill").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Opacity",id:"opacityLabel",items:[{xtype:"gx_opacityslider",id:"opacitySlider",layer:dataLayer,changeVisibility:!0,aggressive:!0,vertical:!1,width:120,value:65,x:15,y:150,plugins:new GeoExt.LayerOpacitySliderTip},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"compositefield",fieldLabel:"Marginality Layer",id:"margLayerLabel",items:[{xtype:"checkbox",id:"chkMarginality",checked:!1,disabled:!0,handler:function(){marginalityLayer.setVisibility(Ext.getCmp("chkMarginality").checked),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Base map type",id:"basemapLabel",items:[{xtype:"combo",id:"basemapCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:120,queryMode:"local",value:"Google Physical",store:[[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satelitte"],[4,"OpenStreetMap"],[5,"Forest Change(2000-2012)"]],listeners:{select:function(a,b,c){gphy.setVisibility(1==c),ghyb.setVisibility(2==c),gsat.setVisibility(3==c),gosm.setVisibility(4==c),ghan.setVisibility(5==c),gosmActive=4==c,ghanActive=5==c,updateOnZoom(app.mapPanel.map.getZoom()),updateStyling()}}}]},{xtype:"compositefield",fieldLabel:"Show Scale",id:"showScaleLabel",items:[{xtype:"checkbox",id:"chkScale",checked:!0,handler:function(){Ext.getCmp("chkScale").checked||app.mapPanel.map.removeControl(scaleControl),Ext.getCmp("chkScale").checked&&app.mapPanel.map.addControl(scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}))}}]},{xtype:"compositefield",fieldLabel:"Pan/Zoom Tool",id:"panZoomLabel",items:[{xtype:"checkbox",id:"chkPanZoom",checked:!0,handler:function(){Ext.getCmp("chkPanZoom").checked||app.mapPanel.map.removeControl(panzoomControl),Ext.getCmp("chkPanZoom").checked&&app.mapPanel.map.addControl(panzoomControl=new OpenLayers.Control.PanZoom)}}]},{xtype:"compositefield",fieldLabel:"Mouse wheel zoom",id:"mouseWheelLabel",items:[{xtype:"checkbox",id:"chkMouseZoom",checked:!0,handler:function(){Ext.getCmp("chkMouseZoom").checked||navControl.disableZoomWheel(),Ext.getCmp("chkMouseZoom").checked&&navControl.enableZoomWheel()}}]}]},colorByAttributePanel=new Ext.Panel({id:"colorByAttributePanel",title:"TARGETING DATA",collapsible:!0,titleCollapse:!0,layout:"form",labelWidth:95,bodyStyle:"padding: 3;",items:[{xtype:"panel",id:"lowColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 0px 0px",title:'<center><div style="color: '+lowColor+'; font-weight: bold">Low Color</div>',listeners:{expand:function(a,b){document.getElementById("lowColorPanel").doLayout}},items:[{xtype:"colorpalette",id:"lowColorPicker",color:"blue",handler:function(a,b){lowColor=b,Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Low Color</div>'),2==curLanguage&&Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("lowColorPanel").collapse(),Ext.getCmp("highColorPanel").expand(),updateStyling()}}]},{xtype:"panel",id:"highColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 10px 0px",title:'<center><div style="color: '+highColor+'; font-weight: bold">High Color</div>',listeners:{expand:function(a,b){document.getElementById("highColorPanel").doLayout}},items:[{xtype:"colorpalette",id:"highColorPicker",color:"red",handler:function(a,b){highColor=b,Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">High Color</div>'),2==curLanguage&&Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("highColorPanel").collapse(),Ext.getCmp("highColorPanel").expand(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Method",id:"methodLabel",items:[{xtype:"combo",id:"methodCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:115,queryMode:"local",value:"Interpolate",store:[[0,"Interpolate"],[1,"Quantiles"]],listeners:{select:function(a,b,c){updateStyling(),Ext.getCmp("numQuantiles").setDisabled(0==c)}}}]},{xtype:"compositefield",fieldLabel:"# Quantiles",id:"quantilesLabel",disabled:!0,items:[{xtype:"numberfield",id:"numQuantiles",width:40,value:"3",listeners:{change:function(){updateStyling()}}}]},new Ext.grid.GridPanel({id:"colorAttribute",title:"Variables",store:prioritizationVariables,cm:new Ext.grid.ColumnModel([{id:"displayName",dataIndex:"displayName",sortable:!0}]),sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),autoExpandColumn:"displayName",height:200}),{xtype:"compositefield",fieldLabel:"Show null values",id:"chkNullLabel",items:[{xtype:"checkbox",id:"chkNull",boxLabel:"(in default color)",checked:!1,handler:function(){updateStyling()}}]}],bbar:[{id:"updatedatavis",hidden:!0,text:"<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>",cls:"boldbutton",icon:"images/refresh.gif",handler:function(){colorSchemeOn=!0,infoHover.activate(),updateStyling()}},"->",{id:"cleardatavis",text:"<div style='color:black;font-size: 12'>Clear</div>",icon:"images/clear.gif",handler:function(){colorSchemeOn=!1,infoHover.deactivate(),updateStyling()}}]});Ext.grid.RowSelectionModel.override({getSelectedIndex:function(){return this.grid.store.indexOf(this.selections.itemAt(0));
}}),Ext.getCmp("colorAttribute").on("rowclick",function(){colorSchemeOn=!0,infoHover.activate(),updateStyling()},this),Ext.getCmp("colorAttribute").on("beforerowselect",function(){alert("hi!")},this),Ext.getCmp("colorAttribute").on("keydown",function(a){if(38==a.keyCode){var b=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();b>0&&(Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b-1),updateStyling(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b))}if(40==a.keyCode){var b=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();b<Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].store.totalLength-1&&(Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b+1),updateStyling(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b))}},this);var selectPanel=new Ext.Panel({xtype:"panel",id:"selectPanel",title:"TARGET",layout:"form",layoutConfig:{multi:!0},collapsible:!0,collapsed:!1,titleCollapse:!0,bodyStyle:"padding: 3;",items:[{xtype:"fieldset",id:"chooseBenefits",title:"Choose Benefit Variables",collapsible:!1,hidden:!1,labelWidth:75,items:[{xtype:"compositefield",fieldLabel:"Carbon:",id:"carbonBenefitLabel",items:[{xtype:"combo",id:"carbonBenefitChoose",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:115,queryMode:"local",value:"Non-soil carbon",store:[["carbon","Non-soil carbon"],["carbon_total","Total carbon"],["carbon_soil","Carbon in soil"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}]}]},{xtype:"compositefield",fieldLabel:"Biodiversity:",id:"bioBenefitLabel",items:[{xtype:"combo",id:"bioBenefitChoose",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:115,queryMode:"local",value:"Global RWRI",store:[["bio","Global RWRI"],["bio_loc","National RWRI"],["bio_count","Threat. species count"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}]}]}]},{xtype:"fieldset",id:"priorityBudget",title:"Choose Budget",collapsible:!1,items:[{layout:"hbox",unstyled:!0,items:[{xtype:"radio",id:"percentageRadio",checked:!0,boxLabel:"Percentage of total:",listeners:{check:function(a,b){b&&(Ext.getCmp("rawRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!1),Ext.getCmp("budget_raw").setDisabled(!0))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"budget_percentage",width:30,value:"10"},{xtype:"spacer",width:3},{xtype:"label",text:"(%)"}]},{layout:"hbox",unstyled:!0,style:"padding:10px 0px 0px 0px",items:[{xtype:"radio",id:"rawRadio",boxLabel:"Raw budget:",listeners:{check:function(a,b){b&&(Ext.getCmp("percentageRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!0),Ext.getCmp("budget_raw").setDisabled(!1))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"budget_raw",width:67,value:"10000000",disabled:!0},{xtype:"spacer",width:3},{xtype:"label",id:"currencyLabel",text:"($)"}]}]},{xtype:"tabpanel",id:"benefitTabPanel",activeTab:0,plain:!0,items:[{id:"combineTab",title:"Weight Benefits",padding:5,autoHeight:!0,items:[{layout:"auto",unstyled:!0,items:[{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"carbonweightfield",fieldLabel:'<div style="color: green; font-weight: bold">Carbon:</div>',labelSeparator:"",items:[{xtype:"numberfield",decimalPrecision:2,id:"weight1",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(0,100*Ext.getCmp("weight1").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"bioweightfield",fieldLabel:'<div style="color: red; font-weight: bold">Biodiversity:</div>',labelSeparator:"",items:[{xtype:"numberfield",decimalPrecision:2,id:"weight2",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,Ext.getCmp("weightMultiSlider").getValues()[0]+100*Ext.getCmp("weight2").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"hydroweightfield",fieldLabel:'<div style="color: blue; font-weight: bold">Hydrological:</div>',labelSeparator:"",items:[{xtype:"numberfield",decimalPrecision:2,id:"weight3",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,100*(1-Ext.getCmp("weight3").value))}}}]}]}]},new Ext.slider.MultiSlider({id:"weightMultiSlider",values:[33,66],increment:1,minValue:0,maxValue:100,constrainThumbs:!0,width:215,plugins:[new Ext.ux.slider.Highlight],listeners:{change:function(a,b,c){0==c.index&&(Ext.getCmp("weight1").setValue(a.getValues()[0]/100),Ext.getCmp("weight2").setValue((a.getValues()[1]-a.getValues()[0])/100)),1==c.index&&(Ext.getCmp("weight2").setValue((a.getValues()[1]-a.getValues()[0])/100),Ext.getCmp("weight3").setValue((100-a.getValues()[1])/100))}}}),{xtype:"panel",id:"selectedFillColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>',items:[{xtype:"colorpalette",id:"selectedFillColorPicker",color:"blue",handler:function(a,b){selectedFillColor=b,Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("selectedFillColorPanel").collapse(),prioritizationLayer.visibility&&updatePrioritization()}}]}]},{id:"compareTab",title:"Compare",height:100,layout:{type:"hbox",pack:"center",align:"middle"},padding:2,items:[{xtype:"combo",id:"compareObjectiveCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",width:150,value:"All Benefits",store:[[0,"All Benefits"],[1,"Carbon and Biodiversity"],[2,"Carbon and Hydro"],[3,"Biodiversity and Hydro"]],listeners:{select:function(a,b,c){prioritizationLayer.visibility&&updatePrioritization()}}}]}]},{xtype:"fieldset",id:"priorityOptions",title:"Options",layout:"form",labelWidth:170,collapsible:!1,items:[{xtype:"compositefield",fieldLabel:"Scale benefits by deforestation risk",id:"chkRiskLabel",items:[{xtype:"checkbox",id:"chkRisk",checked:!0}]},{xtype:"compositefield",fieldLabel:"Divide expected benefits by cost",id:"chkCostLabel",items:[{xtype:"checkbox",id:"chkCost",checked:!0}]},{xtype:"compositefield",fieldLabel:"Scale total costs by forest area",id:"chkAreaLabel",items:[{xtype:"checkbox",id:"chkArea",checked:!0}]},{xtype:"compositefield",fieldLabel:"Normalize benefits by mean instead of median",id:"chkMeanLabel",items:[{xtype:"checkbox",id:"chkMean",listeners:{change:function(a,b,c){1==curLanguage&&b&&Ext.Msg.alert("Warning","Normalizing by the mean rather than the median may make prioritization results particularly sensitive to outliers. (If you just clicked Submit, you may need to click again)."),2==curLanguage&&b&&Ext.Msg.alert("Aviso","La normalizaci\xf3n de la media en lugar de la mediana puede hacer que los resultados de priorizaci\xf3n particularmente sensible a los valores at\xedpicos. (Si usted acaba de hacer clic en Entregar, es posible que tenga que hacer clic de nuevo).")}}}]},{xtype:"compositefield",fieldLabel:"Opacity:",id:"priorityOpacityLabel",items:[{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"gx_opacityslider",id:"priorityOpacitySlider",layer:prioritizationLayer,aggressive:!0,vertical:!1,width:200,value:90,x:15,y:150,plugins:new GeoExt.LayerOpacitySliderTip}]}],bbar:[{id:"submitprioritization",text:"<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){prioritizationLayer.setVisibility(!0),updatePrioritization()}},"->",{id:"clearprioritization",text:"<div style='color:black;font-size: 12'>Clear</div>",cls:"boldbutton",icon:"images/clear.gif",handler:function(){prioritizationLayer.setVisibility(!1),updateStyling()}}]}),exportPanel={id:"exportPanel",title:"EXPORT",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",hidden:!1,bodyStyle:"padding: 2;",items:[{xtype:"button",text:"<div style='color:black;font-size: 12'>Export Shapefile</div>",id:"shapefileButton",scale:"medium",icon:"images/download_shp.png",handler:function(){if(userLayerActive&&"mex_pred"==userDataSourceUOA||1==dataSourceNum||2==dataSourceNum)1==curLanguage&&alert("Unfortunately, shapefile download is not possible for datasets that use the Mexico predios. However, you can download your data and prioritization results in CSV format, including predio names."),2==curLanguage&&alert("Desafortunadamente, descarga shapefile no es posible para los conjuntos de datos que utilizan los predios M\xe9xico. Sin embargo, puede descargar los datos y resultados de priorizaci\xf3n en formato CSV, incluyendo los nombres de predios.");else{var a="";if(updatePrioritization(),prioritizationLayer.visibility){a=userLayerActive?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_userdata&outputFormat=SHAPE-ZIP&format_options=filename:fctt_output.zip":"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize&outputFormat=SHAPE-ZIP&format_options=filename:fctt_output.zip",imgWait.style.visibility="visible";var b=document.createElement("form");b.method="POST",b.action=a;var c=document.createElement("input");c.type="hidden",c.name="viewParams",c.value=priorityParams,b.appendChild(c),document.body.appendChild(b),b.submit(),imgWait.style.visibility="hidden"}else 1==curLanguage&&Ext.Msg.alert("","You must run the prioritization tool before downloading the results."),2==curLanguage&&Ext.Msg.alert("",'Necesita ejecutar la herramienta "Focalizar" antes de descargar los resultados.')}}},{xtype:"button",text:"<div style='color:black;font-size: 12'>Export CSV</div>",id:"csvButton",scale:"medium",icon:"images/download_csv.png",handler:function(){var a="";if(updatePrioritization(),prioritizationLayer.visibility){a=userLayerActive?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_userdata&outputFormat=csv":"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize&outputFormat=csv";var b="";b=";geomZero:0",imgWait.style.visibility="visible";var c=document.createElement("form");c.method="POST",c.action=a;var d=document.createElement("input");d.type="hidden",d.name="viewParams",d.value=priorityParams+b,c.appendChild(d),document.body.appendChild(c),c.submit(),imgWait.style.visibility="hidden"}else 1==curLanguage&&Ext.Msg.alert("","You must run the prioritization tool before downloading the results."),2==curLanguage&&Ext.Msg.alert("",'Necesita ejecutar la herramienta "focalizar" antes de descargar los resultados.')}},{xtype:"button",id:"printButton",text:"<div style='color:black;font-size: 12'>Print/PDF</div>",scale:"medium",icon:"images/print.png",hidden:!1,handler:function(){if(1==isIE)1==curLanguage&&alert("Printing functionality is only supported in the Chrome and Firefox browsers at this time, not Internet Explorer. Please use one of these other browsers to access this feature."),2==curLanguage&&alert("La funcionalidad de impresi\xf3n s\xf3lo se admite en los navegadores Chrome y Firefox en este momento, no Internet Explorer. Por favor, use uno de estos navegadores otras para acceder a esta funci\xf3n.");else{if(Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy(),1==curLanguage){var a=new Ext.Window({autoHeight:!0,width:350,resizeable:!1,id:"printDialog",title:"Configure Print",items:[new GeoExt.PrintMapPanel({sourceMap:app.mapPanel,legend:legendPanel,printProvider:printProvider})],bbar:[{id:"createPDFIcon",text:"Create PDF",handler:function(){1==ghan.getVisibility()&a.items.get(0).currentZoom>8&&alert("Warning: the Forest Change basemap will not print at the current zoom level. To include the Forest Change basemap, please zoom out."),1==ghan.getVisibility()&&(printProvider.customParams.attributionText="Basemap: Hansen et al. 2014"),1==gosm.getVisibility()&&1==curLanguage&&(printProvider.customParams.attributionText="Basemap: \xa9OpenStreetMap contributors"),1==gosm.getVisibility()&&2==curLanguage&&(printProvider.customParams.attributionText="Basemap: \xa9Contribuyentes de OpenStreetMap"),a.items.get(0).print({legend:legendPanel})}}]});a.show()}if(2==curLanguage){var a=new Ext.Window({autoHeight:!0,width:450,resizeable:!1,id:"printDialog",title:"Configure Imprimir",items:[new GeoExt.PrintMapPanel({sourceMap:app.mapPanel,legend:legendPanel,printProvider:printProvider})],bbar:[{id:"createPDFIcon",text:"Crear PDF",handler:function(){1==ghan.getVisibility()&a.items.get(0).currentZoom>8&&alert("Advertencia: Cambiar el mapa base del bosque no se imprimir\xe1 en el nivel de zoom actual. Para incluir el basemap de Cambia Forestal, por favor disminuir el zoom."),1==ghan.getVisibility()&&(printProvider.customParams.attributionText="Basemap: Hansen et al. 2014"),1==gosm.getVisibility()&&1==curLanguage&&(printProvider.customParams.attributionText="Basemap: \xa9OpenStreetMap contributors"),1==gosm.getVisibility()&&2==curLanguage&&(printProvider.customParams.attributionText="Basemap: \xa9Contribuyentes de OpenStreetMap"),a.items.get(0).print({legend:legendPanel})}}]});a.show()}}}}]};toolItems.push(optionsPanel,regionPanel,colorByAttributePanel,selectPanel,exportPanel);