function registerEvents(a){a.events.register("loadstart",a,function(){app.mapPanel.body.dom.style.cursor="wait",imgWait.style.visibility="visible"}),a.events.register("tileloaded",a,function(){}),a.events.register("loadend",a,function(){app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden"})}function prioritizationSelectorFactory(){}function getMinAvgMax(a){var b={method:"GET",async:!1};userLayerActive?b.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_userdata&viewparams=theAttribute:"+a+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName:b.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_aldeas&viewparams=theAttribute:"+a+";dataSource:"+dataSourceName,b.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:-100000000000000000000;var1UpperThreshold:100000000000000000000;var2LowerThreshold:-100000000000000000000;var2UpperThreshold:100000000000000000000;var3LowerThreshold:-100000000000000000000;var3UpperThreshold:100000000000000000000";var c=OpenLayers.Request.issue(b);if(null!=c.responseXML.documentElement.lastChild.firstChild.firstChild)var d=Number(c.responseXML.documentElement.lastChild.firstChild.firstChild.textContent),e=Number(c.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.textContent),f=Number(c.responseXML.documentElement.lastChild.firstChild.lastChild.textContent);else d=0,e=.5,f=1;return[d,e,f]}function updateStyling(){function a(){app.mapPanel.map.getLayersByName("Marginality Legend").length>0&&app.mapPanel.map.removeLayer(marginalityLegendLayer),1==marginalityLayer.getVisibility()&&(rulesForLegend2=[],1==curLanguage&&(marginalityLegendLayer.name="Mexico Marginality Index",rulesForLegend2.push(new OpenLayers.Rule({title:"Lowest marginality",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Highest marginality",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),2==curLanguage&&(marginalityLegendLayer.name="\xc3\x8dndice de Marginalidad en Mexico",rulesForLegend2.push(new OpenLayers.Rule({title:"M\xc3\xa1s baja marginalidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"M\xc3\xa1s alta marginalidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),marginalityLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:rulesForLegend2})}),app.mapPanel.map.addLayer(marginalityLegendLayer),marginalityLegendLayer.name="Marginality Legend")}function b(){app.mapPanel.map.getLayersByName("Hansen Legend").length>0&&app.mapPanel.map.removeLayer(hansenLegendLayer),1==ghan.getVisibility()&&(rulesForLegend2=[],1==curLanguage&&(hansenLegendLayer.name="Basemap: Forest Change 2000-2012",rulesForLegend2.push(new OpenLayers.Rule({title:"Not Forested",maxScaleDenominator:3e9,symbolizer:{fillColor:"#000000"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Forested in 2000",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Loss between 2000 and 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Gain between 2000 and 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Both Loss and Gain",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}}))),2==curLanguage&&(hansenLegendLayer.name="Basemap: Cambio Forestal 2000-2012",rulesForLegend2.push(new OpenLayers.Rule({title:"No forestada",maxScaleDenominator:3e9,symbolizer:{fillColor:"#000000"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Boscosa en 2000",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"P\xc3\xa9rdida entre 2000 y 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Aumenta entre 2000 y 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),rulesForLegend2.push(new OpenLayers.Rule({title:"Ambos p\xc3\xa9rdida y aumenta ",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}}))),hansenLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:rulesForLegend2})}),app.mapPanel.map.addLayer(hansenLegendLayer),hansenLegendLayer.name="Hansen Legend")}function c(){colorSchemeLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:h})}),app.mapPanel.map.getLayersByName("Color By Attribute Scheme").length>0&&app.mapPanel.map.removeLayer(colorSchemeLegendLayer),colorSchemeOn&&1==curLanguage&&(colorSchemeLegendLayer.name="Data Layer Colored By: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName),colorSchemeOn&&2==curLanguage&&(colorSchemeLegendLayer.name="Capa de Datos Matizada por: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName);var a="Data Layer";2==curLanguage&&(a="Capa de Datos"),!colorSchemeOn|!fillOn&&(colorSchemeLegendLayer.name=a),app.mapPanel.map.addLayer(colorSchemeLegendLayer),colorSchemeLegendLayer.name="Color By Attribute Scheme"}function d(){if(app.mapPanel.map.getLayersByName("Prioritization Legend").length>0&&app.mapPanel.map.removeLayer(prioritizationLegendLayer),1==prioritizationLayer.getVisibility()){var a=[];1==curLanguage&&(prioritizationLegendLayer.name="Targeting:","compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id?(0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"Population Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),a.push(new OpenLayers.Rule({title:"Poverty Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),a.push(new OpenLayers.Rule({title:"Deforestation Risk Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),a.push(new OpenLayers.Rule({title:"Population and Poverty",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})),a.push(new OpenLayers.Rule({title:"Population and Deforestation Risk",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FFFF"}})),a.push(new OpenLayers.Rule({title:"Poverty and Deforestation Risk",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}})),a.push(new OpenLayers.Rule({title:"All Three Benefits",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"Population Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),a.push(new OpenLayers.Rule({title:"Poverty Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),a.push(new OpenLayers.Rule({title:"Population and Poverty",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"Population Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),a.push(new OpenLayers.Rule({title:"Deforestation Risk Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),a.push(new OpenLayers.Rule({title:"Population and Deforestation Risk",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"Poverty Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),a.push(new OpenLayers.Rule({title:"Deforestation Risk Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),a.push(new OpenLayers.Rule({title:"Poverty and Deforestation Risk",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})))):a.push(new OpenLayers.Rule({title:"Selected ( Population:"+Ext.getCmp("weight1").value+" Poverty:"+Ext.getCmp("weight2").value+" Deforestation Risk:"+Ext.getCmp("weight3").value+")",maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+selectedFillColor}}))),2==curLanguage&&(prioritizationLegendLayer.name="Focalizaci\xc3\xb3n:","compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id?(0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Carbono",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Hidrol\xc3\xb3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),a.push(new OpenLayers.Rule({title:"Carbono y Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})),a.push(new OpenLayers.Rule({title:"Carbono y Hidrol\xc3\xb3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FFFF"}})),a.push(new OpenLayers.Rule({title:"Biodiversidad y Hidrol\xc3\xb3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}})),a.push(new OpenLayers.Rule({title:"Todos Tres Beneficios",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Carbono",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),a.push(new OpenLayers.Rule({title:"Carbono y Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Carbono",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Hidrol\xc3\xb3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),a.push(new OpenLayers.Rule({title:"Carbono y Hidrol\xc3\xb3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),a.push(new OpenLayers.Rule({title:"S\xc3\xb3lo Hidrol\xc3\xb3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),a.push(new OpenLayers.Rule({title:"Biodiversidad y Hidrol\xc3\xb3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})))):a.push(new OpenLayers.Rule({title:"Seleccionado ("+Ext.getCmp("weight1").value+"/"+Ext.getCmp("weight2").value+"/"+Ext.getCmp("weight3").value+")",maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+selectedFillColor}}))),prioritizationLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:a})}),app.mapPanel.map.addLayer(prioritizationLegendLayer),prioritizationLegendLayer.name="Prioritization Legend"}}function e(){var a=function(){var a="";Ext.getCmp("numQuantiles").setValue(parseInt(Ext.getCmp("numQuantiles").getValue())),Ext.getCmp("numQuantiles").getValue()>0||Ext.getCmp("numQuantiles").setValue("10");var b=parseInt(Ext.getCmp("numQuantiles").getValue());thresholds=[];for(var c=1;b>c;c++){userLayerActive?i.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getQuantile_userdata&viewparams=theAttribute:"+f+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName:i.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getQuantile_aldea&viewparams=theAttribute:"+f+";dataSource:"+dataSourceName,i.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:"+var1LowerThreshold+";var1UpperThreshold:"+var1UpperThreshold+";var2LowerThreshold:"+var2LowerThreshold+";var2UpperThreshold:"+var2UpperThreshold+";var3LowerThreshold:"+var3LowerThreshold+";var3UpperThreshold:"+var3UpperThreshold,i.url+=";percentage:"+c/b;var d=OpenLayers.Request.issue(i);null!=d.responseXML.documentElement.lastChild.firstChild.firstChild?thresholds.push(parseFloat(d.responseXML.documentElement.lastChild.firstChild.firstChild.textContent)):thresholds.push(0)}var e="<ogc:Filter><ogc:Not><ogc:PropertyIsNull><ogc:PropertyName>"+f+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Not></ogc:Filter>";a+="<sld:Rule><Title>Below "+thresholds[0].toPrecision(4)+"</Title>"+e+"<ogc:Filter><ogc:PropertyIsLessThan><ogc:PropertyName>"+f+"</ogc:PropertyName><ogc:Literal>"+thresholds[0]+'</ogc:Literal></ogc:PropertyIsLessThan></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&h.push(new OpenLayers.Rule({title:"Below "+(thresholds[0]*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),2==curLanguage&&h.push(new OpenLayers.Rule({title:"Menos de "+(thresholds[0]*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),linesOn&&(a+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>";for(var c=1;b-1>c;c++)a+="<sld:Rule><Title>["+thresholds[c-1].toPrecision(4)+", "+thresholds[c].toPrecision(4)+"]</Title>"+e+"<ogc:Filter><ogc:And>",h.push(new OpenLayers.Rule({title:"["+(thresholds[c-1]*g).toPrecision(4)+", "+(thresholds[c]*g).toPrecision(4)+"]"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e8,symbolizer:{fillColor:mixLowAndHighColors(c/(b-1))}})),a+="<ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+f+"</ogc:PropertyName><ogc:Literal>"+thresholds[c-1]+"</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo>",a+="<ogc:PropertyIsLessThan><ogc:PropertyName>"+f+"</ogc:PropertyName><ogc:Literal>"+thresholds[c]+"</ogc:Literal></ogc:PropertyIsLessThan>",a+='</ogc:And></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">'+mixLowAndHighColors(c/(b-1))+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(a+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>";return a+="<sld:Rule><Title>At least "+thresholds[b-2].toPrecision(4)+"</Title>"+e+"<ogc:Filter><ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+f+"</ogc:PropertyName><ogc:Literal>"+thresholds[b-2]+'</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&h.push(new OpenLayers.Rule({title:(thresholds[b-2]*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+" and above",maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),2==curLanguage&&h.push(new OpenLayers.Rule({title:"M\xc3\xa1s de "+(thresholds[b-2]*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),linesOn&&(a+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>"},b=function(){var a="";userLayerActive?i.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_userdata&viewparams=theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName:i.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_aldeas&viewparams=theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";dataSource:"+dataSourceName,i.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:"+var1LowerThreshold+";var1UpperThreshold:"+var1UpperThreshold+";var2LowerThreshold:"+var2LowerThreshold+";var2UpperThreshold:"+var2UpperThreshold+";var3LowerThreshold:"+var3LowerThreshold+";var3UpperThreshold:"+var3UpperThreshold;var b=OpenLayers.Request.issue(i);if(null!=b.responseXML.documentElement.lastChild.firstChild.firstChild)var c=Number(b.responseXML.documentElement.lastChild.firstChild.firstChild.textContent),d=Number(b.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.textContent),e=Number(b.responseXML.documentElement.lastChild.firstChild.lastChild.textContent);else c=0,d=.5,e=1;var j="<ogc:Filter><ogc:Not><ogc:PropertyIsNull><ogc:PropertyName>"+f+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Not></ogc:Filter>";return a+="<sld:Rule>"+j+'<PolygonSymbolizer><Fill><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill"><ogc:Function name="Interpolate"><ogc:PropertyName>'+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+"</ogc:PropertyName>",a+="<ogc:Literal>"+c+"</ogc:Literal><ogc:Literal>#"+lowColor+"</ogc:Literal>",1==curLanguage&&h.push(new OpenLayers.Rule({title:"Low Value: "+(c*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),2==curLanguage&&h.push(new OpenLayers.Rule({title:"Valor Bajo: "+(c*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),a+="<ogc:Literal>"+d+"</ogc:Literal><ogc:Literal>"+mixLowAndHighColors(.5)+"</ogc:Literal>",1==curLanguage&&h.push(new OpenLayers.Rule({title:" Middle Value: "+(d*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:mixLowAndHighColors(.5)}})),2==curLanguage&&h.push(new OpenLayers.Rule({title:" Valor Medio: "+(d*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:mixLowAndHighColors(.5)}})),a+="<ogc:Literal>"+e+"</ogc:Literal><ogc:Literal>#"+highColor+"</ogc:Literal>",a+="<ogc:Literal>color</ogc:Literal><ogc:Literal>cubic</ogc:Literal></ogc:Function>",1==curLanguage&&h.push(new OpenLayers.Rule({title:"High Value: "+(e*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),2==curLanguage&&h.push(new OpenLayers.Rule({title:"Valor Alto: "+(e*g).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),a+='</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(a+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>"},c=function(){var a="";userLayerActive?i.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_userdata&viewparams=theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName:i.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_aldeas&viewparams=theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";dataSource:"+dataSourceName,i.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:"+var1LowerThreshold+";var1UpperThreshold:"+var1UpperThreshold+";var2LowerThreshold:"+var2LowerThreshold+";var2UpperThreshold:"+var2UpperThreshold+";var3LowerThreshold:"+var3LowerThreshold+";var3UpperThreshold:"+var3UpperThreshold;var b=OpenLayers.Request.issue(i);if(null!=b.responseXML.documentElement.lastChild.firstChild.firstChild)var c=Number(b.responseXML.documentElement.lastChild.firstChild.firstChild.textContent),d=Number(b.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.textContent),e=Number(b.responseXML.documentElement.lastChild.firstChild.lastChild.textContent);else c=0,d=.5,e=1;Ext.getCmp("numQuantiles").setValue(parseInt(Ext.getCmp("numQuantiles").getValue())),Ext.getCmp("numQuantiles").getValue()>0||Ext.getCmp("numQuantiles").setValue("10");for(var j=parseInt(Ext.getCmp("numQuantiles").getValue()),k=function(a,b,c){var d=(b-a)/c;return Array.apply(null,Array(c+1)).map(function(b,c){return a+c*d})},l=k(c,e,j),m="<ogc:Filter><ogc:Not><ogc:PropertyIsNull><ogc:PropertyName>"+f+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Not></ogc:Filter>",n=0;j>n;n++)a+="<sld:Rule><Title>["+l[n].toPrecision(4)+", "+l[n+1].toPrecision(4)+"]</Title>"+m+"<ogc:Filter><ogc:And>",h.push(new OpenLayers.Rule({title:"["+(l[n]*g).toPrecision(4)+", "+(l[n+1]*g).toPrecision(4)+"]"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e8,symbolizer:{fillColor:mixLowAndHighColors(n/(j-1))}})),a+="<ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+f+"</ogc:PropertyName><ogc:Literal>"+l[n]+"</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo>",a+="<ogc:PropertyIsLessThan><ogc:PropertyName>"+f+"</ogc:PropertyName><ogc:Literal>"+l[n+1]+"</ogc:Literal></ogc:PropertyIsLessThan>",a+='</ogc:And></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">'+mixLowAndHighColors(n/(j-1))+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(a+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>";return a+="<sld:Rule><Title>At least "+l[j].toPrecision(4)+"</Title>"+m+"<ogc:Filter><ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+f+"</ogc:PropertyName><ogc:Literal>"+l[j]+'</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(a+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>"},d=function(a){var b="";return b+=a(),Ext.getCmp("chkNull").checked&&(b+="<sld:Rule><sld:Title>Conservation ROI Layer (null values)</sld:Title><ogc:Filter><ogc:PropertyIsNull><ogc:PropertyName>"+f+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Filter><PolygonSymbolizer>",fillOn&&(b+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(b+="<sld:Stroke/>"),b+="</PolygonSymbolizer></sld:Rule>",1==curLanguage&&h.push(new OpenLayers.Rule({title:" Null Values: ",maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+defaultColor}})),2==curLanguage&&h.push(new OpenLayers.Rule({title:" Valores Nulos: ",maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+defaultColor}}))),b},e=function(){return j="",j+="<sld:Rule><sld:Title>Conservation ROI Layer</sld:Title><PolygonSymbolizer>",fillOn&&(j+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(j+="<sld:Stroke/>"),j+="</PolygonSymbolizer></sld:Rule>",fillOn&&h.push(new OpenLayers.Rule({title:Ext.getCmp("datasource").getRawValue(),maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+defaultColor}})),fillOn||h.push(new OpenLayers.Rule({title:Ext.getCmp("datasource").getRawValue(),maxScaleDenominator:3e9,symbolizer:{fillColor:"#ffffff"}})),j},k=function(a){var b='<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>'+dataSourceLayerName+"</sld:Name><sld:UserStyle><sld:FeatureTypeStyle>";return b+=a,b+="</sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>"};return!colorSchemeOn|!fillOn?k(e()):1==Ext.getCmp("methodCombo").selectedIndex&colorSchemeOn&fillOn?k(d(a)):Ext.getCmp("methodCombo").selectedIndex<1&colorSchemeOn&fillOn?k(d(b)):2==Ext.getCmp("methodCombo").selectedIndex&colorSchemeOn&fillOn?k(d(c)):void 0}0==Ext.getCmp("colorAttribute").getSelectionModel().selections.items.length&&Ext.getCmp("colorAttribute").getSelectionModel().selectRow(0);var f=Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name,g=1;"risk"==f&&(g=100);var h=[],i={method:"GET",async:!1},j=e();updateDataLayerParams(),dataLayer.mergeNewParams({sld_body:j}),a(),b(),c(),d()}function updatePrioritization(){var a=prioritizationLayer.visibility;prioritizationLayer.setVisibility(!1);var b="data_prioritize_aldeas";if(userLayerActive&&(b+="_userdata"),priorityParams="dataSource:"+dataSourceName,userLayerActive&&(priorityParams+=";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName),(userLayerActive||1==dataSourceNum||2==dataSourceNum)&&(priorityParams+=";predAcessCode:519"),priorityParams+=";locationParam:"+locationParamName+";budgetMax:",Ext.getCmp("rawRadio").getValue()?priorityParams+=Ext.getCmp("budget_raw").value:Ext.getCmp("percentileRadio").getValue()?priorityParams+="1.1*(SELECT MAX(cumcost) FROM BenefitBudget)":priorityParams+=Ext.getCmp("budget_percentage").value/100+"*(SELECT MAX(cumcost) FROM BenefitBudget)",priorityParams+=";percentileCutoff:",Ext.getCmp("percentileRadio").getValue()?priorityParams+=(100-Ext.getCmp("benefit_percentile").value)/100:priorityParams+="0",priorityParams+=";"+whereClauseStr+";"+inClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:"+var1LowerThreshold+";var1UpperThreshold:"+var1UpperThreshold+";var2LowerThreshold:"+var2LowerThreshold+";var2UpperThreshold:"+var2UpperThreshold+";var3LowerThreshold:"+var3LowerThreshold+";var3UpperThreshold:"+var3UpperThreshold,Ext.getCmp("chkRisk").getValue()?priorityParams+=";riskVar:risk":priorityParams+=";riskVar:1",Ext.getCmp("chkCost").getValue()?priorityParams+=";costVar:cost":priorityParams+=";costVar:1",3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(priorityParams+=";carbonVar:"+Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field1+";bioVar:"+Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field1),"compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id)prioritizationLayer.mergeNewParams({sld_body:null}),-1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(Ext.getCmp("compareObjectiveCombo").selectedIndex=0),0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CBH"}),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CB"}),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CH"}),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_BH"});else{"combineTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id&&(priorityParams+=";weight1:"+Ext.getCmp("weight1").value,priorityParams+=";weight2:"+Ext.getCmp("weight2").value,priorityParams+=";weight3:"+Ext.getCmp("weight3").value);var c="";userLayerActive&&(c="_userdata"),prioritizationLayer.mergeNewParams({sld_body:'<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>'+workspaceName+":data_prioritize"+c+"</sld:Name><sld:UserStyle><sld:Name>"+workspaceName+":data_prioritize_Default"+c+'</sld:Name><sld:Title/><sld:FeatureTypeStyle><sld:Rule><sld:Title>Polygon</sld:Title><ogc:Filter><ogc:PropertyIsNull><ogc:PropertyName>compositeecb</ogc:PropertyName></ogc:PropertyIsNull></ogc:Filter><sld:PolygonSymbolizer><sld:Fill><sld:CssParameter name="fill">#ffffff</sld:CssParameter></sld:Fill><sld:Stroke/></sld:PolygonSymbolizer></sld:Rule><sld:Rule><sld:Title>Polygon</sld:Title><ogc:Filter><ogc:And><ogc:Not><ogc:PropertyIsNull><ogc:PropertyName>compositeecb</ogc:PropertyName></ogc:PropertyIsNull></ogc:Not><ogc:PropertyIsEqualTo><ogc:PropertyName>selected</ogc:PropertyName><ogc:Literal>1</ogc:Literal></ogc:PropertyIsEqualTo></ogc:And></ogc:Filter><sld:PolygonSymbolizer><sld:Fill><sld:CssParameter name="fill">#'+selectedFillColor+"</sld:CssParameter></sld:Fill><sld:Stroke/></sld:PolygonSymbolizer></sld:Rule></sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>"})}prioritizationLayer.mergeNewParams({layers:b,viewparams:priorityParams}),0==app.mapPanel.map.getLayersByName("Prioritization Layer").length&&(app.mapPanel.map.getLayersByName("Selection").length>0&&app.mapPanel.map.removeLayer(selectLayer),app.mapPanel.map.addLayer(prioritizationLayer),app.mapPanel.map.addLayer(selectLayer)),prioritizationLayer.setVisibility(a),prioritizationLayer.redraw(),updateStyling()}function setDataSource(a){idAttribute="fctt_id",1==a&&(dataSourceName="mredd",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="nom_na",locationData=[[0,"Study Area"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoac\xc3\xa1n/Mexico"],[5,"Yucut\xc3\xa1n"],[6,"Chihuahua"]],spanishLocationData=[[0,"Zona de AATRs"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoac\xc3\xa1n/Mexico"],[5,"Yucut\xc3\xa1n"],[6,"Chihuahua"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide()),2==a&&(dataSourceName="mex_pred",userLayerActive=!1,locationParamName="region",nameAttribute="nombpred",userLayerActive=!1,locationData=[[0,"Entire Country"],[1,"North West"],[2,"North"],[3,"North East"],[4,"Central West"],[5,"Central South"],[6,"South Pacific"],[7,"Gulf"],[8,"Peninsula"]],spanishLocationData=[[0,"Pa\xc3\xads \xc3\x8dntegro"],[1,"Noroeste"],[2,"Norte"],[3,"Nordeste"],[4,"Centro-Oeste"],[5,"Centro Sur"],[6,"Pacifico Sur"],[7,"Golfo"],[8,"Pen\xc3\xadnsula"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide()),3==a&&(dataSourceName="ca_10km",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xc3\xadses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show()),4==a&&(dataSourceName="ca_1km",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xc3\xadses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),
1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show()),5==a&&(dataSourceName="aldeas",userLayerActive=!1,locationParamName="dprtmnt_id",nameAttribute="",locationData=[[0,"All Departmentos"],[1,"Atlandtida"],[2,"Choluteca"],[3,"Colon"],[4,"Comayagua"],[5,"Copan"],[6,"Cortes"],[7,"El Paraiso"],[8,"Francisco Moraza"],[9,"Gracias a Dios"],[10,"Intubuca"],[11,"Islas de le Bahia"],[12,"La Paz"],[13,"Lempira"],[14,"Ocotepeque"],[15,"Olancho"],[16,"Santa Barbara"],[17,"Valle"],[18,"Yoro"]],spanishLocationData=[[0,"All Departmentos"],[1,"Atlandtida"],[2,"Choluteca"],[3,"Colon"],[4,"Comayagua"],[5,"Copan"],[6,"Cortes"],[7,"El Paraiso"],[8,"Francisco Moraza"],[9,"Gracias a Dios"],[10,"Intubuca"],[11,"ISLAS DE LA BAHIA"],[12,"La Paz"],[13,"Lempira"],[14,"Ocotepeque"],[15,"Olancho"],[16,"Santa Barbara"],[17,"Valle"],[18,"Yoro"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show()),a>5&&(dataSourceName=phpVarDataSetList[a-numOnBoardDataSets],userDataSourceUOA=phpVarDataSetUOA[a-numOnBoardDataSets],userLayerActive=!0,locationParamName="1",nameAttribute="",Ext.getCmp("adminSelect").hide(),locationData=[[0,"All"]],spanishLocationData=[[0,"Todos"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide()),dataSourceLayerName=userLayerActive?workspaceName+":userlayer_query":workspaceName+":"+dataSourceName+"_query",1==curLanguage&&(Ext.getCmp("regionSelectContainer").remove("regionSelectCheckBoxes"),Ext.getCmp("regionSelectContainer").add({id:"regionSelectCheckBoxes",xtype:"checkboxgroup",fieldLabel:"Regions",columns:1,items:[locationData.map(function(a,b,c){return{boxLabel:a[1],name:a[0]}})],listeners:{change:function(a){var b=this.getValue(),c=b.map(function(a,b,c){return a.name});-1===c.indexOf(0)?(whereClauseStr="whereParam:"+locationParamName+";whereValue:"+c.join("\\,"),inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams(),updatePrioritization()):(whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams(),updatePrioritization()),prioritizationLayer.setVisibility(!1),zoomToRegion(),updateStyling()}}}),Ext.getCmp("regionSelectContainer").doLayout(),regionSelectManager.bindStore(locationData)),2==curLanguage&&(Ext.getCmp("regionSelectContainer").remove("regionSelectCheckBoxes"),Ext.getCmp("regionSelectContainer").add({id:"regionSelectCheckBoxes",xtype:"checkboxgroup",fieldLabel:"Regions",columns:1,items:[locationData.map(function(a,b,c){return{boxLabel:a[1],name:a[0]}})],listeners:{change:function(a){var b=this.getValue(),c=b.map(function(a,b,c){return a.name});-1===c.indexOf(0)?(whereClauseStr="whereParam:"+locationParamName+";whereValue:"+c.join("\\,"),inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams(),updatePrioritization()):(whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams(),updatePrioritization()),prioritizationLayer.setVisibility(!1),zoomToRegion(),updateStyling()}}}),regionSelectManager.bindStore(spanishLocationData))}function updateLanguage(){if(0==phpVarIsLoggedIn&&Ext.getCmp("loginRegisterWindowBox").refreshMe("../../usersystem/splashscreen.php?lang="+curLanguage),1==phpVarIsLoggedIn&&0==Ext.getCmp("returnToFCTTItem").hidden&&(app.mapPanel.map.div.innerHTML="<iframe src='../../usersystem/userconsole.php?lang="+curLanguage+"' width = 100% height = 100%></iframe>"),1==curLanguage){Ext.getCmp("appTitle").setText("Forest Conservation Targeting Tool (Beta)"),Ext.getCmp("appCopyright").setText("\xc2\xa9 2016 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission."),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-625),window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-550),Ext.getCmp("howToItem").setText("How To"),Ext.getCmp("instructionsItem").setText("Instructions"),Ext.getCmp("descriptionItem").setText("Description"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("User Questions"),Ext.getCmp("emailItem").setText("Email"),Ext.getCmp("aboutItem").setText("About"),Ext.getCmp("metadataItem").setText("Metadata"),Ext.getCmp("sponsorsItem").setText("Sponsors"),Ext.getCmp("teamItem").setText("Team"),Ext.getCmp("emailItem2").setText("Email"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("User Questions"),Ext.getCmp("userCommentsItem").setText("User Comments"),Ext.getCmp("emailItem3").setText("Email"),1==phpVarIsLoggedIn?Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName):Ext.getCmp("loginItem").setText("Use your own data"),Ext.getCmp("userConsoleItem").setText("User Console"),Ext.getCmp("returnToFCTTItem").setText("Reload FCTT"),Ext.getCmp("logoutItem").setText("Logout"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>"),Ext.getCmp("regionPanel").setTitle("DEFINE STUDY AREA"),Ext.getCmp("datasetLabel").label.update("Dataset:"),loadUserLayers([[5,"Aldeas"]]),regionSelectManager.bindStore(locationData),regionSelectManager.setValue(regionSelectManager.getRegionName()),Ext.getCmp("thresholdLabel").label.update("Minimum forest cover:"),Ext.getCmp("adminSelect").setTitle("By administrative boundary"),Ext.getCmp("manuallySelect").setTitle("Using manual selection tool"),Ext.getCmp("selectionMode").label.update("Selection mode:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Polygon"],[2,"Box"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("DISPLAY OPTIONS"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),Ext.getCmp("shpLinesLabel").label.update("Shape lines"),Ext.getCmp("shpFillLabel").label.update("Shape fill"),Ext.getCmp("opacityLabel").label.update("Opacity"),Ext.getCmp("margLayerLabel").label.update("Marginality Layer"),Ext.getCmp("basemapLabel").label.update("Base map type"),Ext.getCmp("basemapCombo").bindStore([[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satellite"],[4,"OpenStreetMap"],[5,"Forest Change(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Show Scale"),Ext.getCmp("panZoomLabel").label.update("Pan/Zoom Tool"),Ext.getCmp("mouseWheelLabel").label.update("Mouse wheel zoom"),Ext.getCmp("colorByAttributePanel").setTitle("TARGETING DATA"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Low color</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">High color</div>'),Ext.getCmp("methodLabel").label.update("Method"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolate"],[1,"Quantiles"],[2,"Bins"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Quantiles");var a=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();Ext.getCmp("colorAttribute").store=prioritizationVariables,3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(a),Ext.getCmp("chkNullLabel").label.update("Show null values"),Ext.getCmp("chkNull").wrap.child(".x-form-cb-label").update("(in default color)"),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("selectPanel").setTitle("TARGET"),Ext.getCmp("chooseBenefits").setTitle("Choose Benefit Variables"),Ext.getCmp("carbonBenefitLabel").label.update("Population:"),Ext.getCmp("bioBenefitLabel").label.update("Poverty:"),Ext.getCmp("carbonBenefitChoose").bindStore([["totcsrs","Total Caserios"],["tthhldp","Total Households"]]),Ext.getCmp("carbonBenefitChoose").setValue(Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field2),Ext.getCmp("bioBenefitChoose").bindStore([["prcxtpr","Percent Extreme Poverty"],["prcrlpr","Percent Relative Poverty"]]),Ext.getCmp("bioBenefitChoose").setValue(Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field2),Ext.getCmp("compareTab").setTitle("Compare"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"All Benefits"],[1,"Population and Poverty"],[2,"Population and Deforestation Risk"],[3,"Poverty and Deforestation Risk"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),Ext.getCmp("chkRiskLabel").label.update(""),Ext.getCmp("chkCostLabel").label.update(""),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("printButton").setText("<div style='color:black;font-size: 12'>Print/PDF</div>"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>"),Ext.getCmp("resetLegend").setText("Reset Legend Position"),Ext.getCmp("exportPanel").setTitle("EXPORT"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Export Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Export CSV</div>"),"undefined"!=typeof instructionsWindowSp&&(instructionsWindowSp.hidden||(instructionsWindow.show(),instructionsWindowSp.hide())),Ext.getCmp("myLegend").setTitle("Legend")}if(2==curLanguage){Ext.getCmp("appTitle").setText("Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal (Beta)"),Ext.getCmp("appCopyright").setText("\xc2\xa9 2016 Resources for the Future. Reservados todos los derechos. Ninguna porci\xc3\xb3n de los datos o el modelo puede ser usado sin permiso."),window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-375),Ext.getCmp("howToItem").setText("C\xc3\xb3mo"),Ext.getCmp("instructionsItem").setText("Instrucciones"),Ext.getCmp("descriptionItem").setText("Descripci\xc3\xb3n"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("Preguntas de Usuarios"),Ext.getCmp("emailItem").setText("Correo"),Ext.getCmp("aboutItem").setText("Acerca de"),Ext.getCmp("metadataItem").setText("Metadatos"),Ext.getCmp("sponsorsItem").setText("Promotores"),Ext.getCmp("teamItem").setText("Equipo"),Ext.getCmp("emailItem2").setText("Correo"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("Preguntas de Usuarios"),Ext.getCmp("userCommentsItem").setText("Comentarios de Usuarios"),Ext.getCmp("emailItem3").setText("Correo"),1==phpVarIsLoggedIn?Ext.getCmp("loginItem").setText("Conectado como "+phpVarUserName):Ext.getCmp("loginItem").setText("Utilice sus propios datos"),Ext.getCmp("userConsoleItem").setText("Consola de Usuario"),Ext.getCmp("returnToFCTTItem").setText("Recargar FCTT"),Ext.getCmp("logoutItem").setText("Cerrar Sesi\xc3\xb3n"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Caja de Herramientas</div>"),Ext.getCmp("regionPanel").setTitle("DEFINIR \xc3\x81REA DE ESTUDIO"),Ext.getCmp("datasetLabel").label.update("Datos:"),loadUserLayers([[5,"Aldeas"]]),regionSelectManager.bindStore(spanishLocationData),regionSelectManager.setValue(regionSelectManager.getRegionName()),Ext.getCmp("thresholdLabel").label.update("Cubierta forestal m\xc3\xadnima:"),Ext.getCmp("adminSelect").setTitle("Por l\xc3\xadmites administrativos"),Ext.getCmp("manuallySelect").setTitle("Seleccionar manualmente"),Ext.getCmp("selectionMode").label.update("Modo de selecci\xc3\xb3n:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Pol\xc3\xadgono"],[2,"Caja"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("OPCIONES DE VISUALIZACI\xc3\u201cN"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Color de Relleno Defecto</div>'),Ext.getCmp("shpLinesLabel").label.update("L\xc3\xadneas poligonales"),Ext.getCmp("shpFillLabel").label.update("Relleno de forma"),Ext.getCmp("opacityLabel").label.update("Opacidad"),Ext.getCmp("margLayerLabel").label.update("Capa de Marginalidad"),Ext.getCmp("basemapLabel").label.update("Tipo de basemap"),Ext.getCmp("basemapCombo").bindStore([[0,"Ninguno"],[1,"Google F\xc3\xadsico"],[2,"Google H\xc3\xadbrido"],[3,"Google Sat\xc3\xa9lite"],[4,"OpenStreetMap"],[5,"Cambio Forestal(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Mostrar Escala"),Ext.getCmp("panZoomLabel").label.update("Ampliar/Recorrer"),Ext.getCmp("mouseWheelLabel").label.update("Zoom con rueda del mouse"),Ext.getCmp("colorByAttributePanel").setTitle("DATOS DE FOCALIZACI\xc3\u201cN"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("methodLabel").label.update("M\xc3\xa9todo"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolar"],[1,"Cuantilas"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Cuantilas");var a=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish,3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(a),Ext.getCmp("chkNullLabel").label.update("Mostrar val. nulos"),Ext.getCmp("chkNull").wrap.child(".x-form-cb-label").update("(en color defecto)"),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Actualizar Visualizaci\xc3\xb3n</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("selectPanel").setTitle("FOCALIZAR"),Ext.getCmp("chooseBenefits").setTitle("Elegir Variables de Beneficios"),Ext.getCmp("carbonBenefitLabel").label.update("Carbono:"),Ext.getCmp("bioBenefitLabel").label.update("Biodiversidad:"),Ext.getCmp("carbonBenefitChoose").bindStore([["carbon","Carbono no suelo"],["carbon_total","Carbono total"],["carbon_soil","Carbono en el suelo"]]),Ext.getCmp("carbonBenefitChoose").setValue(Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field2),Ext.getCmp("bioBenefitChoose").bindStore([["bio","RWRI Global"],["bio_loc","RWRI Nacional"],["bio_count","N\xc3\xbam. esp. amenazadas"]]),Ext.getCmp("bioBenefitChoose").setValue(Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field2),Ext.getCmp("priorityBudget").setTitle("Elegir Presupuesto"),Ext.getCmp("percentageRadio").el.next("label").update("Porcentaje del total:"),Ext.getCmp("rawRadio").el.next("label").update("Prima:"),Ext.getCmp("combineTab").setTitle("Ponderar Beneficios"),Ext.getCmp("carbonweightfield").label.update('<div style="color: green; font-weight: bold">Carbono:</div>'),Ext.getCmp("bioweightfield").label.update('<div style="color: red; font-weight: bold">Biodiversidad:</div>'),Ext.getCmp("hydroweightfield").label.update('<div style="color: blue; font-weight: bold">Hidrol\xc3\xb3gico:</div>'),Ext.getCmp("compareTab").setTitle("Comparar"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"Todos Beneficios"],[1,"Carbono y Biodiversidad"],[2,"Carbon y Hidrol\xc3\xb3gico"],[3,"Biodiversidad y Hidrol\xc3\xb3gico"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("chkRiskLabel").label.update("Incluir riesgo de deforestaci\xc3\xb3n"),Ext.getCmp("chkCostLabel").label.update("Incluir costo"),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Entregar/Actualizar</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("printButton").setText("<div style='color:black;font-size: 12'>Imprimir/PDF</div>"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Restablecer Todo</div>"),Ext.getCmp("resetLegend").setText("Restablecer Leyenda"),Ext.getCmp("exportPanel").setTitle("EXPORTAR"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Exportar Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Exportar CSV</div>"),"undefined"!=typeof instructionsWindow&&(instructionsWindow.hidden||(instructionsWindow.hide(),instructionsWindowSp.show())),Ext.getCmp("myLegend").setTitle("Leyenda")}updateStyling(),updateOnZoom(app.mapPanel.map.getZoom())}function updateSelectionButtonLanguage(){1==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selecci\xc3\xb3n</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),"<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Clear/Cancel</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>")),2==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selecci\xc3\xb3n</div>"),"<div style='color:black;font-size: 12'>Clear/Cancel</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"))}function roundDecimal(a,b){return a.toFixed(b)}function componentToHex(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function hexToRgb(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}function mixLowAndHighColors(a){var b=Math.floor(a*hexToRgb(highColor).r+(1-a)*hexToRgb(lowColor).r),c=Math.floor(a*hexToRgb(highColor).g+(1-a)*hexToRgb(lowColor).g),d=Math.floor(a*hexToRgb(highColor).b+(1-a)*hexToRgb(lowColor).b);return rgbToHex(b,c,d)}function openPage(a,b){new Ext.Window({title:b,width:.8*window.innerWidth,height:.9*window.innerHeight,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:a}}]}).show()}function zoomToRegion(){var a={method:"GET",async:!1};userLayerActive?a.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents_userdata&viewparams=layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName:a.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents&viewparams=dataSource:"+dataSourceName,a.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:"+var1LowerThreshold+";var1UpperThreshold:"+var1UpperThreshold+";var2LowerThreshold:"+var2LowerThreshold+";var2UpperThreshold:"+var2UpperThreshold+";var3LowerThreshold:"+var3LowerThreshold+";var3UpperThreshold:"+var3UpperThreshold;var b=OpenLayers.Request.issue(a),c=new OpenLayers.Bounds;null!=b.responseXML.documentElement.lastChild.firstChild.firstChild?(c.left=Number(b.responseXML.documentElement.lastChild.firstChild.firstChild.textContent),c.right=Number(b.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.textContent),c.top=Number(b.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.nextSibling.textContent),c.bottom=Number(b.responseXML.documentElement.lastChild.firstChild.lastChild.textContent)):(c.left=-92.2223587033315,c.right=-68.3226394649928,c.top=5.49902677495186,c.bottom=19.9323616027744),app.mapPanel.map.zoomToExtent(c.transform("EPSG:4326","EPSG:900913"),!1)}function resetLegendPosition(){myLegend.show();var a=app.mapPanel.el.getTop()+5;myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,a]),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-625),1==curLanguage&&window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-550),2==curLanguage&&window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-375)}function updateOnZoom(a){8>a&&4==dataSourceNum&&(1==curLanguage&&(imgZoomEng.style.visibility="visible",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="visible"),dataLayer.setVisibility(!1)),(a>=8||4!=dataSourceNum)&&(1==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),dataLayer.setVisibility(!0)),a>9&&1==ghan.getVisibility()&&(ghan.setVisibility(!1),ghanActive=!0),9>=a&&1==ghanActive&&ghan.setVisibility(!0),a>18&&1==gosm.getVisibility()&&(gosm.setVisibility(!1),gosmActive=!0),18>=a&&1==gosmActive&&gosm.setVisibility(!0)}function updateDataLayerParams(){var a=inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:"+var1LowerThreshold+";var1UpperThreshold:"+var1UpperThreshold+";var2LowerThreshold:"+var2LowerThreshold+";var2UpperThreshold:"+var2UpperThreshold+";var3LowerThreshold:"+var3LowerThreshold+";var3UpperThreshold:"+var3UpperThreshold;userLayerActive&&(a+=";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName),(userLayerActive||1==dataSourceNum||2==dataSourceNum)&&(a+=";predAcessCode:519"),dataLayer.mergeNewParams({layers:dataSourceLayerName,viewparams:a})}function loadUserLayers(a){if(1==phpVarIsLoggedIn){phpVarNumDataSets>0&&a.push([-1,"----------------------"]);for(var b=1;b<=phpVarNumDataSets;b++){var c=b+numOnBoardDataSets;a.push([c.toString(),phpVarDataSetList[b]])}}Ext.getCmp("datasource").bindStore(a),Ext.getCmp("datasource").setValue(Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field2)}function featuresFromXY(a){var b=app.mapPanel.map.getLonLatFromPixel(a);b.transform("EPSG:900913","EPSG:4326");var c={method:"GET",async:!1};userLayerActive?c.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_userdata&viewparams=layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName:3==dataSourceNum||4==dataSourceNum||5==dataSourceNum?c.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_mex&viewparams=layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName:c.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo&viewparams=dataSource:"+dataSourceName,c.url+=";latCoord:"+b.lat+";lonCoord:"+b.lon;var d=OpenLayers.Request.issue(c),e=new OpenLayers.Format.GML({extractAttributes:!0}),f=e.read(d.responseText);return f}if("undefined"==typeof phpVarUserName)var phpVarUserName="notloggedin",phpVarlayerPIN="notloggedin";Ext.BLANK_IMAGE_URL="ext/resources/images/default/s.gif";var app,items=[],controls=[],toolItems=[],lowColor="0000FF",highColor="FF0000",defaultColor="003300",selectedFillColor="e2ff00",linesOn=!1,fillOn=!0,colorSchemeOn=!1,navigationMode=!0,tilesLeftToLoad=1,inClauseStr="idAttribute:1;inSet:1";whereClauseStr="whereParam:1;whereValue:1",priorityParams="",selectMode=1,ghanActive=!1,gosmActive=!1,forestThreshold=25,var1LowerThreshold=0,var1UpperThreshold=580,var2LowerThreshold=0,var2UpperThreshold=100,var3LowerThreshold=0,var3UpperThreshold=1;var regionSelectModel={value:0,index:0,locationData:[],getValue:function(){return this.value},getSelectedIndex:function(){return this.index},getNumericIndex:function(){return this.locationData[this.index][0]},getRegionName:function(){return this.locationData[this.index][1]},setValue:function(a){this.value=a},setSelectedIndex:function(a){this.index=a},bindStore:function(a){this.locationData=a}},regionSelectManager={getSelectedIndex:function(){return regionSelectModel.getSelectedIndex()},getNumericIndex:function(){return regionSelectModel.getNumericIndex()},getRegionName:function(){return regionSelectModel.getRegionName()},setValue:function(a){regionSelectModel.setValue(a)},setSelectedIndex:function(a){regionSelectModel.setSelectedIndex(a)},bindStore:function(a){regionSelectModel.bindStore(a)}},curLanguage=1,userLayerActive=!1,locationParamName,nameAttribute,locationData,spanishLocationData,idAttribute,workspaceName="forestro_users_ws",dataSourceName="aldeas",dataSourceLayerName="aldeas_query",userDataSourceUOA="",topBarHeight=40,imgWait=document.createElement("IMG");imgWait.src="images/loading.gif",imgWait.style.pointerEvents="none",imgWait.style.position="absolute",imgWait.style.top=225,imgWait.style.left=450,imgWait.style.zIndex=9999,imgWait.style.visibility="hidden";var imgZoomEng=document.createElement("IMG");imgZoomEng.src="images/zoomin_english.gif",imgZoomEng.style.pointerEvents="none",imgZoomEng.style.position="absolute",imgZoomEng.style.top=225,imgZoomEng.style.left=450,imgZoomEng.style.zIndex=9998,imgZoomEng.style.visibility="hidden";var imgZoomSpan=document.createElement("IMG");imgZoomSpan.src="images/zoomin_spanish.gif",imgZoomSpan.style.pointerEvents="none",imgZoomSpan.style.position="absolute",imgZoomSpan.style.top=225,imgZoomSpan.style.left=450,imgZoomSpan.style.zIndex=9998,imgZoomSpan.style.visibility="hidden";var numOnBoardDataSets=6,dataSourceNum=5,instructionsWindow=new Ext.Window({title:"Instructions",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define.html"}}],listeners:{minimize:{fn:function(){instructionsWindow.hide()}}}}),instructionsWindowSp=new Ext.Window({title:"Instrucciones",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define_sp.html"}}],listeners:{minimize:{fn:function(){instructionsWindowSp.hide()}}}}),loginRegisterWindow=new Ext.Window({width:.8*(window.innerWidth-0),height:.85*(window.innerHeight-topBarHeight),x:.1*(window.innerWidth-0)+0,y:.1*(window.innerHeight-topBarHeight)+topBarHeight,resizable:!1,draggable:!0,closable:!1,minimizable:!1,anchor:!0,frame:!1,shadow:!1,border:!0,bodyStyle:"opacity:1;",layout:"vbox",listeners:{minimize:function(){loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable()}},tools:[{id:"bigminimize",qtip:"Minimize",handler:function(a,b,c){loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable()}}],items:[{xtype:"box",id:"loginRegisterWindowBox",width:.8*(window.innerWidth-0),height:.85*(window.innerHeight-topBarHeight),margin:10,autoEl:{tag:"iframe",frameborder:0,src:"../../usersystem/splashscreen.php?lang="+curLanguage},refreshMe:function(a){var b;(b=this.el)&&(b.dom.src=a||this.imageSrc)},listeners:{render:function(){this.refreshMe()}}}]});Ext.onReady(function(){app=new Ext.Viewport({layout:"border",id:"app",border:0,items:[topbar,toolpanel,map,bottombar]}),setDataSource(dataSourceNum),Ext.getCmp("optionsPanel").collapse(),Ext.getCmp("colorByAttributePanel").collapse(),Ext.getCmp("selectPanel").collapse(),myLegend.show(),myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,app.mapPanel.el.getTop()+5]),regionSelectManager.setValue(0),regionSelectManager.setSelectedIndex(0),Ext.getCmp("datasource").selectedIndex=0,Ext.getCmp("selectModeCombo").selectedIndex=0,Ext.getCmp("basemapCombo").selectedIndex=1,Ext.getCmp("methodCombo").selectedIndex=0,Ext.getCmp("compareObjectiveCombo").selectedIndex=0,Ext.getCmp("carbonBenefitChoose").selectedIndex=0,Ext.getCmp("bioBenefitChoose").selectedIndex=0,Ext.getCmp("topBar").getEl().dom.style.background="#4682B4";var a={method:"GET",async:!1},b="conservationroi.net";phpVarIsLocalHost&&(b="localhost"),a.url="../geoserver/wms?request=GetCapabilities";OpenLayers.Request.issue(a);curLanguage=phpVarLanguageToLoadIn,updateLanguage(),1==curLanguage&&Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName),2==curLanguage&&Ext.getCmp("loginItem").setText("Conectado como "+phpVarUserName),
Ext.getCmp("loginItem").show(),Ext.getCmp("returnToFCTTItem").hide(),Ext.getCmp("userConsoleItem").show(),Ext.getCmp("logoutItem").show(),Ext.getCmp("loginItem").getEl().removeClass("hidearrow"),app.mapPanel.map.addLayer(marginalityLayer),app.mapPanel.map.addLayer(dataLayer),app.mapPanel.map.addLayer(selectLayer),1==phpVarIsLoggedIn||(loginRegisterWindow.show(),loginRegisterWindow.hide(),1==curLanguage&&Ext.getCmp("loginItem").setText("Use your own data"),2==curLanguage&&Ext.getCmp("loginItem").setText("Utilice sus propios datos"),Ext.getCmp("userConsoleItem").hide(),Ext.getCmp("logoutItem").hide(),Ext.getCmp("loginItem").getEl().addClass("hidearrow")),registerEvents(dataLayer),registerEvents(prioritizationLayer),imgWait.style.top=(parseInt(app.mapPanel.body.dom.style.height)-128)/2,imgWait.style.left=(parseInt(app.mapPanel.body.dom.style.width)-128)/2,document.getElementById("map").appendChild(imgWait),imgZoomEng.style.top=50,imgZoomEng.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomEng),imgZoomSpan.style.top=50,imgZoomSpan.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomSpan),updateLanguage(),app.mapPanel.map.addControl(infoClick),infoClick.activate(),app.mapPanel.map.addControl(infoHover),infoHover.deactivate(),gphy.setVisibility(!0),ghyb.setVisibility(!1),gsat.setVisibility(!1),gosm.setVisibility(!1),ghan.setVisibility(!1),marginalityLayer.setVisibility(!1),prioritizationLayer.setVisibility(!1),updateStyling(),myLegend.syncShadow()}),Ext.chromeVersion=Ext.isChrome?parseInt(/chrome\/(\d{2})/.exec(navigator.userAgent.toLowerCase())[1],10):NaN,Ext.grid.ColumnModel.override({getTotalWidth:function(a){if(!this.totalWidth){var b=Ext.isChrome&&Ext.chromeVersion>18?2:0;this.totalWidth=0;for(var c=0,d=this.config.length;d>c;c++)(a||!this.isHidden(c))&&(this.totalWidth+=this.getColumnWidth(c)+b)}return this.totalWidth}});var hostName="conservationroi.net";phpVarIsLocalHost&&(hostName="localhost"),printURL="http://registereduser:"+phpVarGeoServerLogin+"@"+hostName+":/geoserver/pdf";var printProvider=new GeoExt.data.PrintProvider({url:printURL,method:"POST",capabilities:printCapabilities,timeout:1e5,customParams:{mapTitle:"",comment:""}});printPage=new GeoExt.data.PrintPage({printProvider:printProvider});var dpi=printProvider.dpis.getAt(printProvider.dpis.totalLength-1);printProvider.setDpi(dpi);var myLegend=new Ext.Window({id:"myLegend",title:"Legend",width:250,collapsible:!0,autoScroll:!0,layout:"anchor",closable:!1,monitorResize:!0,items:[legendPanel=new GeoExt.LegendPanel({defaults:{labelCls:"mylabel",style:"padding:5px",baseParams:{legend_options:"forceLabels:on"}},preferredTypes:["gx_vectorlegend"],dynamic:!0,bodyStyle:"padding:5px",autoScroll:!0,region:"west"})]}),gphy=new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),ghyb=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gsat=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gosm=new OpenLayers.Layer.OSM("OpenStreetMap",["http://otile1.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png"]),ghan=new OpenLayers.Layer.XYZ("Hansen Forest Cover","http://earthengine.google.org/static/hansen_2013/loss_forest_gain/${z}/${x}/${y}.png",{sphericalMercator:!0,attribution:"Hansen et al. 2014",isBaseLayer:!0}),dataLayer=new OpenLayers.Layer.WMS("Data Layer","/geoserver/wms",{layers:dataSourceLayerName,transparent:!0},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,opacity:.65,displayInLayerSwitcher:!1,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),marginalityLayer=new OpenLayers.Layer.WMS("Data Layer","/geoserver/wms",{layers:"forestro_users_ws:marginality",transparent:!0,styles:"marginality"},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!1,opacity:1,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),selectLayer=new OpenLayers.Layer.Vector("Selection",{displayInLayerSwitcher:!1,transparent:!0}),prioritizationLayer=new OpenLayers.Layer.WMS("Prioritization Results","/geoserver/wms",{layers:workspaceName+":data_prioritize",transparent:!0},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!1,opacity:.65,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:5e3}}),highlightedFeaturesCopy=selectLayer.clone(),colorSchemeLegendLayer=new OpenLayers.Layer.Vector("Color By Attribute Scheme",{isBaseLayer:!1,displayInLayerSwitcher:!0});colorSchemeLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var hansenLegendLayer=new OpenLayers.Layer.Vector("Hansen Legend",{isBaseLayer:!1,displayInLayerSwitcher:!0});hansenLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var prioritizationLegendLayer=new OpenLayers.Layer.Vector("Prioritization Legend",{isBaseLayer:!1,displayInLayerSwitcher:!0});prioritizationLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var marginalityLegendLayer=new OpenLayers.Layer.Vector("Marginality Legend",{isBaseLayer:!1,displayInLayerSwitcher:!0});marginalityLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var prioritizationVariables=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbon"," t/ha"],["bio","Biodiversity"," RWRI"],["hydro","Hydrological Services Index",""],["risk","Deforestation Risk","%"],["cost","Cost"," ($ or pes)/ha"],["forarea","Percent Forest Coverage"," %"],["scenario1","Carbon  expected benefit per cost",""],["scenario2","Biodiversity expected benefit per cost",""],["scenario3","Hydro  expected benefit per cost",""]]}),prioritizationVariablesSpanish=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbono"," t/ha"],["bio","Biodiversidad"," RWRI"],["hydro","Indice de Servicios Hidrol\xc3\xb3gicos",""],["risk","Riesgo de Deforestaci\xc3\xb3n","%"],["cost","Costo"," ($ o pes)/ha"],["forarea","Cubierta forestal porcentaje"," %"],["scenario1","Beneficio esperado de carbono por costo",""],["scenario2","Beneficio esperado biodiversidad  por costo",""],["scenario3","Beneficio esperado hidrol\xc3\xb3gico  por costo",""]]}),prioritizationVariablesCA=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["totcsrs","Population (Total Caserios)"," Caserios/Aldea"],["tthhldp"," Population (Total Households)","Households"],["prcxtpr","Poverty (% Extreme)","%"],["prcrlpr","Poverty (% Relative)","%"],["risk","Deforestation Risk","%"],["cost","Cost"," ($ or pes)/ha"],["forarea","Percent Forest Coverage"," %"]]}),prioritizationVariablesSpanishCA=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbono no suelo (biomasa)"," t/ha"],["carbon_total","Carbono total (biomasa y suelo)"," t/ha"],["carbon_soil","Carbono en el suelo"," t/ha"],["bio","\xc3\x8dndice RWRI de Biodiversidad (pesos globales)"," RWRI"],["bio_loc","\xc3\x8dndice RWRI de Biodiversidad (pesos nacionales)"," RWRI"],["bio_count","N\xc3\xbamero especies amenazadas"," #"],["hydro","Indice de Servicios Hidrol\xc3\xb3gicos",""],["risk","Riesgo de Deforestaci\xc3\xb3n","%"],["cost","Costo"," ($ o pes)/ha"],["forarea","Cubierta forestal porcentaje"," %"],["scenario1","Beneficio esperado de carbono (no suelo) por costo",""],["scenario2","Beneficio esperado biodiversidad (RWRI global) por costo",""],["scenario3","Beneficio esperado hidrol\xc3\xb3gico por costo",""]]}),map={xtype:"gx_mappanel",id:"map",ref:"mapPanel",region:"center",fractionalZoom:!0,layers:[ghan,gosm,gsat,ghyb,gphy],map:{controls:controls,eventListeners:{zoomend:function(){updateOnZoom(this.getZoom())}}},extent:OpenLayers.Bounds.fromArray([-103e5,23e5,-75e5,76e4])};OpenLayers.Control.CustomNavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomBox({type:OpenLayers.Control.TYPE_TOGGLE,title:"Toggle Box Zoom Tool",zoomOnClick:!1})]),this.displayClass="olControlNavToolbar"},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return a}}),controls.push(navControl=new OpenLayers.Control.Navigation({zoomWheelEnabled:!0,mouseWheelOptions:{interval:250,cumulative:!1}}),panzoomControl=new OpenLayers.Control.PanZoom,attributionControl=new OpenLayers.Control.Attribution,keyboardPanZoomControl=new OpenLayers.Control.KeyboardDefaults,scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}),navZoomControl=new OpenLayers.Control.CustomNavToolbar,showCoordinates=new OpenLayers.Control.MousePosition({displayProjection:"ESPG:4326",separator:" | ",numDigits:2}));var selectBox=new OpenLayers.Control.GetFeature({id:"selectControl",protocol:OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),click:!1,clickTolerance:0,box:!0,multipleKey:"shiftKey",toggleKey:"ctrlKey"});selectBox.events.register("featureselected",this,function(a){selectLayer.addFeatures([a.feature])}),selectBox.events.register("featureunselected",this,function(a){selectLayer.removeFeatures([a.feature])});var selectPolygon=new OpenLayers.Control.DrawFeature(selectLayer,OpenLayers.Handler.Polygon);controls.push(selectBox,selectPolygon);var myToolTip=new Ext.ToolTip;OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions)},onPause:function(a){var b=featuresFromXY(a.xy);if(b.length>0){var c=b[0].attributes[Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name];"risk"==Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name&&(c=100*c),isNaN(c)||(c=Number(c).toPrecision(4));var d="Value of "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName+": "+c+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit;myToolTip.destroy(),myToolTip=new Ext.ToolTip({html:d,dismissDelay:2e3}),myToolTip.showAt([a.xy.x+275,a.xy.y])}}}),OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){var b=featuresFromXY(a.xy);if(b.length>0){var c=[];selectLayer.removeAllFeatures(),Ext.each(b,function(a){var b="";b=a.fid.replace("getFeatureInfo.","fctt_id: ").replace("getFeatureInfo_userdata.","fctt_id: "),"string"==typeof a.attributes[nameAttribute]&&(b+=": "+a.attributes[nameAttribute]),c.push(new Ext.grid.PropertyGrid({xtype:"propertygrid",id:a.fid,title:b,source:a.attributes,autoActivate:!0,listeners:{beforeedit:{fn:function(){return!1}},expand:function(a){selectLayer.removeAllFeatures();for(var b=0;b<highlightedFeaturesCopy.features.length;b++)highlightedFeaturesCopy.features[b].fid==a.id&&selectLayer.addFeatures(highlightedFeaturesCopy.features[b]);selectLayer.redraw()}}})),a.geometry.transform("EPSG:4326","EPSG:900913"),selectLayer.addFeatures(a),highlightedFeaturesCopy=selectLayer.clone();for(var d=0;d<highlightedFeaturesCopy.features.length;d++)highlightedFeaturesCopy.features[d].fid=selectLayer.features[d].fid}),selectLayer.redraw(),Ext.getCmp("attributePanel")&&Ext.getCmp("attributePanel").destroy(),new GeoExt.Popup({id:"attributePanel",title:"Feature Attributes",layout:"accordion",layoutConfig:{multi:!0},map:app.mapPanel,location:new OpenLayers.Pixel(150,425),panIn:!1,height:400,width:250,collapsible:!0,autoScroll:!0,anchored:!0,collapsed:!0,titleCollapse:!0,items:c,listeners:{close:{fn:function(){selectLayer.removeAllFeatures(),highlightedFeaturesCopy.removeAllFeatures()}}}}).show()}}});var infoClick=new OpenLayers.Control.Click,infoHover=new OpenLayers.Control.Hover,bottombar={xtype:"container",id:"bottomBar",ref:"bottomBar",height:15,padding:0,region:"south",border:!1,style:"padding:2px 0px 0px 0px",items:[{xtype:"label",id:"appCopyright",text:"\xc2\xa9 2015 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission.",style:"font: bold 9px arial; color: blue; text-align: center; display:inline-block",width:window.innerWidth}]},topbar={xtype:"toolbar",id:"topBar",ref:"topBar",height:topBarHeight,padding:0,region:"north",border:!1,style:"padding:0px 0px 0px 0px",cls:"topBar",items:[new Ext.Button({text:"How To",id:"howToItem",menu:[{text:"Description",id:"descriptionItem",listeners:{click:function(){1==curLanguage&&openPage("documents/description.pdf","Forest Conservation Targeting Tool Description"),2==curLanguage&&openPage("documents/description.pdf","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Descripci\xc3\xb3n")}}},{text:"Instructions",id:"instructionsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/instructions.pdf","Forest Conservation Targeting Tool Instructions"),2==curLanguage&&openPage("documents/instructions.pdf","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Instrucciones")}}},{text:"FAQ",id:"faqItem",listeners:{click:function(){1==curLanguage&&openPage("documents/faq.html","Forest Conservation Targeting Tool FAQ"),2==curLanguage&&openPage("documents/faq_sp.html","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - FAQ")}}},{text:"Video Tutorial",id:"videoTutorialItem",listeners:{click:function(){1==curLanguage&&openPage("documents/tutorial.html","Forest Conservation Targeting Tool Video Tutorial"),2==curLanguage&&openPage("documents/tutorial_sp.html","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Video Tutorial")}}},{text:"User Questions",id:"userQuestionsItem",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Preguntas de Usuarios")}}},{text:"Email",id:"emailItem",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"About",id:"aboutItem",menu:[{text:"Metadata",id:"metadataItem",listeners:{click:function(){1==curLanguage&&openPage("documents/metadata.pdf","Forest Conservation Targeting Tool Metadata"),2==curLanguage&&openPage("documents/metadata.pdf","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Metadatos")}}},{text:"Sponsors",id:"sponsorsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/sponsors.pdf","Forest Conservation Targeting Tool Sponsors"),2==curLanguage&&openPage("documents/sponsors.pdf","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Promotores")}}},{text:"Team",id:"teamItem",listeners:{click:function(){1==curLanguage&&openPage("documents/team.pdf","Forest Conservation Targeting Tool Team"),2==curLanguage&&openPage("documents/team.pdf","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Equipo")}}},{text:"Email",id:"emailItem2",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Feedback",id:"feedbackItem",menu:[{text:"User Questions",id:"userQuestionsItem2",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Preguntas de Usuarios")}}},{id:"userCommentsItem",id:"userCommentsItem",text:"User Comments",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/usercomments","Forest Conservation Targeting Tool User Comments"),2==curLanguage&&openPage("http://conservationroi.net/usercomments","Herramienta Focalizaci\xc3\xb3n de Conservaci\xc3\xb3n Forestal - Comentarios de Usuarios")}}},{text:"Email",id:"emailItem3",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Use your own data",id:"loginItem",cls:"hidearrow",menu:[{id:"userConsoleItem",text:"User Console",listeners:{click:function(){var a=0;1==curLanguage&&confirm("Navigating to the User Console will restart your session in the FCTT. Do you wish to continue?")&&(a=1),2==curLanguage&&confirm("Navegaci\xc3\xb3n a la consola de usuario se reiniciar\xc3\xa1 la sesi\xc3\xb3n en el FCTT. \xc2\xbfDesea continuar?")&&(a=1),1==a&&(Ext.getCmp("app").toolPanel.el.setWidth(0),Ext.getCmp("app").doLayout(),app.mapPanel.map.div.innerHTML="<iframe src='../../usersystem/userconsole.php?lang="+curLanguage+"' width = 100% height = 100%></iframe>",myLegend.hide(),Ext.getCmp("userConsoleItem").hide(),Ext.getCmp("returnToFCTTItem").show())}}},{id:"returnToFCTTItem",text:"Reload FCTT",hidden:!0,listeners:{click:function(){window.top.location.href="../../index_user.html"}}},{id:"logoutItem",text:"Logout",listeners:{click:function(){1==curLanguage&&confirm("Logging out will restart your session in the FCTT. Do you wish to continue?")&&(window.location="../../usersystem/logout_fctt.php"),2==curLanguage&&confirm("Hacer clic en 'Logout' se reiniciar\xc3\xa1 su sesi\xc3\xb3n en el FCTT. \xc2\xbfDesea continuar?")&&(window.location="../../usersystem/logout_fctt.php")}}}],listeners:{mouseover:function(){this.showMenu()},click:function(){1==loginRegisterWindow.hidden?0==phpVarIsLoggedIn&&(loginRegisterWindow.show(),app.mapPanel.disable(),Ext.getCmp("toolPanel").disable(),myLegend.disable()):(loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable())},menutriggerout:function(){}}}),{xtype:"spacer",width:20},{xtype:"compositefield",fieldLabel:"Language/Idioma",items:[{xtype:"combo",id:"language",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:110,queryMode:"local",value:"English",store:[[1,"English"],[2,"Espa\xc3\xb1ol"]],listeners:{select:function(a,b,c){curLanguage=c+1,updateLanguage()}}}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},id:"appTitleContainer",style:"padding:5px 0px 0px 0px",width:window.innerWidth-625,height:topBarHeight,items:[{xtype:"label",id:"appTitle",text:"Forest Conservation Targeting Tool (Beta)",style:"font: bold "+topBarHeight/1.75+"px arial; color: white; text-align: center; display:inline-block"}]},"->",{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/nasa-logo.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/Mesoamerica2.png" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.rff.org" target="_blank"><img src="images/rff_transparent.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:5}]},toolpanel={id:"toolPanel",ref:"toolPanel",padding:0,region:"west",title:"<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>",bodyStyle:"background-image:url(images/panel2.jpg);background-size: cover",collapsible:!0,width:250,autoScroll:!0,items:toolItems,bbar:[{id:"resetButton",text:"<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>",handler:function(){dataSourceNum=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1,setDataSource(dataSourceNum),app.mapPanel.map.getZoom()<8&&4==dataSourceNum&&dataLayer.setVisibility(!1),Ext.getCmp("chkLines").setValue(linesOn),whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",forestThreshold=25,Ext.getCmp("thresholdSlider").setValue(forestThreshold),updateDataLayerParams(),updatePrioritization(),regionSelectManager.setValue(0),regionSelectManager.setSelectedIndex(0),Ext.getCmp("colorAttribute").getSelectionModel().clearSelections(),colorSchemeOn=!1,infoHover.deactivate(),Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1),Ext.getCmp("chkCost").setValue(!0),Ext.getCmp("chkRisk").setValue(!0),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),zoomToRegion(),updateOnZoom(app.mapPanel.map.getZoom()),updateStyling(),dataLayer.redraw(),resetLegendPosition()}},"->",{id:"resetLegend",text:"Reset Legend Position",handler:function(){resetLegendPosition()}}]},regionPanel={id:"regionPanel",title:"DEFINE STUDY AREA",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 3px;",labelWidth:80,items:[{xtype:"compositefield",fieldLabel:"Dataset",id:"datasetLabel",items:[{xtype:"combo",id:"datasource",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:135,queryMode:"local",value:"Central America 10km",store:[[5,"Aldeas"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}],listeners:{beforeselect:function(a,b,c){return-1==Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1?!1:void 0},select:function(a,b,c){var d=dataSourceNum,e=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1;d!=e&&(Ext.getCmp("adminSelect").show(),dataSourceNum=e,setDataSource(dataSourceNum),app.mapPanel.map.getZoom()<8&&4==dataSourceNum&&dataLayer.setVisibility(!1),inClauseStr="idAttribute:1;inSet:1",(3!=d&&4!=d&&5!=d||3!=e&&4!=e&&5!=e)&&(whereClauseStr="whereParam:1;whereValue:1",regionSelectManager.setValue(0),regionSelectManager.setSelectedIndex(0),zoomToRegion()),updateDataLayerParams(),updatePrioritization(),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),Ext.getCmp("chkLines").setValue(linesOn),updateOnZoom(app.mapPanel.map.getZoom()),dataLayer.redraw(),updateStyling(),1==dataSourceNum||2==dataSourceNum?Ext.getCmp("chkMarginality").setDisabled(!1):(Ext.getCmp("chkMarginality").setDisabled(!0),Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1)),prioritizationLayer.setVisibility(!1),prioritizationLayer.redraw())}}}]},{xtype:"compositefield",fieldLabel:"Minimum Forest Cover",id:"thresholdLabel",hidden:!1,items:[{xtype:"slider",id:"thresholdSlider",aggressive:!0,vertical:!1,useTips:!1,value:25,maxValue:100,minValue:25,width:100,listeners:{change:function(a){Ext.getCmp("thresholdValueLabel").setText(a.getValue()+"%"),forestThreshold=a.getValue(),updatePrioritization()}}},{xtype:"label",id:"thresholdValueLabel",text:"25%",style:{padding:"3px 0px 0px 0px"}},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"panel",title:"By prioritization variables",id:"prioritySelect",collapsible:!0,collapsed:!0,titleCollapse:!0,labelWidth:80,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"container",id:"prioritizationSelectContainer",layout:"form",items:[{xtype:"compositefield",fieldLabel:"Population",id:"var1Label",hidden:!1,items:[{xtype:"numberfield",id:"var1LowerSelection",width:50,decimalPrecision:4,value:"0",listeners:{afterrender:function(a){var b=getMinAvgMax("totcsrs")[0];a.setValue(b)},change:function(a,b){var c=b,d=Ext.getCmp("var1UpperSelection").value,e=getMinAvgMax("totcsrs")[0];c>d&&(c=d,a.setValue(d)),e>c&&(c=e,a.setValue(e)),var1LowerThreshold=c,var1UpperThreshold=d,updatePrioritization()}}},{xtype:"numberfield",id:"var1UpperSelection",width:50,decimalPrecision:4,value:"100",listeners:{afterrender:function(a){var b=getMinAvgMax("totcsrs")[2];a.setValue(b)},change:function(a,b){var c=Ext.getCmp("var1LowerSelection").value,d=b,e=getMinAvgMax("totcsrs")[2];c>d&&(d=c,a.setValue(c)),d>e&&(d=e,a.setValue(e)),var1LowerThreshold=c,var1UpperThreshold=d,updatePrioritization()}}}]},{xtype:"compositefield",fieldLabel:"Poverty",id:"var2Label",hidden:!1,items:[{xtype:"numberfield",id:"var2LowerSelection",width:50,decimalPrecision:4,value:"0",listeners:{afterrender:function(a){var b=getMinAvgMax("prcxtpr")[0];a.setValue(b)},change:function(a,b){var c=b,d=Ext.getCmp("var2UpperSelection").value,e=getMinAvgMax("prcxtpr")[0];c>d&&(c=d,a.setValue(d)),e>c&&(c=e,a.setValue(e)),var2LowerThreshold=c,var2UpperThreshold=d,updatePrioritization()}}},{xtype:"numberfield",id:"var2UpperSelection",width:50,decimalPrecision:4,value:"100",listeners:{afterrender:function(a){var b=getMinAvgMax("prcxtpr")[2];a.setValue(b)},change:function(a,b){var c=Ext.getCmp("var2LowerSelection").value,d=b,e=getMinAvgMax("prcxtpr")[2];var2LowerThreshold=c,var2UpperThreshold=d,c>d&&(d=c,a.setValue(c)),d>e&&(d=e,a.setValue(e)),updatePrioritization()}}}]},{xtype:"compositefield",fieldLabel:"Deforestation Risk",id:"var3Label",hidden:!1,items:[{xtype:"numberfield",id:"var3LowerSelection",width:50,decimalPrecision:4,value:".001",listeners:{afterrender:function(a){var b=getMinAvgMax("risk")[0];a.setValue(b)},change:function(a,b){var c=b,d=Ext.getCmp("var3UpperSelection").value,e=getMinAvgMax("risk")[0];c>d&&(c=d,a.setValue(d)),e>c&&(c=e,a.setValue(e)),var3LowerThreshold=c,var3UpperThreshold=d,updatePrioritization()}}},{xtype:"numberfield",id:"var3UpperSelection",width:50,decimalPrecision:4,value:".01",listeners:{afterrender:function(a){var b=getMinAvgMax("risk")[2];a.setValue(b)},change:function(a,b){var c=Ext.getCmp("var3LowerSelection").value,d=b,e=getMinAvgMax("risk")[2];c>d&&(d=c,a.setValue(c)),d>e&&(d=e,a.setValue(e)),var3LowerThreshold=c,var3UpperThreshold=d,updatePrioritization()}}}]}]}]},{xtype:"panel",title:"By administrative boundary",id:"adminSelect",collapsible:!0,collapsed:!0,titleCollapse:!0,labelWidth:80,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"container",id:"regionSelectContainer",items:[{id:"regionSelectCheckBoxes",xtype:"checkboxgroup",fieldLabel:"Regions",columns:1,items:[{boxLabel:"Failed",name:"Failed"}]}]}]},{xtype:"panel",title:"Using manual selection tool",id:"manuallySelect",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"compositefield",fieldLabel:"Selection Mode",id:"selectionMode",items:[{xtype:"combo",id:"selectModeCombo",selectedIndex:0,width:115,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",value:"Polygon",store:[[1,"Polygon"],[2,"Box"]],listeners:{select:function(a,b,c){selectMode=c+1,2==selectMode&&(Ext.Msg.alert("Note","Use of the Box/Manual Select Tool is not recommended for selecting more than 10,000 shapes. In this case, please use the Within Polygon or Upload Shapefile tool."),2==curLanguage&&Ext.Msg.alert("Nota","De usuario de la herramienta de selecci\xc3\xb3n Caja/Clic Manual no se recomienda para la selecci\xc3\xb3n de m\xc3\xa1s de 10,000 formas. En este caso, por favor, utilice la herramienta de Dentro Pol\xc3\xadgono o Subir Shapefile.")),3==selectMode}}}]}],listeners:{expand:function(){"undefined"!=typeof instructionsWindow&&(1==curLanguage&&(instructionsWindow.show(),instructionsWindowSp.hide()),2==curLanguage&&(instructionsWindow.hide(),instructionsWindowSp.show()))}},bbar:[{xtype:"button",id:"selectsubmitselection",text:"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){if(navigationMode)navigationMode=!1,1==selectMode&&selectPolygon.activate(),2==selectMode&&selectBox.activate(),infoHover.deactivate(),infoClick.deactivate(),selectLayer.removeAllFeatures(),selectLayer.redraw(),Ext.getCmp("attributePanel")&&(Ext.getCmp("attributePanel").removeAll(),Ext.getCmp("attributePanel").close()),Ext.getCmp("cancelclearselection").show(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>");else{if(1==selectMode){if(0==selectLayer.features.length&&(Ext.Msg.alert("Whoops!","No feature drawn. Please use the mouse to draw a study area polygon. Double-click to complete."),2==curLanguage&&Ext.Msg.alert("\xc2\xa1Ay!","Sin Caracter\xc3\xadsticas dibujadas. Utilice el rat\xc3\xb3n para dibujar una \xc3\xa1rea de estudio pol\xc3\xadgono. Haga doble clic para completar.")),1==selectLayer.features.length){var a=selectLayer.features[0];if(a.geometry.components[0].components.length<4)Ext.Msg.alert("Whoops!","Polygon must have at least three vertices."),2==curLanguage&&Ext.Msg.alert("\xc2\xa1Ay!","Pol\xc3\xadgono debe tener al menos tres v\xc3\xa9rtices.");else{a.geometry.transform("EPSG:900913","EPSG:4326"),whereClauseStr=a.geometry.toString(),whereClauseStr=whereClauseStr.replace("POLYGON","LINESTRING"),whereClauseStr=whereClauseStr.replace("((","("),whereClauseStr=whereClauseStr.replace("))",")"),whereClauseStr="whereValue:TRUE;whereParam:ST_Intersects(geom, (SELECT ST_MakePolygon(ST_GeomFromText('"+whereClauseStr+"',4326))))",whereClauseStr=whereClauseStr.replace(/,/g,"\\,"),inClauseStr="idAttribute:1;inSet:1";var b=inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold+";var1LowerThreshold:"+var1LowerThreshold+";var1UpperThreshold:"+var1UpperThreshold+";var2LowerThreshold:"+var2LowerThreshold+";var2UpperThreshold:"+var2UpperThreshold+";var3LowerThreshold:"+var3LowerThreshold+";var3UpperThreshold:"+var3UpperThreshold+"layerPIN:"+phpVarlayerPIN;dataLayer.mergeNewParams({viewparams:b})}}selectLayer.features.length>1&&(Ext.Msg.alert("Whoops!","Multiple features drawn. Limit is one."),2==curLanguage&&Ext.Msg.alert("\xc2\xa1Ay!","M\xc3\xbaltiples caracter\xc3\xadsticas dibujadas. Limit es una."))}if(2==selectMode){var c=[];Ext.iterate(selectBox.features,function(a,b){c.push(b.attributes[idAttribute])}),whereClauseStr="whereValue:1;whereParam1",inClauseStr="idAttribute:"+idAttribute+";inSet:"+c,inClauseStr=inClauseStr.replace(/,/g,"\\,"),0==c.length&&(Ext.Msg.alert("Whoops!","No features selected! Click on features or draw a box to select."),inClauseStr="idAttribute:1;inSet:1"),0==c.length&2==curLanguage&&(Ext.Msg.alert("\xc2\xa1Ay!","No hay caracter\xc3\xadsticas seleccionadas! Haga clic en las caracter\xc3\xadsticas o dibujar un cuadro para seleccionar."),inClauseStr="idAttribute:1;inSet:1"),c.length>0&&updateDataLayerParams()}Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),navigationMode=!0,selectPolygon.deactivate(),selectBox.deactivate(),colorSchemeOn&&infoHover.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),prioritizationLayer.setVisibility(!1),updateStyling(),dataLayer.redraw()}updateSelectionButtonLanguage()}},"->",{xtype:"button",id:"cancelclearselection",text:"<div style='color:black;font-size: 12'>Clear/Cancel</div>",icon:"images/clear.gif",hidden:!0,handler:function(){var a=setNumericIndex();
0==a&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:1;whereValue:1",updateDataLayerParams()),a>0&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:"+locationParamName+";whereValue:"+a,updateDataLayerParams()),Ext.iterate(selectBox.features,function(a,b){delete selectBox.features[a]}),selectBox.deactivate(),selectPolygon.deactivate(),inClauseStr="idAttribute:1;inSet:1",updateStyling(),navigationMode?(Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()):(navigationMode=!0,colorSchemeOn&&infoHover.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()),updateSelectionButtonLanguage()}}]}]},optionsPanel={id:"optionsPanel",title:"DISPLAY OPTIONS",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 2;",items:[{xtype:"panel",id:"defaultColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>',items:[{xtype:"colorpalette",id:"defaultColorPicker",color:"blue",handler:function(a,b){defaultColor=b,Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Color de Relleno Defecto</div>'),Ext.getCmp("defaultColorPanel").collapse(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape lines",id:"shpLinesLabel",items:[{xtype:"checkbox",id:"chkLines",checked:!0,handler:function(){linesOn=Ext.getCmp("chkLines").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape fill",id:"shpFillLabel",items:[{xtype:"checkbox",id:"chkFill",checked:!0,handler:function(){selectLayer.setVisibility(Ext.getCmp("chkFill").checked),fillOn=Ext.getCmp("chkFill").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Opacity",id:"opacityLabel",items:[{xtype:"gx_opacityslider",id:"opacitySlider",layer:dataLayer,changeVisibility:!0,aggressive:!0,vertical:!1,width:120,value:65,x:15,y:150,plugins:new GeoExt.LayerOpacitySliderTip},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"compositefield",fieldLabel:"Marginality Layer",id:"margLayerLabel",items:[{xtype:"checkbox",id:"chkMarginality",checked:!1,disabled:!0,handler:function(){marginalityLayer.setVisibility(Ext.getCmp("chkMarginality").checked),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Base map type",id:"basemapLabel",items:[{xtype:"combo",id:"basemapCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:120,queryMode:"local",value:"Google Physical",store:[[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satelitte"],[4,"OpenStreetMap"],[5,"Forest Change(2000-2012)"]],listeners:{select:function(a,b,c){gphy.setVisibility(1==c),ghyb.setVisibility(2==c),gsat.setVisibility(3==c),gosm.setVisibility(4==c),ghan.setVisibility(5==c),gosmActive=4==c,ghanActive=5==c,updateOnZoom(app.mapPanel.map.getZoom()),updateStyling()}}}]},{xtype:"compositefield",fieldLabel:"Show Scale",id:"showScaleLabel",items:[{xtype:"checkbox",id:"chkScale",checked:!0,handler:function(){Ext.getCmp("chkScale").checked||app.mapPanel.map.removeControl(scaleControl),Ext.getCmp("chkScale").checked&&app.mapPanel.map.addControl(scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}))}}]},{xtype:"compositefield",fieldLabel:"Pan/Zoom Tool",id:"panZoomLabel",items:[{xtype:"checkbox",id:"chkPanZoom",checked:!0,handler:function(){Ext.getCmp("chkPanZoom").checked||app.mapPanel.map.removeControl(panzoomControl),Ext.getCmp("chkPanZoom").checked&&app.mapPanel.map.addControl(panzoomControl=new OpenLayers.Control.PanZoom)}}]},{xtype:"compositefield",fieldLabel:"Mouse wheel zoom",id:"mouseWheelLabel",items:[{xtype:"checkbox",id:"chkMouseZoom",checked:!0,handler:function(){Ext.getCmp("chkMouseZoom").checked||navControl.disableZoomWheel(),Ext.getCmp("chkMouseZoom").checked&&navControl.enableZoomWheel()}}]}]},colorByAttributePanel=new Ext.Panel({id:"colorByAttributePanel",title:"TARGETING DATA",collapsible:!0,titleCollapse:!0,layout:"form",labelWidth:95,bodyStyle:"padding: 3;",items:[{xtype:"panel",id:"lowColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 0px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Low Color</div>',items:[{xtype:"colorpalette",id:"lowColorPicker",color:"blue",handler:function(a,b){lowColor=b,Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Low Color</div>'),2==curLanguage&&Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("lowColorPanel").collapse(),Ext.getCmp("highColorPanel").expand(),updateStyling()}}]},{xtype:"panel",id:"highColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 10px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">High Color</div>',items:[{xtype:"colorpalette",id:"highColorPicker",color:"red",handler:function(a,b){highColor=b,Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">High Color</div>'),2==curLanguage&&Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("highColorPanel").collapse(),Ext.getCmp("attribute").expand(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Method",id:"methodLabel",items:[{xtype:"combo",id:"methodCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:120,queryMode:"local",value:"Interpolate",store:[[0,"Interpolate"],[1,"Quantiles"],[2,"Bins"]],listeners:{select:function(a,b,c){updateStyling(),Ext.getCmp("numQuantiles").setDisabled(0==c),1==c?Ext.getCmp("quantilesLabel").label.update("# Quantiles"):2==c&&Ext.getCmp("quantilesLabel").label.update("# Bins")}}}]},{xtype:"compositefield",fieldLabel:"# Quantiles",id:"quantilesLabel",disabled:!0,items:[{xtype:"numberfield",id:"numQuantiles",width:40,value:"3",listeners:{change:function(){updateStyling()}}}]},new Ext.grid.GridPanel({id:"colorAttribute",title:"Variables",style:"padding:0px 0px 10px 0px",store:prioritizationVariables,cm:new Ext.grid.ColumnModel([{id:"displayName",dataIndex:"displayName",sortable:!0}]),sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),autoExpandColumn:"displayName",height:200}),{xtype:"compositefield",fieldLabel:"Show null values",id:"chkNullLabel",items:[{xtype:"checkbox",id:"chkNull",boxLabel:"(in default color)",checked:!1,handler:function(){updateStyling()}}]}],bbar:[{id:"updatedatavis",hidden:!0,text:"<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>",cls:"boldbutton",icon:"images/refresh.gif",handler:function(){colorSchemeOn=!0,infoHover.activate(),updateStyling()}},"->",{id:"cleardatavis",text:"<div style='color:black;font-size: 12'>Clear</div>",icon:"images/clear.gif",handler:function(){colorSchemeOn=!1,infoHover.deactivate(),updateStyling()}}]});Ext.grid.RowSelectionModel.override({getSelectedIndex:function(){return this.grid.store.indexOf(this.selections.itemAt(0))}}),Ext.getCmp("colorAttribute").on("rowclick",function(){colorSchemeOn=!0,infoHover.activate(),updateStyling()},this),Ext.getCmp("colorAttribute").on("beforerowselect",function(){alert("hi!")},this),Ext.getCmp("colorAttribute").on("keydown",function(a){if(38==a.keyCode){var b=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();b>0&&(Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b-1),updateStyling(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b))}if(40==a.keyCode){var b=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();b<Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].store.totalLength-1&&(Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b+1),updateStyling(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(b))}},this);var selectPanel=new Ext.Panel({xtype:"panel",id:"selectPanel",title:"TARGET",layout:"form",layoutConfig:{multi:!0},collapsible:!0,collapsed:!1,titleCollapse:!0,bodyStyle:"padding: 3;",items:[{xtype:"fieldset",id:"chooseBenefits",title:"Choose Benefit Variables",collapsible:!1,hidden:!1,labelWidth:70,items:[{xtype:"compositefield",fieldLabel:"Population:",id:"carbonBenefitLabel",items:[{xtype:"combo",id:"carbonBenefitChoose",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:125,queryMode:"local",value:"Total Caserios",store:[["totcsrs","Total Caserios"],["tthhldp","Total Households"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}]}]},{xtype:"compositefield",fieldLabel:"Poverty:",id:"bioBenefitLabel",items:[{xtype:"combo",id:"bioBenefitChoose",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:125,queryMode:"local",value:"Percent Extreme Poverty",store:[["prcxtpr","Percent Extreme Poverty"],["prcrlpr","Percent Relative Poverty"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}]}]}]},{xtype:"tabpanel",id:"priorityTabPanel",activeTab:0,plain:!0,items:[{title:"Select stopping criteria",padding:5,autoHeight:!0,items:[{layout:"hbox",unstyled:!0,hidden:!0,items:[{xtype:"radio",id:"percentageRadio",checked:!1,boxLabel:"Percentage of total:",hidden:!0,listeners:{check:function(a,b){b&&(Ext.getCmp("rawRadio").setValue(!1),Ext.getCmp("percentileRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!1),Ext.getCmp("benefit_percentile").setDisabled(!0),Ext.getCmp("budget_raw").setDisabled(!0))}}},{xtype:"spacer",width:3,hidden:!0},{xtype:"numberfield",id:"budget_percentage",width:30,value:"10",hidden:!0},{xtype:"spacer",width:3,hidden:!0},{xtype:"label",text:"(%)",hidden:!0}]},{layout:"hbox",unstyled:!0,hidden:!0,style:"padding:10px 0px 0px 0px",items:[{xtype:"radio",id:"rawRadio",boxLabel:"Raw budget:",listeners:{check:function(a,b){b&&(Ext.getCmp("percentageRadio").setValue(!1),Ext.getCmp("percentileRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!0),Ext.getCmp("benefit_percentile").setDisabled(!0),Ext.getCmp("budget_raw").setDisabled(!1))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"budget_raw",width:67,value:"10000000",disabled:!0},{xtype:"spacer",width:3},{xtype:"label",id:"currencyLabel",text:"($)"}]},{layout:"hbox",unstyled:!0,style:"padding:10px 0px 0px 0px",items:[{xtype:"radio",id:"percentileRadio",checked:!0,boxLabel:"Top:",listeners:{check:function(a,b){b&&(Ext.getCmp("rawRadio").setValue(!1),Ext.getCmp("percentageRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!0),Ext.getCmp("benefit_percentile").setDisabled(!1),Ext.getCmp("budget_raw").setDisabled(!0))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"benefit_percentile",width:30,value:"10",disabled:!1},{xtype:"spacer",width:3},{xtype:"label",text:"(%)"}]}]}]},{xtype:"tabpanel",id:"benefitTabPanel",activeTab:0,plain:!0,style:"padding:10px 0px 0px 0px",items:[{id:"combineTab",title:"Weight Benefits",padding:5,autoHeight:!0,items:[{layout:"auto",unstyled:!0,items:[{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"carbonweightfield",fieldLabel:'<div style="color: green; font-weight: bold">Population:</div>',labelSeparator:"",items:[{xtype:"numberfield",id:"weight1",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(0,100*Ext.getCmp("weight1").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"bioweightfield",fieldLabel:'<div style="color: red; font-weight: bold">Poverty:</div>',labelSeparator:"",items:[{xtype:"numberfield",id:"weight2",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,Ext.getCmp("weightMultiSlider").getValues()[0]+100*Ext.getCmp("weight2").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"hydroweightfield",fieldLabel:'<div style="color: blue; font-weight: bold">Deforestation Risk:</div>',labelSeparator:"",items:[{xtype:"numberfield",id:"weight3",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,100*(1-Ext.getCmp("weight3").value))}}}]}]}]},new Ext.slider.MultiSlider({id:"weightMultiSlider",values:[33.33,66.67],increment:1,minValue:0,maxValue:100,constrainThumbs:!0,width:215,plugins:[new Ext.ux.slider.Highlight],listeners:{change:function(a){a.getValues()[0]>a.getValues()[1]&&a.setValue(0,a.getValues()[1]),Ext.getCmp("weight1").setValue(a.getValues()[0]/100),Ext.getCmp("weight2").setValue((a.getValues()[1]-a.getValues()[0])/100),Ext.getCmp("weight3").setValue((100-a.getValues()[1])/100)}}}),{xtype:"panel",id:"selectedFillColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>',items:[{xtype:"colorpalette",id:"selectedFillColorPicker",color:"blue",handler:function(a,b){selectedFillColor=b,Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("selectedFillColorPanel").collapse(),prioritizationLayer.visibility&&updatePrioritization()}}]}]},{id:"compareTab",title:"Compare",height:100,layout:{type:"hbox",pack:"center",align:"middle"},padding:2,items:[{xtype:"combo",id:"compareObjectiveCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",width:150,value:"All Benefits",store:[[0,"All Benefits"],[1,"Population and Poverty"],[2,"Population and Deforestation Risk"],[3,"Poverty and Deforestation Risk"]],listeners:{select:function(a,b,c){prioritizationLayer.visibility&&updatePrioritization()}}}]}]},{xtype:"fieldset",id:"priorityOptions",title:"Options",layout:"form",labelWidth:170,collapsible:!1,items:[{xtype:"compositefield",fieldLabel:"Include deforestation risk",id:"chkRiskLabel",items:[{xtype:"checkbox",id:"chkRisk",checked:!1,hidden:!0}]},{xtype:"compositefield",fieldLabel:"",id:"chkCostLabel",items:[{xtype:"checkbox",id:"chkCost",checked:!1,hidden:!0}]}]}],bbar:[{id:"submitprioritization",text:"<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){prioritizationLayer.setVisibility(!0),updatePrioritization()}},"->",{id:"clearprioritization",text:"<div style='color:black;font-size: 12'>Clear</div>",cls:"boldbutton",icon:"images/clear.gif",handler:function(){prioritizationLayer.setVisibility(!1),updateStyling()}}]}),exportPanel={id:"exportPanel",title:"EXPORT",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",hidden:!1,bodyStyle:"padding: 2;",items:[{xtype:"button",text:"<div style='color:black;font-size: 12'>Export Shapefile</div>",id:"shapefileButton",scale:"medium",icon:"images/download_shp.png",handler:function(){if(userLayerActive&&"mex_pred"==userDataSourceUOA||1==dataSourceNum||2==dataSourceNum)1==curLanguage&&alert("Unfortunately, shapefile download is not possible for datasets that use the mexico predios. However, you can download your data and prioritization results in CSV format, including predio names."),2==curLanguage&&alert("Desafortunadamente, descarga shapefile no es posible para los conjuntos de datos que utilizan los predios m\xc3\xa9xico. Sin embargo, puede descargar los datos y resultados de priorizaci\xc3\xb3n en formato CSV, incluyendo los nombres de predios.");else{var a="";updatePrioritization(),a=userLayerActive?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_userdata&viewParams="+priorityParams+"&outputFormat=SHAPE-ZIP&format_options=filename:fctt_output.zip":"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_aldeas&viewParams="+priorityParams+"&outputFormat=SHAPE-ZIP&format_options=filename:fctt_output.zip",imgWait.style.visibility="visible",window.location=a,imgWait.style.visibility="hidden"}}},{xtype:"button",text:"<div style='color:black;font-size: 12'>Export CSV</div>",id:"csvButton",scale:"medium",icon:"images/download_csv.png",handler:function(){var a="";updatePrioritization(),a=userLayerActive?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_userdata&viewParams="+priorityParams+"&outputFormat=csv":"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_aldeas&viewParams="+priorityParams+"&outputFormat=csv",window.location=a}},{xtype:"button",id:"printButton",text:"<div style='color:black;font-size: 12'>Print/PDF</div>",scale:"medium",icon:"images/print.png",hidden:!1,handler:function(){var a=new Ext.Window({autoHeight:!0,width:400,items:[new GeoExt.PrintMapPanel({sourceMap:app.mapPanel,printProvider:{capabilities:printCapabilities}})],bbar:[{text:"Create PDF",handler:function(){a.items.get(0).print()}}]});a.show()}}]};toolItems.push(optionsPanel,regionPanel,colorByAttributePanel,selectPanel,exportPanel);