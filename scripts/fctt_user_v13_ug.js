function registerEvents(e){e.events.register("loadstart",e,function(){app.mapPanel.body.dom.style.cursor="wait",imgWait.style.visibility="visible"}),e.events.register("loadend",e,function(){app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden"})}function updateStyling(){0==Ext.getCmp("colorAttribute").getSelectionModel().selections.items.length&&Ext.getCmp("colorAttribute").getSelectionModel().selectRow(0);var e=Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name;if(1==colorSchemeOn&(4==dataSourceNum|6==dataSourceNum|7==dataSourceNum)&0==manualSelectOn)1==curLanguage&&Ext.Msg.alert("Warning","To work with this layer, you must first select a smaller region using the DEFINE STUDY AREA panel."),2==curLanguage&&Ext.Msg.alert("Aviso","Para trabajar con esta capa, primero debe seleccionar una región más pequeña utilizando el panel DEFINIR ÁREA DE ESTUDIO."),colorSchemeOn=!1,updateStyling(),app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden",Ext.getCmp("colorAttribute").getSelectionModel().clearSelections();else{var t=1;"risk"==e&&(t=100);var a='<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>'+dataSourceLayerName+"</sld:Name><sld:UserStyle><sld:FeatureTypeStyle>",o='<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>'+workspaceName+":dummyDataLayerForWMSLegend</sld:Name><sld:UserStyle><sld:Title>"+workspaceName+":dummyDataLayerForWMSLegend</sld:Title><sld:FeatureTypeStyle>",i="<ogc:Filter><ogc:Not><ogc:PropertyIsNull><ogc:PropertyName>"+e+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Not></ogc:Filter>";if(1==Ext.getCmp("methodCombo").selectedIndex&colorSchemeOn&fillOn){Ext.getCmp("numQuantiles").setValue(parseInt(Ext.getCmp("numQuantiles").getValue())),Ext.getCmp("numQuantiles").getValue()>0||Ext.getCmp("numQuantiles").setValue("10");var r=parseInt(Ext.getCmp("numQuantiles").getValue());updateDataLayerParams();for(var l=[],s=1;s<r;s++){if(userLayerActive)var n="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getQuantile_userdata",d="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var n="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getQuantile",d="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";dataSource:"+dataSourceName;updateDataLayerParams();c=n+"&viewparams="+d+";"+theViewParams+";percentage:"+s/r;if((m=new XMLHttpRequest).open("POST","../../geoserver/"+workspaceName+"/ows",!1),m.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.send(c),byTagNS(m.responseXML,"value",workspaceName))l.push(Number(byTagNS(m.responseXML,"value",workspaceName)));else{c=n+"&viewparams="+d+";percentage:"+s/r;m.open("POST","../../geoserver/"+workspaceName+"/ows",!1),m.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.send(c),1==curLanguage&&Ext.Msg.alert("Warning","Due to a problem communicating with the server, the quantiles used may not precisely reflect the quantiles of "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+" for your exact region of interest."),2==curLanguage&&Ext.Msg.alert("Aviso","Debido a un problema de comunicación con el servidor, los cuantiles utilizados pueden no reflejar con precisión los cuantiles de "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+" para su región exacta de interés."),byTagNS(m.responseXML,"value",workspaceName)?l.push(Number(byTagNS(m.responseXML,"value",workspaceName))):l.push(0)}}a+="<sld:Rule><Title>Below "+cleanUpIfNumber(l[0])+"</Title>"+i+"<ogc:Filter><ogc:PropertyIsLessThan><ogc:PropertyName>"+e+"</ogc:PropertyName><ogc:Literal>"+l[0]+'</ogc:Literal></ogc:PropertyIsLessThan></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&(o+="<sld:Rule><Title>Below "+cleanUpIfNumber(l[0]*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),2==curLanguage&&(o+="<sld:Rule><Title>Menos de "+cleanUpIfNumber(l[0]*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(a+="<sld:Stroke/>",o+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>",o+="</PolygonSymbolizer></sld:Rule>";for(s=1;s<r-1;s++)a+="<sld:Rule><Title>["+cleanUpIfNumber(l[s-1]*t)+", "+cleanUpIfNumber(l[s]*t)+"]"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</Title>"+i,o+="<sld:Rule><Title>["+cleanUpIfNumber(l[s-1]*t)+", "+cleanUpIfNumber(l[s]*t)+"]"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</Title>",a+="<ogc:Filter><ogc:And><ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+e+"</ogc:PropertyName><ogc:Literal>"+l[s-1]+"</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo>",a+="<ogc:PropertyIsLessThan><ogc:PropertyName>"+e+"</ogc:PropertyName><ogc:Literal>"+l[s]+"</ogc:Literal></ogc:PropertyIsLessThan></ogc:And></ogc:Filter>",a+='<PolygonSymbolizer><Fill><CssParameter name="fill">'+mixLowAndHighColors(s/(r-1))+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',o+='<PolygonSymbolizer><Fill><CssParameter name="fill">'+mixLowAndHighColors(s/(r-1))+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(a+="<sld:Stroke/>",o+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>",o+="</PolygonSymbolizer></sld:Rule>";a+="<sld:Rule><Title>At least "+cleanUpIfNumber(l[r-2])+"</Title>"+i+"<ogc:Filter><ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+e+"</ogc:PropertyName><ogc:Literal>"+l[r-2]+'</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&(o+="<sld:Rule><Title>Above "+cleanUpIfNumber(l[r-2]*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),2==curLanguage&&(o+="<sld:Rule><Title>Mas de "+cleanUpIfNumber(l[r-2]*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+'</Title><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(a+="<sld:Stroke/>",o+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>",o+="</PolygonSymbolizer></sld:Rule>"}if(Ext.getCmp("methodCombo").selectedIndex<1&colorSchemeOn&fillOn){if(userLayerActive)var n="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_userdata",d="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var n="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere",d="theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";dataSource:"+dataSourceName;updateDataLayerParams();var c=n+"&viewparams="+d+";"+theViewParams,m=new XMLHttpRequest;if(m.open("POST","../../geoserver/"+workspaceName+"/ows",!1),m.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.send(c),byTagNS(m.responseXML,"max",workspaceName))minVal=Number(byTagNS(m.responseXML,"min",workspaceName)),avgVal=Number(byTagNS(m.responseXML,"avg",workspaceName)),maxVal=Number(byTagNS(m.responseXML,"max",workspaceName));else{c=n+"&viewparams="+d;m.open("POST","../../geoserver/"+workspaceName+"/ows",!1),m.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.send(c),1==curLanguage&&Ext.Msg.alert("Warning","Due to a problem communicating with the server, the high and low values displayed in the legend may not reflect the maximum and minimum values for your exact region of interest."),2==curLanguage&&Ext.Msg.alert("Aviso","Debido a un problema de comunicación con el servidor, los valores altos y bajos que se muestran en la leyenda no siempre son representativas de los valores máximo y mínimo para su región de interés exacta."),byTagNS(m.responseXML,"max",workspaceName)?(minVal=Number(byTagNS(m.responseXML,"min",workspaceName)),avgVal=Number(byTagNS(m.responseXML,"avg",workspaceName)),maxVal=Number(byTagNS(m.responseXML,"max",workspaceName))):(minVal=0,avgVal=.5,maxVal=1)}a+="<sld:Rule>"+i+'<PolygonSymbolizer><Fill><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill"><ogc:Function name="Interpolate"><ogc:PropertyName>'+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+"</ogc:PropertyName>",a+="<ogc:Literal>"+minVal+"</ogc:Literal><ogc:Literal>#"+lowColor+"</ogc:Literal>",a+="<ogc:Literal>"+avgVal+"</ogc:Literal><ogc:Literal>"+mixLowAndHighColors(.5)+"</ogc:Literal>",a+="<ogc:Literal>"+maxVal+"</ogc:Literal><ogc:Literal>#"+highColor+"</ogc:Literal>",a+="<ogc:Literal>color</ogc:Literal><ogc:Literal>cubic</ogc:Literal></ogc:Function>",1==curLanguage&&(o+="<sld:Rule><sld:Title>Low Value: "+cleanUpIfNumber(minVal*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(o+="<sld:Rule><sld:Title>Valor Bajo: "+cleanUpIfNumber(minVal*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),fillOn&&(o+='<Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(o+="<sld:Stroke/>"),o+="</PolygonSymbolizer></sld:Rule>",1==curLanguage&&(o+="<sld:Rule><sld:Title>Middle Value: "+cleanUpIfNumber(avgVal*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(o+="<sld:Rule><sld:Title>Valor Medio: "+cleanUpIfNumber(avgVal*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),fillOn&&(o+='<Fill><CssParameter name="fill">'+mixLowAndHighColors(.5)+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(o+="<sld:Stroke/>"),o+="</PolygonSymbolizer></sld:Rule>",1==curLanguage&&(o+="<sld:Rule><sld:Title>High Value: "+cleanUpIfNumber(maxVal*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(o+="<sld:Rule><sld:Title>Valor Alto: "+cleanUpIfNumber(maxVal*t)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit+"</sld:Title><PolygonSymbolizer>"),fillOn&&(o+='<Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(o+="<sld:Stroke/>"),o+="</PolygonSymbolizer></sld:Rule>",a+='</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(a+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>"}Ext.getCmp("chkNull").checked&&(a+="<sld:Rule><sld:Title>Conservation ROI Layer (null values)</sld:Title><ogc:Filter><ogc:PropertyIsNull><ogc:PropertyName>"+e+"</ogc:PropertyName></ogc:PropertyIsNull></ogc:Filter><PolygonSymbolizer>",1==curLanguage&&(o+="<sld:Rule><sld:Title>Null Values </sld:Title><PolygonSymbolizer>"),2==curLanguage&&(o+="<sld:Rule><sld:Title>Valores Nulos </sld:Title><PolygonSymbolizer>"),fillOn&&(a+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',o+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(a+="<sld:Stroke/>",o+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>",o+="</PolygonSymbolizer></sld:Rule>"),!colorSchemeOn|!fillOn&&(a+="<sld:Rule><sld:Title>Conservation ROI Layer</sld:Title><PolygonSymbolizer>",1==curLanguage&&(o+="<sld:Rule><sld:Title>Data Layer</sld:Title><PolygonSymbolizer>"),2==curLanguage&&(o+="<sld:Rule><sld:Title>Capa de Datos</sld:Title><PolygonSymbolizer>"),fillOn&&(a+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',o+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(a+="<sld:Stroke/>",o+="<sld:Stroke/>"),a+="</PolygonSymbolizer></sld:Rule>",o+="</PolygonSymbolizer></sld:Rule>"),a+="</sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>",updateDataLayerParams(),dataLayer.mergeNewParams({sld_body:a});var p=Ext.getCmp("datasource").getRawValue()+" Layer";2==curLanguage&&(p="Capa de "+Ext.getCmp("datasource").getRawValue()),colorSchemeOn&&fillOn||colorSchemeLegendLayer.setName(p),colorSchemeOn&&1==curLanguage&&colorSchemeLegendLayer.setName(Ext.getCmp("datasource").getRawValue()+" Layer Colored By: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName),colorSchemeOn&&2==curLanguage&&colorSchemeLegendLayer.setName(Ext.getCmp("datasource").getRawValue()+" Capa Matizada por: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName),o+="</sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>",colorSchemeLegendLayer.mergeNewParams({sld_body:o}),colorSchemeLegendLayer.setVisibility(!0),hansenLegendLayer.setVisibility(ghan.getVisibility()),1==ghan.getVisibility()&&(1==curLanguage&&(hansenLegendLayer.setName("Basemap: Forest Change 2000-2012"),hansenLegendLayer.mergeNewParams({styles:"hansenLegend"})),2==curLanguage&&(hansenLegendLayer.setName("Basemap: Cambio Forestal 2000-2012"),hansenLegendLayer.mergeNewParams({styles:"hansenLegend_span"})),hansenLegendLayer.setVisibility(!0))}}function medianResponse(e,t){}function checkMedian(e){if(userLayerActive)var t="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere_userdata",a="theAttribute:"+e+";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var t="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getMaxAvgMinWhere",a="theAttribute:"+e+";dataSource:"+dataSourceName;updateDataLayerParams();var o=t+"&viewparams="+a+";"+theViewParams,i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(byTagNS(i.responseXML,"median",workspaceName)?(medianVal=Number(byTagNS(i.responseXML,"median",workspaceName)),0==medianVal&&(1==curLanguage&&alert("Error: within your study area, the median value of benefit variable "+e+" is zero. This means that prioritization cannot proceed (see Instructions for more details). Please change your region of interest, update your data, or choose 'mean' as the method of normalizing benefits. However, using the mean to normalize benefits requires caution due to the mean's sensitivity to outliers."),2==curLanguage&&alert("Error: dentro de su área de estudio , el valore de mediana para la variable de "+e+" es cero . Esto significa que el establecimiento de prioridades no puede proceder (consulte Instrucciones para más detalles). Por favor, cambiar su región de interés , actualizar sus datos , o elegir 'promedio' como el método de los beneficios de la normalización . Sin embargo, utilizando la media para normalizar beneficios requiere precaución debido a la sensibilidad de la media de los valores atípicos."),prioritizationOn=!1)):(1==curLanguage&&alert("Warning: median value for the benefit variable "+e+" could not be determined. All values may be null."),2==curLanguage&&alert("Advertencia: el valore de mediana para la variable de "+e+" no se pudo determinar . Todos los valores pueden ser nulo.")))},i.open("POST","../../geoserver/"+workspaceName+"/ows",!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(o)}function updatePrioritization(){var e=prioritizationLayer.getVisibility();if(1==e&(4==dataSourceNum|6==dataSourceNum|7==dataSourceNum)&0==manualSelectOn&&(1==curLanguage&&Ext.Msg.alert("Warning","To work with this layer you must first select a smaller region using the DEFINE STUDY AREA panel."),2==curLanguage&&Ext.Msg.alert("Aviso","Para trabajar con esta capa, primero debe seleccionar una región más pequeña utilizando el panel DEFINIR ÁREA DE ESTUDIO."),e=!1,app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden"),e){prioritizationLayer.setVisibility(!1);var t="data_prioritize";if(userLayerActive&&(t+="_userdata"),priorityParams="dataSource:"+dataSourceName,userLayerActive&&(priorityParams+=";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName),(userLayerActive||1==dataSourceNum||2==dataSourceNum)&&(priorityParams+=";predAcessCode:519"),priorityParams+=";geomZero:519",priorityParams+=";locationParam:"+locationParamName+";budgetMax:",Ext.getCmp("rawRadio").getValue()?priorityParams+=Ext.getCmp("budget_raw").value:priorityParams+=Ext.getCmp("budget_percentage").value/100+"*(SELECT MAX(cumcost) FROM BenefitBudget)",priorityParams+=";"+whereClauseStr+";"+inClauseStr+";forestThreshold:"+forestThreshold,Ext.getCmp("chkRisk").getValue()?priorityParams+=";riskVar:risk":priorityParams+=";riskVar:1",Ext.getCmp("chkCost").getValue()?priorityParams+=";costVar:cost":priorityParams+=";costVar:1",Ext.getCmp("chkArea").getValue()?priorityParams+=";areaWeight:forarea*shape_area_ha":priorityParams+=";areaWeight:1",Ext.getCmp("chkMean").getValue()?priorityParams+=";medianOrMean:avg":priorityParams+=";medianOrMean:median",3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(priorityParams+=";carbonVar:"+Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field1+";bioVar:"+Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field1),"compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id)-1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(Ext.getCmp("compareObjectiveCombo").selectedIndex=0),0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CBH"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CBH_span"})),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CB"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CB_span"})),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CH"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CH_span"})),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_BH"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_BH_span"}));else{"combineTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id&&(priorityParams+=";weight1:"+Ext.getCmp("weight1").value,priorityParams+=";weight2:"+Ext.getCmp("weight2").value,priorityParams+=";weight3:"+Ext.getCmp("weight3").value);userLayerActive&&"_userdata",1==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_Default"}),2==curLanguage&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_Default_span"})}1==curLanguage&&prioritizationLayer.setName("Targeting:"),2==curLanguage&&prioritizationLayer.setName("Focalización:"),prioritizationLayer.mergeNewParams({layers:t,viewparams:priorityParams}),0==app.mapPanel.map.getLayersByName("Prioritization Layer").length&&1==e&&(app.mapPanel.map.getLayersByName("Selection").length>0&&app.mapPanel.map.removeLayer(selectLayer),app.mapPanel.map.addLayer(prioritizationLayer),app.mapPanel.map.addLayer(selectLayer))}prioritizationLayer.setVisibility(e),prioritizationLayer.redraw(),dataLayer.redraw(),e&!Ext.getCmp("chkMean").getValue()&&(checkMedian("carbon"),checkMedian("bio"),checkMedian("hydro"))}function setDataSource(e){idAttribute="fctt_id",1==e&&(dataSourceName="mredd",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="nom_na",locationData=[[0,"Study Area"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoacán/Mexico"],[5,"Yucután"],[6,"Chihuahua"]],spanishLocationData=[[0,"Zona de AATRs"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoacán/Mexico"],[5,"Yucután"],[6,"Chihuahua"]],linesOn=!0,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide(),Ext.getCmp("subdatasetLabel").hide()),2==e&&(dataSourceName="mex_pred",userLayerActive=!1,locationParamName="region",nameAttribute="nombpred",userLayerActive=!1,locationData=[[0,"Entire Country"],[1,"North West"],[2,"North"],[3,"North East"],[4,"Central West"],[5,"Central South"],[6,"South Pacific"],[7,"Gulf"],[8,"Peninsula"]],spanishLocationData=[[0,"País Íntegro"],[1,"Noroeste"],[2,"Norte"],[3,"Nordeste"],[4,"Centro-Oeste"],[5,"Centro Sur"],[6,"Pacifico Sur"],[7,"Golfo"],[8,"Península"]],linesOn=!1,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide(),Ext.getCmp("subdatasetLabel").hide()),3==e&&(dataSourceName="ca_10km",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Países"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show(),Ext.getCmp("subdatasetLabel").hide()),4==e&&(dataSourceName="ca_1km",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Países"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show(),Ext.getCmp("subdatasetLabel").hide()),5==e&&(dataSourceName="ca_adm",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Países"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!0,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").show(),Ext.getCmp("subdatasetLabel").hide()),6==e&&(dataSourceName="sa_10km",userLayerActive=!1,locationParamName="sitio_id",nameAttribute="",locationData=[[0,"All Countries"],[1,"Argentina"],[2,"Bolivia"],[3,"Brazil"],[4,"Chile"],[5,"Colombia"],[6,"Ecuador"],[7,"Guyana"],[8,"Paraguay"],[9,"Peru"],[10,"Suriname"],[11,"Uruguay"],[12,"Venezuela"]],spanishLocationData=[[0,"Todos Países"],[1,"Argentina"],[2,"Bolivia"],[3,"Brazil"],[4,"Chile"],[5,"Colombia"],[6,"Ecuador"],[7,"Guyana"],[8,"Paraguay"],[9,"Peru"],[10,"Suriname"],[11,"Uruguay"],[12,"Venezuela"]],linesOn=!1,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishSA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide(),Ext.getCmp("subdatasetLabel").hide()),7==e&&(dataSourceName="sa_1km_r1",userLayerActive=!1,locationParamName="1",nameAttribute="",locationData=[[0,"All"]],spanishLocationData=[[0,"Todos"]],linesOn=!1,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSA),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishSA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide(),subDataNum=1,Ext.getCmp("subdatasetLabel").show()),e>7&&(dataSourceName=phpVarDataSetList[e-numOnBoardDataSets],userDataSourceUOA=phpVarDataSetUOA[e-numOnBoardDataSets],userLayerActive=!0,locationParamName="1",nameAttribute="",Ext.getCmp("adminSelect").hide(),locationData=[[0,"All"]],spanishLocationData=[[0,"Todos"]],linesOn=!0,void 0!==Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"),1==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariables),2==curLanguage&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("chooseBenefits").hide(),Ext.getCmp("subdatasetLabel").hide()),userLayerActive?(dataSourceLayerName=workspaceName+":userlayer_query",2==selectMode&&(1==curLanguage&&Ext.Msg.alert("","Unfortunately, the Box/Manual Select Tool can not be used with user-defined layers at this time. Note that you can create an arbitrary region of interest for user-defined layers by restricting your shapefile to the fctt_id you are interested in before uploading the data in the User Console"),2==curLanguage&&Ext.Msg.alert("","Desafortunadamente, la Herramienta Caja/Selección Manual no se puede utilizar con capas definidas por el usuario en este momento. Tenga en cuenta que puede crear una región arbitraria de interés para las capas definidas por el usuario mediante la restricción de su archivo de formas a la fctt_id le interesa antes de cargar los datos en la consola de usuario."),Ext.getCmp("selectsubmitselection").disable())):dataSourceLayerName=7==e?workspaceName+":sa_1km_query":workspaceName+":"+dataSourceName+"_query",1==curLanguage&&Ext.getCmp("regionSelectCombo").bindStore(locationData),2==curLanguage&&Ext.getCmp("regionSelectCombo").bindStore(spanishLocationData)}function updateLanguage(){if(0==phpVarIsLoggedIn&&Ext.getCmp("loginRegisterWindowBox").refreshMe("../../usersystem/splashscreen.php?lang="+curLanguage),1==phpVarIsLoggedIn&&0==Ext.getCmp("returnToFCTTItem").hidden&&(app.mapPanel.map.div.innerHTML="<iframe src='../../usersystem/userconsole.php?lang="+curLanguage+"' width = 100% height = 100%></iframe>"),1==curLanguage){Ext.getCmp("appCopyright").setText("© 2014 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission."),Ext.getCmp("howToItem").setText("How To"),Ext.getCmp("instructionsItem").setText("Instructions"),Ext.getCmp("descriptionItem").setText("Description"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("User Questions"),Ext.getCmp("emailItem").setText("Email"),Ext.getCmp("aboutItem").setText("About"),Ext.getCmp("metadataItem").setText("Metadata"),Ext.getCmp("sponsorsItem").setText("Sponsors"),Ext.getCmp("teamItem").setText("Team"),Ext.getCmp("emailItem2").setText("Email"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("User Questions"),Ext.getCmp("userCommentsItem").setText("User Comments"),Ext.getCmp("emailItem3").setText("Email"),1==phpVarIsLoggedIn?Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName):Ext.getCmp("loginItem").setText("Use your own data"),Ext.getCmp("userConsoleItem").setText("User Console"),Ext.getCmp("returnToFCTTItem").setText("Reload FCTT"),Ext.getCmp("logoutItem").setText("Logout"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>"),Ext.getCmp("regionPanel").setTitle("DEFINE STUDY AREA"),Ext.getCmp("datasetLabel").label.update("Dataset:"),Ext.getCmp("subdatasetLabel").label.update("Subdataset:"),loadUserLayers([[6,"South America 10km"],[7,"South America 1km"],[5,"Central America Administrative"],[3,"Central America 10km"],[4,"Central America 1km"],[2,"Mexico Predios"],[1,"MREDD AATRs"]]),Ext.getCmp("regionLabel").label.update("Region:"),Ext.getCmp("regionSelectCombo").bindStore(locationData),Ext.getCmp("regionSelectCombo").setValue(Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field2),Ext.getCmp("thresholdLabel").label.update("Minimum forest cover:"),Ext.getCmp("adminSelect").setTitle("By administrative boundary"),Ext.getCmp("manuallySelect").setTitle("Using manual selection tool"),Ext.getCmp("selectionMode").label.update("Selection mode:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Polygon"],[2,"Box"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("DISPLAY OPTIONS"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),Ext.getCmp("shpLinesLabel").label.update("Shape lines"),Ext.getCmp("shpFillLabel").label.update("Shape fill"),Ext.getCmp("opacityLabel").label.update("Opacity"),Ext.getCmp("margLayerLabel").label.update("Marginality Layer"),Ext.getCmp("basemapLabel").label.update("Base map type"),Ext.getCmp("basemapCombo").bindStore([[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satellite"],[4,"Microsoft Bing Street Map"],[5,"Forest Change(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Show Scale"),Ext.getCmp("panZoomLabel").label.update("Pan/Zoom Tool"),Ext.getCmp("mouseWheelLabel").label.update("Mouse wheel zoom"),Ext.getCmp("colorByAttributePanel").setTitle("TARGETING DATA"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Low color</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">High color</div>'),Ext.getCmp("methodLabel").label.update("Method"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolate"],[1,"Quantiles"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Quantiles");e=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();Ext.getCmp("colorAttribute").store=prioritizationVariables,3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesCA),6==dataSourceNum|7==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(e),Ext.getCmp("chkNullLabel").label.update("Show null values"),Ext.getCmp("chkNull").wrap.child(".x-form-cb-label").update("(in default color)"),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("selectPanel").setTitle("TARGET"),Ext.getCmp("chooseBenefits").setTitle("Choose Benefit Variables"),Ext.getCmp("carbonBenefitLabel").label.update("Carbon:"),Ext.getCmp("bioBenefitLabel").label.update("Biodiversity:"),Ext.getCmp("carbonBenefitChoose").bindStore([["carbon","Non-soil carbon"],["carbon_total","Total carbon"],["carbon_soil","Carbon in soil"]]),Ext.getCmp("carbonBenefitChoose").setValue(Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field2),Ext.getCmp("bioBenefitChoose").bindStore([["bio","Global RWRI"],["bio_loc","National RWRI"],["bio_count","Threat. species count"]]),Ext.getCmp("bioBenefitChoose").setValue(Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field2),Ext.getCmp("priorityBudget").setTitle("Choose Budget"),Ext.getCmp("percentageRadio").el.next("label").update('<span style="font-size: 12px;">Percentage of total:</span>'),Ext.getCmp("rawRadio").el.next("label").update('<span style="font-size: 12px;">Raw budget:</span>'),Ext.getCmp("combineTab").setTitle("Weight Benefits"),Ext.getCmp("carbonweightfield").label.update('<div style="color: green; font-weight: bold">Carbon:</div>'),Ext.getCmp("bioweightfield").label.update('<div style="color: red; font-weight: bold">Biodiversity:</div>'),Ext.getCmp("hydroweightfield").label.update('<div style="color: blue; font-weight: bold">Hydrological:</div>'),Ext.getCmp("compareTab").setTitle("Compare"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"All Benefits"],[1,"Carbon and Biodiversity"],[2,"Carbon and Hydro"],[3,"Biodiversity and Hydro"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),Ext.getCmp("chkRiskLabel").label.update("Scale benefits by deforestation risk"),Ext.getCmp("chkCostLabel").label.update("Divide expected benefits by cost"),Ext.getCmp("chkAreaLabel").label.update("Scale total costs by forest area"),Ext.getCmp("chkMeanLabel").label.update("Normalize benefits by mean instead of median"),Ext.getCmp("priorityOpacityLabel").label.update("Opacity:"),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("printButton").setText("<div style='color:black;font-size: 12'>Print/PDF</div>"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>"),Ext.getCmp("resetLegend").setText("Reset Legend Position"),Ext.getCmp("exportPanel").setTitle("EXPORT"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Export Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Export CSV</div>"),void 0!==instructionsWindowSp&&(instructionsWindowSp.hidden||(instructionsWindow.show(),instructionsWindowSp.hide())),Ext.getCmp("myLegend").setTitle("Legend"),marginalityLayer.setName("Marginalization Index")}if(2==curLanguage){Ext.getCmp("appCopyright").setText("© 2014 Resources for the Future. Reservados todos los derechos. Ninguna porción de los datos o el modelo puede ser usado sin permiso."),Ext.getCmp("howToItem").setText("Cómo"),Ext.getCmp("instructionsItem").setText("Instrucciones"),Ext.getCmp("descriptionItem").setText("Descripción"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("Preguntas de Usuarios"),Ext.getCmp("emailItem").setText("Correo"),Ext.getCmp("aboutItem").setText("Acerca de"),Ext.getCmp("metadataItem").setText("Metadatos"),Ext.getCmp("sponsorsItem").setText("Promotores"),Ext.getCmp("teamItem").setText("Equipo"),Ext.getCmp("emailItem2").setText("Correo"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("Preguntas de Usuarios"),Ext.getCmp("userCommentsItem").setText("Comentarios de Usuarios"),Ext.getCmp("emailItem3").setText("Correo"),1==phpVarIsLoggedIn?Ext.getCmp("loginItem").setText("Conectado como "+phpVarUserName):Ext.getCmp("loginItem").setText("Utilice sus propios datos"),Ext.getCmp("userConsoleItem").setText("Consola de Usuario"),Ext.getCmp("returnToFCTTItem").setText("Recargar FCTT"),Ext.getCmp("logoutItem").setText("Cerrar Sesión"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Caja de Herramientas</div>"),Ext.getCmp("regionPanel").setTitle("DEFINIR ÁREA DE ESTUDIO"),Ext.getCmp("datasetLabel").label.update("Datos:"),Ext.getCmp("subdatasetLabel").label.update("Subdatos:"),loadUserLayers([[6,"Sudamerica 10km"],[7,"Sudamerica 1km"],[5,"Centroamérica Administrativa"],[3,"Centroamérica 10km"],[4,"Centroamérica 1km"],[2,"Predios de Mexico"],[1,"MREDD AATRs"]]),Ext.getCmp("regionLabel").label.update("Región:"),Ext.getCmp("regionSelectCombo").bindStore(spanishLocationData),Ext.getCmp("regionSelectCombo").setValue(Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field2),Ext.getCmp("thresholdLabel").label.update("Cubierta forestal mínima:"),Ext.getCmp("adminSelect").setTitle("Por límites administrativos"),Ext.getCmp("manuallySelect").setTitle("Seleccionar manualmente"),Ext.getCmp("selectionMode").label.update("Modo de selección:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Polígono"],[2,"Caja"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("OPCIONES DE VISUALIZACIÓN"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Color de Relleno Defecto</div>'),Ext.getCmp("shpLinesLabel").label.update("Líneas poligonales"),Ext.getCmp("shpFillLabel").label.update("Relleno de forma"),Ext.getCmp("opacityLabel").label.update("Opacidad"),Ext.getCmp("priorityOpacityLabel").label.update("Opacidad"),Ext.getCmp("margLayerLabel").label.update("Capa de Marginalidad"),Ext.getCmp("basemapLabel").label.update("Tipo de basemap"),Ext.getCmp("basemapCombo").bindStore([[0,"Ninguno"],[1,"Google Físico"],[2,"Google Híbrido"],[3,"Google Satélite"],[4,"Microsoft Bing (calles)"],[5,"Cambio Forestal(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Mostrar Escala"),Ext.getCmp("panZoomLabel").label.update("Ampliar/Recorrer"),Ext.getCmp("mouseWheelLabel").label.update("Zoom con rueda del mouse"),Ext.getCmp("colorByAttributePanel").setTitle("DATOS DE FOCALIZACIÓN"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("methodLabel").label.update("Método"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolar"],[1,"Cuantilas"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Cuantilas");var e=Ext.getCmp("colorAttribute").getSelectionModel().getSelectedIndex();Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish,3==dataSourceNum|4==dataSourceNum|5==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishCA),6==dataSourceNum|7==dataSourceNum&&(Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanishSA),Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("colorAttribute").getSelectionModel().selectRow(e),Ext.getCmp("chkNullLabel").label.update("Mostrar val. nulos"),Ext.getCmp("chkNull").wrap.child(".x-form-cb-label").update("(en color defecto)"),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Actualizar Visualización</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("selectPanel").setTitle("FOCALIZAR"),Ext.getCmp("chooseBenefits").setTitle("Elegir Variables de Beneficios"),Ext.getCmp("carbonBenefitLabel").label.update("Carbono:"),Ext.getCmp("bioBenefitLabel").label.update("Biodiversidad:"),Ext.getCmp("carbonBenefitChoose").bindStore([["carbon","Carbono no suelo"],["carbon_total","Carbono total"],["carbon_soil","Carbono en el suelo"]]),Ext.getCmp("carbonBenefitChoose").setValue(Ext.getCmp("carbonBenefitChoose").store.data.items[Ext.getCmp("carbonBenefitChoose").selectedIndex].data.field2),Ext.getCmp("bioBenefitChoose").bindStore([["bio","RWRI Global"],["bio_loc","RWRI Nacional"],["bio_count","Núm. esp. amenazadas"]]),Ext.getCmp("bioBenefitChoose").setValue(Ext.getCmp("bioBenefitChoose").store.data.items[Ext.getCmp("bioBenefitChoose").selectedIndex].data.field2),Ext.getCmp("priorityBudget").setTitle("Elegir Presupuesto"),Ext.getCmp("percentageRadio").el.next("label").update('<span style="font-size: 12px;">Porcentaje del total:</span>'),Ext.getCmp("rawRadio").el.next("label").update('<span style="font-size: 12px;">Prima:</span>'),Ext.getCmp("combineTab").setTitle("Ponderar Beneficios"),Ext.getCmp("carbonweightfield").label.update('<div style="color: green; font-weight: bold">Carbono:</div>'),Ext.getCmp("bioweightfield").label.update('<div style="color: red; font-weight: bold">Biodiversidad:</div>'),Ext.getCmp("hydroweightfield").label.update('<div style="color: blue; font-weight: bold">Hidrológico:</div>'),Ext.getCmp("compareTab").setTitle("Comparar"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"Todos Beneficios"],[1,"Carbono y Biodiversidad"],[2,"Carbon y Hidrológico"],[3,"Biodiversidad y Hidrológico"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("chkRiskLabel").label.update("Escalar lost beneficios por riesgo"),Ext.getCmp("chkCostLabel").label.update("Divida a los beneficios esperados por el costo"),Ext.getCmp("chkAreaLabel").label.update("Escalar los costos totales del área de bosque"),Ext.getCmp("chkMeanLabel").label.update("Normalizar beneficios por la media en lugar de la mediana"),Ext.getCmp("priorityOpacityLabel").label.update("Opacidad:"),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Entregar/Actualizar</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("printButton").setText("<div style='color:black;font-size: 12'>Imprimir/PDF</div>"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Restablecer Todo</div>"),Ext.getCmp("resetLegend").setText("Restablecer Leyenda"),Ext.getCmp("exportPanel").setTitle("EXPORTAR"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Exportar Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Exportar CSV</div>"),void 0!==instructionsWindow&&(instructionsWindow.hidden||(instructionsWindow.hide(),instructionsWindowSp.show())),Ext.getCmp("myLegend").setTitle("Leyenda"),marginalityLayer.setName("Índice de Marginación")}resetLegendPosition(),updateStyling(),updatePrioritization(),updateOnZoom(app.mapPanel.map.getZoom())}function updateSelectionButtonLanguage(){1==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selección</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),"<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Clear/Cancel</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>")),2==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selección</div>"),"<div style='color:black;font-size: 12'>Clear/Cancel</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"))}function componentToHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function rgbToHex(e,t,a){return"#"+componentToHex(e)+componentToHex(t)+componentToHex(a)}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function mixLowAndHighColors(e){return rgbToHex(Math.floor(e*hexToRgb(highColor).r+(1-e)*hexToRgb(lowColor).r),Math.floor(e*hexToRgb(highColor).g+(1-e)*hexToRgb(lowColor).g),Math.floor(e*hexToRgb(highColor).b+(1-e)*hexToRgb(lowColor).b))}function openPage(e,t){new Ext.Window({title:t,width:.8*window.innerWidth,height:.9*window.innerHeight,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:e}}]}).show()}function zoomToRegion(){var e=new OpenLayers.Bounds;if(userLayerActive)var t="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents_userdata",a="layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName;else var t="service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents",a="dataSource:"+dataSourceName;updateDataLayerParams();var o=t+"&viewparams="+a+";"+theViewParams,i=new XMLHttpRequest;i.open("POST","../../geoserver/"+workspaceName+"/ows",!1),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(o),byTagNS(i.responseXML,"xmin",workspaceName)?(e.left=Number(byTagNS(i.responseXML,"xmin",workspaceName)),e.right=Number(byTagNS(i.responseXML,"xmax",workspaceName)),e.top=Number(byTagNS(i.responseXML,"ymin",workspaceName)),e.bottom=Number(byTagNS(i.responseXML,"ymax",workspaceName))):(e.left=-92.2223587033315,e.right=-68.3226394649928,e.top=5.49902677495186,e.bottom=19.9323616027744),e=6==dataSourceNum?e.scale(.6):e.scale(1.2),app.mapPanel.map.zoomToExtent(e.transform("EPSG:4326","EPSG:900913"),!1)}function resetLegendPosition(){myLegend.show();var e=app.mapPanel.el.getTop()+5;myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,e]),1==curLanguage&&(window.innerWidth,Ext.getCmp("appTitle").setText("Forest Conservation Targeting Tool (Beta)"),Ext.getCmp("appTitle").setWidth(window.innerWidth-700),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-700)),2==curLanguage&&(window.innerWidth,Ext.getCmp("appTitle").setText("Herramienta Focalización de Conservación Forestal (Beta)"),Ext.getCmp("appTitle").setWidth(window.innerWidth-700),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-700))}function updateOnZoom(e){0==inUserConsole&&(e<8&&4==dataSourceNum&&(1==curLanguage&&(imgZoomEng.style.visibility="visible",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="visible"),dataLayer.setVisibility(!1),imgWait.style.visibility="hidden"),e<8&&7==dataSourceNum&&(1==curLanguage&&(imgZoomEng.style.visibility="visible",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="visible"),dataLayer.setVisibility(!1),imgWait.style.visibility="hidden"),(e>=8||4!=dataSourceNum&&7!=dataSourceNum)&&(1==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),dataLayer.setVisibility(!0)),e>13&&1==ghan.getVisibility()&&(ghan.setVisibility(!1),ghanActive=!0),e<=13&&1==ghanActive&&ghan.setVisibility(!0),e>18&&1==gosm.getVisibility()&&(gosm.setVisibility(!1),gosmActive=!0),e<=18&&1==gosmActive&&gosm.setVisibility(!0))}function updateDataLayerParams(){theViewParams=inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold,userLayerActive&&(theViewParams+=";layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName),(userLayerActive||1==dataSourceNum||2==dataSourceNum)&&(theViewParams+=";predAcessCode:519"),7==dataSourceNum&&(theViewParams+=";regionNum:"+subDataNum),dataLayer.mergeNewParams({layers:dataSourceLayerName,viewparams:theViewParams})}function loadUserLayers(e){if(1==phpVarIsLoggedIn){phpVarNumDataSets>0&&e.push([-1,"----------------------"]);for(var t=1;t<=phpVarNumDataSets;t++){var a=t+numOnBoardDataSets;e.push([a.toString(),phpVarDataSetList[t]])}}Ext.getCmp("datasource").bindStore(e),Ext.getCmp("datasource").setValue(dataSourceNum)}function featuresFromXY(e){var t=app.mapPanel.map.getLonLatFromPixel(e);t.transform("EPSG:900913","EPSG:4326");var a={method:"GET",async:!1};a.url=userLayerActive?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_userdata&viewparams=layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName+";predAcessCode:519":3==dataSourceNum||4==dataSourceNum||5==dataSourceNum?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_ca&viewparams=dataSource:"+dataSourceName.replace("ca_",""):6==dataSourceNum||7==dataSourceNum?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_sa&viewparams=dataSource:"+dataSourceName:"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getFeatureInfo_mex&viewparams=layerPIN:"+phpVarlayerPIN+";userName:"+phpVarUserName+";dataSource:"+dataSourceName+";predAcessCode:519",a.url+=";latCoord:"+t.lat+";lonCoord:"+t.lon;var o=OpenLayers.Request.issue(a);return new OpenLayers.Format.GML({extractAttributes:!0}).read(o.responseText)}function byTagNS(e,t,a){return gottenElement=e.getElementsByTagName(a+":"+t)[0],gottenElement&&null!=gottenElement&&0!=gottenElement.length||(gottenElement=e.getElementsByTagName(t)[0]),!(!gottenElement||null==gottenElement||0==gottenElement.length)&&gottenElement.textContent}function cleanUpIfNumber(e){return isNaN(e)?String(e):Number(e)>999999?String(Number(e).toExponential(3)):0==Number(e).toFixed(3)?String(Number(e).toExponential(3)):Number.isInteger(Number(e))?String(Number(e)):String(Number(e).toFixed(3))}if(void 0===phpVarUserName)var phpVarUserName="notloggedin",phpVarlayerPIN="notloggedin";Ext.BLANK_IMAGE_URL="ext/resources/images/default/s.gif";var app,items=[],controls=[],toolItems=[],lowColor="0000FF",highColor="FF0000",defaultColor="003300",selectedFillColor="e2ff00",linesOn=!1,fillOn=!0,colorSchemeOn=!1,manualSelectOn=!1,inUserConsole=0,navigationMode=!0,tilesLeftToLoad=1,inClauseStr="idAttribute:1;inSet:1";whereClauseStr="whereParam:1;whereValue:1",priorityParams="",prioritizationOn=!1,theViewParams="",selectMode=1,ghanActive=!1,gosmActive=!1,forestThreshold=25;var minVal=0,avgVal=.5,maxVal=1,subDataNum=0,curLanguage=2,userLayerActive=!1,locationParamName,nameAttribute,locationData,spanishLocationData,idAttribute,workspaceName="forestro_users_ws",dataSourceName="ca_adm",dataSourceLayerName="ca_adm_query",userDataSourceUOA="",topBarHeight=40,imgWait=document.createElement("IMG");imgWait.src="images/loading.gif",imgWait.style.pointerEvents="none",imgWait.style.position="absolute",imgWait.style.top=225,imgWait.style.left=450,imgWait.style.zIndex=9999,imgWait.style.visibility="hidden";var imgZoomEng=document.createElement("IMG");imgZoomEng.id="imgzoomeng",imgZoomEng.src="images/zoomin_english.gif",imgZoomEng.style.pointerEvents="none",imgZoomEng.style.position="absolute",imgZoomEng.style.top=225,imgZoomEng.style.left=450,imgZoomEng.style.zIndex=9998,imgZoomEng.style.visibility="hidden";var imgZoomSpan=document.createElement("IMG");imgZoomSpan.id="imgzoomspan",imgZoomSpan.src="images/zoomin_spanish.gif",imgZoomSpan.style.pointerEvents="none",imgZoomSpan.style.position="absolute",imgZoomSpan.style.top=225,imgZoomSpan.style.left=450,imgZoomSpan.style.zIndex=9998,imgZoomSpan.style.visibility="hidden";var numOnBoardDataSets=6,dataSourceNum=5,isIE=!!document.documentMode,instructionsWindow=new Ext.Window({title:"Instructions",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define.html"}}],listeners:{minimize:{fn:function(){instructionsWindow.hide()}}}}),instructionsWindowSp=new Ext.Window({title:"Instrucciones",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define_sp.html"}}],listeners:{minimize:{fn:function(){instructionsWindowSp.hide()}}}}),loginRegisterWindow=new Ext.Window({width:.8*(window.innerWidth-0),height:.85*(window.innerHeight-topBarHeight),x:.1*(window.innerWidth-0)+0,y:.1*(window.innerHeight-topBarHeight)+topBarHeight,resizable:!1,draggable:!0,closable:!1,minimizable:!1,anchor:!0,frame:!1,shadow:!1,border:!0,bodyStyle:"opacity:1;",layout:"vbox",listeners:{minimize:function(){loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable()}},tools:[{id:"bigminimize",qtip:"Minimize",handler:function(e,t,a){loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable()}}],items:[{xtype:"box",id:"loginRegisterWindowBox",width:.8*(window.innerWidth-0),height:.85*(window.innerHeight-topBarHeight),margin:10,autoEl:{tag:"iframe",frameborder:0,src:""},refreshMe:function(e){var t;(t=this.el)&&(t.dom.src=e||this.imageSrc)},listeners:{render:function(){this.refreshMe()}}}]});Ext.onReady(function(){if(app=new Ext.Viewport({layout:"border",id:"app",border:0,items:[topbar,toolpanel,map,bottombar]}),setDataSource(dataSourceNum),Ext.getCmp("optionsPanel").collapse(),Ext.getCmp("colorByAttributePanel").collapse(),Ext.getCmp("selectPanel").collapse(),myLegend.show(),myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,app.mapPanel.el.getTop()+5]),Ext.getCmp("regionSelectCombo").setValue(0),Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("datasource").selectedIndex=0,Ext.getCmp("selectModeCombo").selectedIndex=0,Ext.getCmp("basemapCombo").selectedIndex=1,Ext.getCmp("methodCombo").selectedIndex=0,Ext.getCmp("compareObjectiveCombo").selectedIndex=0,Ext.getCmp("carbonBenefitChoose").selectedIndex=0,Ext.getCmp("bioBenefitChoose").selectedIndex=0,Ext.getCmp("topBar").getEl().dom.style.background="#4682B4",phpVarIsLocalHost){var e={method:"GET",async:!1};e.url="../../geoserver/wms?request=GetCapabilities",e.user="registereduser",e.password=phpVarGeoServerLogin;OpenLayers.Request.issue(e);e.url="../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":getExtents&viewparams=dataSource:"+dataSourceName,e.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold;OpenLayers.Request.issue(e)}curLanguage=phpVarLanguageToLoadIn,updateLanguage(),1==curLanguage&&Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName),2==curLanguage&&Ext.getCmp("loginItem").setText("Conectado como "+phpVarUserName),Ext.getCmp("loginItem").show(),Ext.getCmp("returnToFCTTItem").hide(),Ext.getCmp("userConsoleItem").show(),Ext.getCmp("logoutItem").show(),Ext.getCmp("loginItem").getEl().removeClass("hidearrow"),app.mapPanel.map.addLayer(hansenLegendLayer),app.mapPanel.map.addLayer(colorSchemeLegendLayer),app.mapPanel.map.addLayer(marginalityLayer),app.mapPanel.map.addLayer(dataLayer),app.mapPanel.map.addLayer(selectLayer),1==phpVarIsLoggedIn||(loginRegisterWindow.show(),loginRegisterWindow.hide(),1==curLanguage&&Ext.getCmp("loginItem").setText("Use your own data"),2==curLanguage&&Ext.getCmp("loginItem").setText("Utilice sus propios datos"),Ext.getCmp("userConsoleItem").hide(),Ext.getCmp("logoutItem").hide(),Ext.getCmp("loginItem").getEl().addClass("hidearrow")),registerEvents(dataLayer),registerEvents(prioritizationLayer),imgWait.style.top=(parseInt(app.mapPanel.body.dom.style.height)-128)/2,imgWait.style.left=(parseInt(app.mapPanel.body.dom.style.width)-128)/2,document.getElementById("map").appendChild(imgWait),imgZoomEng.style.top=50,imgZoomEng.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomEng),imgZoomSpan.style.top=50,imgZoomSpan.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomSpan),updateLanguage(),app.mapPanel.map.addControl(infoClick),infoClick.activate(),app.mapPanel.map.addControl(infoHover),infoHover.deactivate(),ghan.setVisibility(!1),ghyb.setVisibility(!1),gsat.setVisibility(!1),gosm.setVisibility(!1),gphy.setVisibility(!0),marginalityLayer.setVisibility(!1),prioritizationLayer.setVisibility(!1),updateStyling(),myLegend.syncShadow()}),Ext.chromeVersion=Ext.isChrome?parseInt(/chrome\/(\d{2})/.exec(navigator.userAgent.toLowerCase())[1],10):NaN,Ext.grid.ColumnModel.override({getTotalWidth:function(e){if(!this.totalWidth){var t=Ext.isChrome&&Ext.chromeVersion>18?2:0;this.totalWidth=0;for(var a=0,o=this.config.length;a<o;a++)!e&&this.isHidden(a)||(this.totalWidth+=this.getColumnWidth(a)+t)}return this.totalWidth}}),phpVarIsLocalHost&&(printCapabilities.createURL="../../geoserver/pdf/create.json",printCapabilities.printURL="../../geoserver/pdf/print.pdf");var printProvider=new GeoExt.data.PrintProvider({url:"../../geoserver/pdf",user:"registereduser",password:phpVarGeoServerLogin,method:"POST",capabilities:printCapabilities,timeout:1e5,customParams:{mapTitle:"",comment:"www.conservationroi.net",attributionText:""},listeners:{beforeprint:function(){app.mapPanel.body.dom.style.cursor="wait",imgWait.style.visibility="visible"},print:function(){app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden",Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy()},printexception:function(){1==curLanguage&&alert("Sorry, there was an error while generating the PDF file. Please contact fc-targeting-tool@rff.org to report this problem."),2==curLanguage&&alert("Lo sentimos, hubo un error al generar el archivo PDF. Por favor, póngase en contacto con fc-targeting-tool@rff.org reportar este problema."),app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden",Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy()}}});if(printPage=new GeoExt.data.PrintPage({printProvider:printProvider}),printProvider.dpis.totalLength>2){var dpi=printProvider.dpis.getAt(printProvider.dpis.totalLength-2);printProvider.setDpi(dpi)}var myLegend=new Ext.Window({id:"myLegend",title:"Legend",width:250,collapsible:!0,autoScroll:!0,layout:"anchor",closable:!1,monitorResize:!0,items:[legendPanel=new GeoExt.LegendPanel({defaults:{id:"myLegendPanel",name:"legend",labelCls:"mylabel",style:"padding:5px",baseParams:{format:"image/png",legend_options:"forceLabels:on"}},preferredTypes:["gx_wmslegend"],dynamic:!0,bodyStyle:"padding:5px",autoScroll:!0,region:"west"})]}),gphy=new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),ghyb=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gsat=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gosm=new OpenLayers.Layer.Bing({name:"Street Map from Bing",key:"AjLkKtM4SsAS70LNS4LKSne_Kk-dhlcf4GM5_5xEzAdLtC46M5Z4vAqhZojRQUh5",type:"Road"}),ghan=new OpenLayers.Layer.XYZ("Hansen Forest Cover","http://earthengine.google.org/static/hansen_2013/loss_forest_gain/${z}/${x}/${y}.png",{sphericalMercator:!0,attribution:"Hansen et al. 2014",isBaseLayer:!0}),dataLayer=new OpenLayers.Layer.WMS("Data Layer","../../geoserver/wms",{layers:dataSourceLayerName,transparent:!0},{singleTile:!0,transitionEffect:"resize",opacity:.65,displayInLayerSwitcher:!1,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),marginalityLayer=new OpenLayers.Layer.WMS("Marginalization Index","../../geoserver/wms",{layers:"forestro_users_ws:marginality",transparent:!0,styles:"marginality"},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!0,opacity:1,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),selectLayer=new OpenLayers.Layer.Vector("Selection",{displayInLayerSwitcher:!1,transparent:!0}),prioritizationLayer=new OpenLayers.Layer.WMS("Prioritization Results","../../geoserver/wms",{layers:workspaceName+":data_prioritize",transparent:!0},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!0,opacity:.9,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:5e3}});prioritizationLayer.setVisibility(!1);var highlightedFeaturesCopy=selectLayer.clone(),colorSchemeLegendLayer=new OpenLayers.Layer.WMS("Color By Attribute Scheme","../../geoserver/wms",{layers:workspaceName+":dummyDataLayerForWMSLegend",transparent:!0},{isBaseLayer:!1,displayInLayerSwitcher:!0}),hansenLegendLayer=new OpenLayers.Layer.WMS("Hansen Basemap","../../geoserver/wms",{layers:workspaceName+":dummyDataLayerForWMSLegend",transparent:!0},{isBaseLayer:!1,displayInLayerSwitcher:!0}),prioritizationVariables=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbon"," t/ha"],["bio","Biodiversity"," RWRI"],["hydro","Hydrological services index",""],["risk","Deforestation risk","%"],["cost","Cost"," ($ or pes)/ha"],["forarea","Percent forest coverage"," %"],["scenario1","Carbon  expected benefit per cost",""],["scenario2","Biodiversity expected benefit per cost",""],["scenario3","Hydro  expected benefit per cost",""]]}),prioritizationVariablesSpanish=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbono"," t/ha"],["bio","Biodiversidad"," RWRI"],["hydro","Indice de servicios hidrológicos",""],["risk","Riesgo de deforestación","%"],["cost","Costo"," ($ o pes)/ha"],["forarea","Cubierta forestal porcentaje"," %"],["scenario1","Beneficio esperado de carbono por costo",""],["scenario2","Beneficio esperado biodiversidad  por costo",""],["scenario3","Beneficio esperado hidrológico por costo",""]]}),prioritizationVariablesCA=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Non-soil carbon (biomass)"," t/ha"],["carbon_total","Total carbon (biomass and soil)"," t/ha"],["carbon_soil","Carbon in soil"," t/ha"],["bio","RWRI biodiversity index (global weights)"," RWRI"],["bio_loc","RWRI biodiversity index (national weights)"," RWRI"],["bio_count","Threatened species count"," #"],["hydro","Hydrological services index",""],["risk","Deforestation risk","%"],["cost","Cost"," ($ or pes)/ha"],["forarea","Percent forest coverage"," %"],["scenario1","Carbon (non-soil) expected benefit per cost",""],["scenario2","Biodiversity (global RWRI) expected benefit per cost",""],["scenario3","Hydro  expected benefit per cost",""]]}),prioritizationVariablesSpanishCA=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbono no suelo (biomasa)"," t/ha"],["carbon_total","Carbono total (biomasa y suelo)"," t/ha"],["carbon_soil","Carbono en el suelo"," t/ha"],["bio","Índice RWRI de biodiversidad (pesos globales)"," RWRI"],["bio_loc","Índice RWRI de biodiversidad (pesos nacionales)"," RWRI"],["bio_count","Número especies amenazadas"," #"],["hydro","Indice de servicios hidrológicos",""],["risk","Riesgo de deforestación","%"],["cost","Costo"," ($ o pes)/ha"],["forarea","Cubierta forestal porcentaje"," %"],["scenario1","Beneficio esperado de carbono (no suelo) por costo",""],["scenario2","Beneficio esperado biodiversidad (RWRI global) por costo",""],["scenario3","Beneficio esperado hidrológico por costo",""]]}),prioritizationVariablesSA=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbon"," t/ha"],["bio","RWRI biodiversity index * 10^6 (global weights)"," RWRI"],["bio_count","Threatened species count"," #"],["hydro","Hydrological services index",""],["risk","Deforestation risk","%"],["cost","Cost"," ($ or pes)/ha"],["forarea","Percent forest coverage"," %"],["scenario1","Carbon (non-soil) expected benefit per cost",""],["scenario2","Biodiversity (global RWRI) expected benefit per cost",""],["scenario3","Hydro  expected benefit per cost",""]]}),prioritizationVariablesSpanishSA=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbono"," t/ha"],["bio","Índice RWRI de biodiversidad * 10^6 (pesos globales)"," RWRI"],["bio_count","Número especies amenazadas"," #"],["hydro","Indice de servicios hidrológicos",""],["risk","Riesgo de deforestación","%"],["cost","Costo"," ($ o pes)/ha"],["forarea","Cubierta forestal porcentaje"," %"],["scenario1","Beneficio esperado de carbono (no suelo) por costo",""],["scenario2","Beneficio esperado biodiversidad (RWRI global) por costo",""],["scenario3","Beneficio esperado hidrológico por costo",""]]}),map={xtype:"gx_mappanel",id:"map",ref:"mapPanel",region:"center",fractionalZoom:!0,layers:[ghan,gosm,gsat,ghyb,gphy],map:{controls:controls,eventListeners:{zoomend:function(){updateOnZoom(this.getZoom())}}},extent:OpenLayers.Bounds.fromArray([-103e5,23e5,-75e5,76e4])};OpenLayers.Control.CustomNavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(e){OpenLayers.Control.Panel.prototype.initialize.apply(this,[e]),this.addControls([new OpenLayers.Control.ZoomBox({type:OpenLayers.Control.TYPE_TOGGLE,title:"Toggle Box Zoom Tool",zoomOnClick:!1})]),this.displayClass="olControlNavToolbar"},draw:function(){return OpenLayers.Control.Panel.prototype.draw.apply(this,arguments)}}),controls.push(navControl=new OpenLayers.Control.Navigation({zoomWheelEnabled:!0,mouseWheelOptions:{interval:250,cumulative:!1}}),panzoomControl=new OpenLayers.Control.PanZoom,attributionControl=new OpenLayers.Control.Attribution,keyboardPanZoomControl=new OpenLayers.Control.KeyboardDefaults,scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}),navZoomControl=new OpenLayers.Control.CustomNavToolbar,showCoordinates=new OpenLayers.Control.MousePosition({displayProjection:"ESPG:4326",separator:" | ",numDigits:2}));var selectBox=new OpenLayers.Control.GetFeature({id:"selectControl",protocol:OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer,{vendorParams:"predAcessCode:519"}),click:!1,clickTolerance:0,box:!0,multipleKey:"shiftKey",toggleKey:"ctrlKey"});selectBox.events.register("featureselected",this,function(e){selectLayer.addFeatures([e.feature])}),selectBox.events.register("featureunselected",this,function(e){selectLayer.removeFeatures([e.feature])});var selectPolygon=new OpenLayers.Control.DrawFeature(selectLayer,OpenLayers.Handler.Polygon);controls.push(selectBox,selectPolygon);var myToolTip=new Ext.ToolTip;OpenLayers.Control.Hover=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{delay:500,pixelTolerance:null,stopMove:!1},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Hover(this,{pause:this.onPause,move:this.onMove},this.handlerOptions)},onPause:function(e){var t=featuresFromXY(e.xy);if(t.length>0){var a=t[0].attributes[Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name];"risk"==Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name&&(a*=100),isNaN(a)||(a=cleanUpIfNumber(Number(a)));var o="Value of "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName+": "+a+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit;myToolTip.destroy(),(myToolTip=new Ext.ToolTip({html:o,dismissDelay:2e3})).showAt([e.xy.x+275,e.xy.y])}}}),OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,double:!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(e){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(e){Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy();var t=featuresFromXY(e.xy);if(t.length>0){var a=[];selectLayer.removeAllFeatures();var o=new Array;Ext.each(Ext.getCmp("colorAttribute").store.data.items,function(e){""==e.data.unit?o[e.data.name]=e.data.displayName:o[e.data.name]=e.data.displayName+" ("+e.data.unit+")"}),1==curLanguage&&(o.identifying_info="Identifying information for unit"),2==curLanguage&&(o.identifying_info="Información de identificación de la unidad"),Ext.each(t,function(e){Ext.each(Object.keys(e.attributes),function(t){e.attributes[t]=cleanUpIfNumber(e.attributes[t])});var t="";t=e.fid.replace("getFeatureInfo_sa.","fctt_id: ").replace("getFeatureInfo_ca.","fctt_id: ").replace("getFeatureInfo_mex.","fctt_id: ").replace("getFeatureInfo_userdata.","fctt_id: "),"string"==typeof e.attributes[nameAttribute]&&(t+=": "+e.attributes[nameAttribute]),a.push(new Ext.grid.PropertyGrid({xtype:"propertygrid",id:e.fid,title:t,source:e.attributes,propertyNames:o,autoActivate:!0,autoExpand:!0,listeners:{beforeedit:{fn:function(){return!1}},expand:function(e){selectLayer.removeAllFeatures();for(var t=0;t<highlightedFeaturesCopy.features.length;t++)highlightedFeaturesCopy.features[t].fid==e.id&&selectLayer.addFeatures(highlightedFeaturesCopy.features[t]);selectLayer.redraw()},render:function(e){e.getColumnModel().setColumnWidth(0,400)}}})),e.geometry.transform("EPSG:4326","EPSG:900913"),selectLayer.addFeatures(e),highlightedFeaturesCopy=selectLayer.clone();for(var i=0;i<highlightedFeaturesCopy.features.length;i++)highlightedFeaturesCopy.features[i].fid=selectLayer.features[i].fid}),selectLayer.redraw(),Ext.getCmp("attributePanel")&&Ext.getCmp("attributePanel").destroy(),new GeoExt.Popup({id:"attributePanel",title:"Feature Attributes",layout:"accordion",layoutConfig:{multi:!0},map:app.mapPanel,location:new OpenLayers.Pixel(300,425),panIn:!1,height:400,width:550,collapsible:!0,autoScroll:!0,anchored:!1,collapsed:!0,titleCollapse:!0,items:a,listeners:{close:{fn:function(){selectLayer.removeAllFeatures(),highlightedFeaturesCopy.removeAllFeatures()}}}}).show()}}});var infoClick=new OpenLayers.Control.Click,infoHover=new OpenLayers.Control.Hover,bottombar={xtype:"container",id:"bottomBar",ref:"bottomBar",height:15,padding:0,region:"south",border:!1,style:"padding:2px 0px 0px 0px",items:[{xtype:"label",id:"appCopyright",text:"© 2015 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission.",style:"font: bold 9px arial; color: blue; text-align: center; display:inline-block",width:window.innerWidth}]},topbar={xtype:"toolbar",id:"topBar",ref:"topBar",height:topBarHeight,padding:0,region:"north",border:!1,style:"padding:0px 0px 0px 0px",cls:"topBar",items:[new Ext.Button({text:"How To",id:"howToItem",menu:[{text:"Description",id:"descriptionItem",listeners:{click:function(){1==curLanguage&&openPage("documents/description.pdf","Forest Conservation Targeting Tool Description"),2==curLanguage&&openPage("documents/description.pdf","Herramienta Focalización de Conservación Forestal - Descripción")}}},{text:"Instructions",id:"instructionsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/instructions.pdf","Forest Conservation Targeting Tool Instructions"),2==curLanguage&&openPage("documents/instructions.pdf","Herramienta Focalización de Conservación Forestal - Instrucciones")}}},{text:"FAQ",id:"faqItem",listeners:{click:function(){1==curLanguage&&openPage("documents/faq.html","Forest Conservation Targeting Tool FAQ"),2==curLanguage&&openPage("documents/faq_sp.html","Herramienta Focalización de Conservación Forestal - FAQ")}}},{text:"Video Tutorial",id:"videoTutorialItem",listeners:{click:function(){1==curLanguage&&openPage("documents/tutorial.html","Forest Conservation Targeting Tool Video Tutorial"),2==curLanguage&&openPage("documents/tutorial_sp.html","Herramienta Focalización de Conservación Forestal - Video Tutorial")}}},{text:"User Questions",id:"userQuestionsItem",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalización de Conservación Forestal - Preguntas de Usuarios")}}},{text:"Email",id:"emailItem",listeners:{click:function(){myToolTip.destroy(),(myToolTip=new Ext.ToolTip({html:"fc-targeting-tool@rff.org",dismissDelay:1e4,renderTo:Ext.getCmp("emailItem").el})).showAt(0,0),window.location.href="mailto:fc-targeting-tool@rff.org"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"About",id:"aboutItem",menu:[{text:"Metadata",id:"metadataItem",listeners:{click:function(){1==curLanguage&&openPage("documents/metadata.pdf","Forest Conservation Targeting Tool Metadata"),2==curLanguage&&openPage("documents/metadata.pdf","Herramienta Focalización de Conservación Forestal - Metadatos")}}},{text:"Sponsors",id:"sponsorsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/sponsors.pdf","Forest Conservation Targeting Tool Sponsors"),2==curLanguage&&openPage("documents/sponsors.pdf","Herramienta Focalización de Conservación Forestal - Promotores")}}},{text:"Team",id:"teamItem",listeners:{click:function(){1==curLanguage&&openPage("documents/team.pdf","Forest Conservation Targeting Tool Team"),2==curLanguage&&openPage("documents/team.pdf","Herramienta Focalización de Conservación Forestal - Equipo")}}},{text:"Email",id:"emailItem2",listeners:{click:function(){myToolTip.destroy(),(myToolTip=new Ext.ToolTip({html:"fc-targeting-tool@rff.org",dismissDelay:3e3})).showAt(0,0),window.location.href="mailto:fc-targeting-tool@rff.org"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Feedback",id:"feedbackItem",menu:[{text:"User Questions",id:"userQuestionsItem2",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalización de Conservación Forestal - Preguntas de Usuarios")}}},{id:"userCommentsItem",id:"userCommentsItem",text:"User Comments",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/usercomments","Forest Conservation Targeting Tool User Comments"),2==curLanguage&&openPage("http://conservationroi.net/usercomments","Herramienta Focalización de Conservación Forestal - Comentarios de Usuarios")}}},{text:"Email",id:"emailItem3",listeners:{click:function(){myToolTip.destroy(),(myToolTip=new Ext.ToolTip({html:"fc-targeting-tool@rff.org",dismissDelay:1e4,renderTo:Ext.getCmp("emailItem3").el})).showAt(0,0),window.location.href="mailto:fc-targeting-tool@rff.org"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Use your own data",id:"loginItem",cls:"hidearrow",menu:[{id:"userConsoleItem",text:"User Console",listeners:{click:function(){var e=0;1==curLanguage&&confirm("Navigating to the User Console will restart your session in the FCTT. Do you wish to continue?")&&(e=1),2==curLanguage&&confirm("Navegación a la consola de usuario se reiniciará la sesión en el FCTT. ¿Desea continuar?")&&(e=1),1==e&&(imgWait.style.visibility="hidden",imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden",inUserConsole=1,Ext.getCmp("app").toolPanel.el.setWidth(0),Ext.getCmp("app").doLayout(),app.mapPanel.map.div.innerHTML="<iframe src='../../usersystem/userconsole.php?lang="+curLanguage+"' width = 100% height = 100%></iframe>",myLegend.hide(),Ext.getCmp("userConsoleItem").hide(),Ext.getCmp("returnToFCTTItem").show())}}},{id:"returnToFCTTItem",text:"Reload FCTT",hidden:!0,listeners:{click:function(){window.top.location.href="../../index_user.html"}}},{id:"logoutItem",text:"Logout",listeners:{click:function(){1==curLanguage&&confirm("Logging out will restart your session in the FCTT. Do you wish to continue?")&&(window.location="../../usersystem/logout_fctt.php"),2==curLanguage&&confirm("Hacer clic en 'Logout' se reiniciará su sesión en el FCTT. ¿Desea continuar?")&&(window.location="../../usersystem/logout_fctt.php")}}}],listeners:{mouseover:function(){this.showMenu()},click:function(){1==isIE?(1==curLanguage&&alert("Uploading your own data is only supported in the Chrome and Firefox browsers at this time, not Internet Explorer. Please use one of these other browsers to access this feature."),2==curLanguage&&alert("La carga de sus propios datos sólo se admite en los navegadores Chrome y Firefox en este momento, no Internet Explorer. Por favor, use uno de estos navegadores otras para acceder a esta función.")):1==loginRegisterWindow.hidden?0==phpVarIsLoggedIn&&(loginRegisterWindow.show(),app.mapPanel.disable(),Ext.getCmp("toolPanel").disable(),myLegend.disable()):(loginRegisterWindow.hide(),app.mapPanel.enable(),myLegend.enable(),Ext.getCmp("toolPanel").enable())},menutriggerout:function(){}}}),{xtype:"spacer",width:10},{xtype:"container",layout:{type:"vbox",align:"stretch"},id:"appTitleContainer",style:"padding:5px 0px 0px;",width:window.innerWidth-625,height:topBarHeight,items:[{xtype:"label",id:"appTitle",text:"Forest Conservation Targeting Tool (Beta)",style:"font: bold "+topBarHeight/1.75+"px arial; color: white; text-align: center; display:inline-block"}]},"->",{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/nasa-logo.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/Mesoamerica2.png" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.rff.org" target="_blank"><img src="images/rff_transparent.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:5}]},toolpanel={id:"toolPanel",ref:"toolPanel",padding:"0 0 0 0",region:"west",title:"<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>",bodyStyle:"background-image:url(images/panel2.jpg);background-size: cover",collapsible:!0,width:255,autoScroll:!0,items:toolItems,tbar:new Ext.Toolbar({items:[{xtype:"spacer",width:20},new Ext.Toolbar.TextItem("Language/Idioma:"),{xtype:"combo",id:"language",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:110,queryMode:"local",value:"Español",store:[[1,"English"],[2,"Español"]],listeners:{select:function(e,t,a){curLanguage=a+1,updateLanguage()}}}]}),bbar:[{id:"resetButton",text:"<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>",handler:function(){setDataSource(dataSourceNum=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1),app.mapPanel.map.getZoom()<8&&(4==dataSourceNum||7==dataSourceNum)&&dataLayer.setVisibility(!1),Ext.getCmp("chkLines").setValue(linesOn),Ext.getCmp("chkRisk").setValue(!0),Ext.getCmp("chkCost").setValue(!0),Ext.getCmp("chkMean").setValue(!1),Ext.getCmp("chkArea").setValue(!0),whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",forestThreshold=25,Ext.getCmp("thresholdSlider").setValue(forestThreshold),updateDataLayerParams(),updatePrioritization(),Ext.getCmp("regionSelectCombo").setValue(0),Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("colorAttribute").getSelectionModel().clearSelections(),colorSchemeOn=!1,infoHover.deactivate(),Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),zoomToRegion(),updateOnZoom(app.mapPanel.map.getZoom()),updateStyling(),dataLayer.redraw(),resetLegendPosition(),manualSelectOn=!1}},"->",{id:"resetLegend",text:"Reset Legend Position",handler:function(){resetLegendPosition()}}]},regionPanel={id:"regionPanel",title:"DEFINE STUDY AREA",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 3px;",labelWidth:80,items:[{xtype:"compositefield",fieldLabel:"Dataset",id:"datasetLabel",items:[{xtype:"combo",id:"datasource",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:130,listWidth:200,queryMode:"local",value:"Central America 10km",store:[[5,"Central America Administrative"],[3,"Central America 10km"],[4,"Central America 1km"],[2,"Mexico Predios"],[1,"MREDD AATRs"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}],listeners:{beforeselect:function(e,t,a){if(-1==Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1)return!1},select:function(e,t,a){var o=dataSourceNum,i=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1;o!=i&&(colorSchemeOn=!1,Ext.getCmp("adminSelect").show(),setDataSource(dataSourceNum=i),app.mapPanel.map.getZoom()<8&&4==dataSourceNum&&dataLayer.setVisibility(!1),inClauseStr="idAttribute:1;inSet:1",(3!=o&&4!=o&&5!=o||3!=i&&4!=i&&5!=i)&&(manualSelectOn=!1,whereClauseStr="whereParam:1;whereValue:1",Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("regionSelectCombo").setValue(0),zoomToRegion()),updateDataLayerParams(),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),Ext.getCmp("chkLines").setValue(linesOn),updateOnZoom(app.mapPanel.map.getZoom()),dataLayer.redraw(),updateStyling(),1==dataSourceNum||2==dataSourceNum?Ext.getCmp("chkMarginality").setDisabled(!1):(Ext.getCmp("chkMarginality").setDisabled(!0),Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1)),prioritizationLayer.setVisibility(!1),prioritizationLayer.redraw())}}}]},{xtype:"compositefield",fieldLabel:"Subdataset",id:"subdatasetLabel",hidden:!0,items:[{xtype:"combo",id:"subdatasource",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:130,listWidth:250,queryMode:"local",value:"Ecuador",store:[[1,"Ecuador"],[2,"Bolivia-Santa Cruz"],[3,"Bolivia-El Beni,La Paz"],[4,"Bolivia-Others"],[5,"Colombia-A"],[6,"Colombia-B"],[7,"Colombia-C"],[8,"Brazil-A"],[9,"Brazil-B"],[10,"Brazil-C"],[11,"Brazil-D"],[12,"Brazil-E"],[13,"Brazil-F"],[14,"Brazil-G"],[15,"Brazil-H (São Paulo)"],[16,"Brazil-I"],[17,"Brazil-J"],[18,"Brazil-K"],[19,"Brazil-L"],[20,"Brazil-M(Mato Grosso I)"],[21,"Brazil-N(Mato Grosso II)"],[22,"Brazil-O(Pará I)"],[23,"Brazil-P(Pará II)"],[24,"Brazil-Q(Pará III)"],[25,"Brazil-R(Amazonas I)"],[26,"Brazil-S(Amazonas II)"],[27,"Brazil-T(Amazonas III)"],[28,"Guyana and Uruguay"],[29,"Paraguay"],[30,"Venezuela-Amazonas,Anzoátegui,Bolívar"],[31,"Venezuela-Others"],[32,"Chile-A*"],[33,"Chile-B"],[34,"Chile-C"],[35,"Peru-A"],[36,"Peru-B"],[37,"Peru-C"],[38,"Argentina-A(Buenos Aires)"],[39,"Argentina-B"],[40,"Argentina-C"],[41,"Argentina-D"],[42,"Argentina-E"],[43,"Argentina-F"],[44,"Argentina-G"],[45,"Argentina-H"],[46,"Argentina-I"],[46,"Argentina-J"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}],listeners:{beforeselect:function(e,t,a){if(-1==Ext.getCmp("subdatasource").store.data.items[Ext.getCmp("subdatasource").selectedIndex].data.field1)return!1},select:function(e,t,a){var o=subDataNum,i=Ext.getCmp("subdatasource").store.data.items[Ext.getCmp("subdatasource").selectedIndex].data.field1;o!=i&&(colorSchemeOn=!1,subDataNum=i,inClauseStr="idAttribute:1;inSet:1",whereClauseStr="regionNum:"+subDataNum+";whereParam:1;whereValue:1",updateDataLayerParams(),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),Ext.getCmp("chkLines").setValue(linesOn),updateOnZoom(app.mapPanel.map.getZoom()),dataLayer.redraw(),updateStyling(),dataSourceName="sa_1km_r"+subDataNum,zoomToRegion(),prioritizationLayer.redraw())}}}]},{xtype:"compositefield",fieldLabel:"Minimum Forest Cover",id:"thresholdLabel",hidden:!1,items:[{xtype:"slider",id:"thresholdSlider",aggressive:!0,vertical:!1,useTips:!1,value:25,maxValue:100,minValue:25,width:88,listeners:{change:function(e){Ext.getCmp("thresholdValueLabel").setText(e.getValue()+"%"),forestThreshold=e.getValue()}}},{xtype:"label",id:"thresholdValueLabel",text:"25%",style:{padding:"3px 0px 0px 0px"}},{xtype:"button",id:"updatethreshold",hidden:!1,cls:"boldbutton",text:"",icon:"images/refresh.gif",listeners:{click:function(){updateStyling(),updatePrioritization()}}},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"panel",title:"By administrative boundary",id:"adminSelect",collapsible:!0,collapsed:!0,titleCollapse:!0,labelWidth:80,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"compositefield",fieldLabel:"Region",id:"regionLabel",items:[{xtype:"combo",id:"regionSelectCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:130,value:"All Countries",store:[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],queryMode:"local",listeners:{select:function(e,t,a){var o=Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field1;7!=dataSourceNum&&(o>0?(manualSelectOn=!0,whereClauseStr="whereParam:"+locationParamName+";whereValue:"+o,inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams()):(manualSelectOn=!1,whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",updateDataLayerParams())),prioritizationLayer.setVisibility(!1),zoomToRegion(),updateStyling()}}}]}]},{xtype:"panel",title:"Using manual selection tool",id:"manuallySelect",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"compositefield",fieldLabel:"Selection Mode",id:"selectionMode",items:[{xtype:"combo",id:"selectModeCombo",selectedIndex:0,width:110,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",value:"Polygon",store:[[1,"Polygon"],[2,"Box"]],listeners:{select:function(e,t,a){selectMode=a+1,Ext.getCmp("selectsubmitselection").enable(),2==selectMode&&(userLayerActive?(1==curLanguage&&Ext.Msg.alert("","Unfortunately, the Box/Manual Select Tool can not be used with user-defined layers at this time. Note that you can create an arbitrary region of interest for user-defined layers by restricting your shapefile to the fctt_id you are interested in before uploading the data in the User Console"),2==curLanguage&&Ext.Msg.alert("","Desafortunadamente, la Herramienta Caja/Selección Manual no se puede utilizar con capas definidas por el usuario en este momento. Tenga en cuenta que puede crear una región arbitraria de interés para las capas definidas por el usuario mediante la restricción de su archivo de formas a la fctt_id le interesa antes de cargar los datos en la consola de usuario."),Ext.getCmp("selectsubmitselection").disable()):(1==curLanguage&&Ext.Msg.alert("Note","Use of the Box/Manual Select Tool is not possible for selecting more than 10,000 shapes. In this case, please use the Within Polygon or Upload Shapefile tool."),2==curLanguage&&Ext.Msg.alert("Nota","De usuario de la herramienta de selección Caja/Clic Manual no se posible para la selección de más de 10,000 formas. En este caso, por favor, utilice la herramienta de Dentro Polígono o Subir Shapefile.")))}}}]}],listeners:{expand:function(){void 0!==instructionsWindow&&(1==curLanguage&&(instructionsWindow.show(),instructionsWindowSp.hide()),2==curLanguage&&(instructionsWindow.hide(),instructionsWindowSp.show()))}},bbar:[{xtype:"button",id:"selectsubmitselection",text:"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){if(navigationMode)navigationMode=!1,1==selectMode&&selectPolygon.activate(),2==selectMode&&selectBox.activate(),infoHover.deactivate(),infoClick.deactivate(),selectLayer.removeAllFeatures(),selectLayer.redraw(),Ext.getCmp("attributePanel")&&(Ext.getCmp("attributePanel").removeAll(),Ext.getCmp("attributePanel").close()),Ext.getCmp("cancelclearselection").show(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>");else{if(1==selectMode){if(0==selectLayer.features.length&&(Ext.Msg.alert("Whoops!","No feature drawn. Please use the mouse to draw a study area polygon. Double-click to complete."),2==curLanguage&&Ext.Msg.alert("¡Ay!","Sin Características dibujadas. Utilice el ratón para dibujar una área de estudio polígono. Haga doble clic para completar.")),1==selectLayer.features.length){var e=selectLayer.features[0];if(e.geometry.components[0].components.length<4)1==curLanguage&&Ext.Msg.alert("Whoops!","Polygon must have at least three vertices."),2==curLanguage&&Ext.Msg.alert("¡Ay!","Polígono debe tener al menos tres vértices."),manualSelectOn=!1;else if(manualSelectOn=!0,shapeArea=Math.floor(e.geometry.getArea()/1e6),e.geometry.transform("EPSG:900913","EPSG:4326"),4==dataSourceNum&e.geometry.getArea()>10.5)1==curLanguage&&Ext.Msg.alert("Warning","The largest area of 1km Central America data that the FCTT can work with is about 150,000 square kilometers. Your shape is roughly "+shapeArea+" square kilometers, so please select a smaller one"),2==curLanguage&&Ext.Msg.alert("Aviso","El área más grande de datos de 1km de Centroamérica con la que puede trabajar el FCTT es de aproximadamente 150,000 kilómetros cuadrados. Tu forma es más o menos "+shapeArea+" kilómetros cuadrados, así que por favor seleccione uno más pequeño"),colorSchemeOn=!1,manualSelectOn=!1,app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden";else if(6==dataSourceNum&e.geometry.getArea()>600)1==curLanguage&&Ext.Msg.alert("Warning","The largest area of 10km South America data that the FCTT can work with is about 7,500,000 square kilometers. Your shape is roughly "+shapeArea+" square kilometers, so please select a smaller one"),2==curLanguage&&Ext.Msg.alert("Aviso","El área más grande de datos de 10km de Sudamérica con la que puede trabajar el FCTT es de aproximadamente 7,500,000 kilómetros cuadrados. Tu forma es más o menos "+shapeArea+" kilómetros cuadrados, así que por favor seleccione uno más pequeño"),colorSchemeOn=!1,manualSelectOn=!1,app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden";else if(7==dataSourceNum&e.geometry.getArea()>10.5)1==curLanguage&&Ext.Msg.alert("Warning","The largest area of 1km South America data that the FCTT can work with is about 150,000 square kilometers. Your shape is roughly "+shapeArea+" square kilometers, so please select a smaller one"),2==curLanguage&&Ext.Msg.alert("Aviso","El área más grande de datos de 1km de Sudamérica con la que puede trabajar el FCTT es de aproximadamente 150,000 kilómetros cuadrados. Tu forma es más o menos "+shapeArea+" kilómetros cuadrados, así que por favor seleccione uno más pequeño"),colorSchemeOn=!1,manualSelectOn=!1,app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden";else{whereClauseStr=e.geometry.toString(),whereClauseStr=whereClauseStr.replace("POLYGON","LINESTRING"),whereClauseStr=whereClauseStr.replace("((","("),whereClauseStr=whereClauseStr.replace("))",")"),whereClauseStr="whereValue:TRUE;whereParam:ST_Intersects(geom, (SELECT ST_MakePolygon(ST_GeomFromText('"+whereClauseStr+"',4326))))",whereClauseStr=whereClauseStr.replace(/,/g,"\\,");var t=(inClauseStr="idAttribute:1;inSet:1")+";"+whereClauseStr+";forestThreshold:"+forestThreshold+"layerPIN:"+phpVarlayerPIN+";regionNum:"+subDataNum;dataLayer.mergeNewParams({viewparams:t})}}selectLayer.features.length>1&&(1==curLanguage&&Ext.Msg.alert("Whoops!","Multiple features drawn. Limit is one."),2==curLanguage&&Ext.Msg.alert("¡Ay!","Múltiples características dibujadas. Limit es una."),manualSelectOn=!1)}if(2==selectMode){manualSelectOn=!0;var a=[];Ext.iterate(selectBox.features,function(e,t){a.push(t.fid.replace(dataSourceLayerName.replace(workspaceName+":","")+".",""))}),whereClauseStr="whereValue:1;whereParam:1",inClauseStr=(inClauseStr="idAttribute:"+idAttribute+";inSet:"+a).replace(/,/g,"\\,"),0==a.length&&(Ext.Msg.alert("Whoops!","No features selected! Click on features or draw a box to select."),inClauseStr="idAttribute:1;inSet:1",manualSelectOn=!1),0==a.length&2==curLanguage&&(Ext.Msg.alert("¡Ay!","No hay características seleccionadas! Haga clic en las características o dibujar un cuadro para seleccionar."),inClauseStr="idAttribute:1;inSet:1",manualSelectOn=!1),a.length>0&&updateDataLayerParams()}Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),navigationMode=!0,selectPolygon.deactivate(),selectBox.deactivate(),colorSchemeOn&&infoHover.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),prioritizationLayer.setVisibility(!1),updateStyling(),dataLayer.redraw()}updateSelectionButtonLanguage()}},"->",{xtype:"button",id:"cancelclearselection",text:"<div style='color:black;font-size: 12'>Clear/Cancel</div>",icon:"images/clear.gif",hidden:!0,handler:function(){manualSelectOn=!1,colorSchemeOn=!1,prioritizationOn=!1,Ext.getCmp("colorAttribute").getSelectionModel().clearSelections();var e=Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field1;0==e&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:1;whereValue:1;",updateDataLayerParams()),e>0&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:"+locationParamName+";whereValue:"+e,updateDataLayerParams()),Ext.iterate(selectBox.features,function(e,t){delete selectBox.features[e]}),selectBox.deactivate(),selectPolygon.deactivate(),inClauseStr="idAttribute:1;inSet:1",updateStyling(),updatePrioritization(),navigationMode?(Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()):(navigationMode=!0,colorSchemeOn&&infoHover.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()),updateSelectionButtonLanguage()}}]}]},optionsPanel={id:"optionsPanel",title:"DISPLAY OPTIONS",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 2;",items:[{xtype:"panel",id:"defaultColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>',listeners:{expand:function(e,t){document.getElementById("defaultColorPanel").doLayout}},items:[{xtype:"colorpalette",id:"defaultColorPicker",color:"blue",handler:function(e,t){defaultColor=t,Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("defaultColorPanel").setTitle('<center><div style="color: '+defaultColor+'; font-weight: bold">Color de Relleno Defecto</div>'),Ext.getCmp("defaultColorPanel").collapse(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape lines",id:"shpLinesLabel",items:[{xtype:"checkbox",id:"chkLines",checked:!0,handler:function(){linesOn=Ext.getCmp("chkLines").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape fill",id:"shpFillLabel",items:[{xtype:"checkbox",id:"chkFill",checked:!0,handler:function(){selectLayer.setVisibility(Ext.getCmp("chkFill").checked),fillOn=Ext.getCmp("chkFill").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Opacity",id:"opacityLabel",items:[{xtype:"gx_opacityslider",id:"opacitySlider",layer:dataLayer,changeVisibility:!0,aggressive:!0,vertical:!1,width:120,value:65,x:15,y:150,plugins:new GeoExt.LayerOpacitySliderTip},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"compositefield",fieldLabel:"Marginality Layer",id:"margLayerLabel",items:[{xtype:"checkbox",id:"chkMarginality",checked:!1,disabled:!0,handler:function(){marginalityLayer.setVisibility(Ext.getCmp("chkMarginality").checked),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Base map type",id:"basemapLabel",items:[{xtype:"combo",id:"basemapCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:120,listWidth:200,queryMode:"local",value:"Google Physical",store:[[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satelitte"],[4,"Microsoft Bing Street Map"],[5,"Forest Change(2000-2012)"]],listeners:{select:function(e,t,a){gphy.setVisibility(1==a),ghyb.setVisibility(2==a),gsat.setVisibility(3==a),gosm.setVisibility(4==a),ghan.setVisibility(5==a),gosmActive=4==a,ghanActive=5==a,updateOnZoom(app.mapPanel.map.getZoom()),updateStyling()}}}]},{xtype:"compositefield",fieldLabel:"Show Scale",id:"showScaleLabel",items:[{xtype:"checkbox",id:"chkScale",checked:!0,handler:function(){Ext.getCmp("chkScale").checked||app.mapPanel.map.removeControl(scaleControl),Ext.getCmp("chkScale").checked&&app.mapPanel.map.addControl(scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}))}}]},{xtype:"compositefield",fieldLabel:"Pan/Zoom Tool",id:"panZoomLabel",items:[{xtype:"checkbox",id:"chkPanZoom",checked:!0,handler:function(){Ext.getCmp("chkPanZoom").checked||app.mapPanel.map.removeControl(panzoomControl),Ext.getCmp("chkPanZoom").checked&&app.mapPanel.map.addControl(panzoomControl=new OpenLayers.Control.PanZoom)}}]},{xtype:"compositefield",fieldLabel:"Mouse wheel zoom",id:"mouseWheelLabel",items:[{xtype:"checkbox",id:"chkMouseZoom",checked:!0,handler:function(){Ext.getCmp("chkMouseZoom").checked||navControl.disableZoomWheel(),Ext.getCmp("chkMouseZoom").checked&&navControl.enableZoomWheel()}}]}]},colorByAttributePanel=new Ext.Panel({id:"colorByAttributePanel",title:"TARGETING DATA",collapsible:!0,titleCollapse:!0,layout:"form",labelWidth:95,bodyStyle:"padding: 3;",items:[{xtype:"panel",id:"lowColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 0px 0px",title:'<center><div style="color: '+lowColor+'; font-weight: bold">Low Color</div>',listeners:{expand:function(e,t){document.getElementById("lowColorPanel").doLayout}},items:[{xtype:"colorpalette",id:"lowColorPicker",color:"blue",handler:function(e,t){lowColor=t,Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Low Color</div>'),2==curLanguage&&Ext.getCmp("lowColorPanel").setTitle('<center><div style="color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("lowColorPanel").collapse(),Ext.getCmp("highColorPanel").expand(),updateStyling()}}]},{xtype:"panel",id:"highColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 10px 0px",title:'<center><div style="color: '+highColor+'; font-weight: bold">High Color</div>',listeners:{expand:function(e,t){document.getElementById("highColorPanel").doLayout}},items:[{xtype:"colorpalette",id:"highColorPicker",color:"red",handler:function(e,t){highColor=t,Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">High Color</div>'),2==curLanguage&&Ext.getCmp("highColorPanel").setTitle('<center><div style="color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("highColorPanel").collapse(),Ext.getCmp("highColorPanel").expand(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Method",id:"methodLabel",items:[{xtype:"combo",id:"methodCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:115,queryMode:"local",value:"Interpolate",store:[[0,"Interpolate"],[1,"Quantiles"]],listeners:{select:function(e,t,a){updateStyling(),Ext.getCmp("numQuantiles").setDisabled(0==a)}}}]},{xtype:"compositefield",fieldLabel:"# Quantiles",id:"quantilesLabel",disabled:!0,items:[{xtype:"numberfield",id:"numQuantiles",width:40,value:"3",listeners:{change:function(){updateStyling()}}}]},new Ext.grid.GridPanel({id:"colorAttribute",title:"Variables",store:prioritizationVariables,cm:new Ext.grid.ColumnModel([{id:"displayName",dataIndex:"displayName",sortable:!0}]),sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),autoExpandColumn:"displayName",height:200}),{xtype:"compositefield",fieldLabel:"Show null values",id:"chkNullLabel",items:[{xtype:"checkbox",id:"chkNull",boxLabel:"(in default color)",checked:!1,handler:function(){updateStyling()}}]}],bbar:[{id:"updatedatavis",hidden:!1,text:"<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>",cls:"boldbutton",icon:"images/refresh.gif",handler:function(){colorSchemeOn=!0,infoHover.activate(),updateStyling()}},"->",{id:"cleardatavis",text:"<div style='color:black;font-size: 12'>Clear</div>",icon:"images/clear.gif",handler:function(){colorSchemeOn=!1,infoHover.deactivate(),updateStyling()}}]});Ext.grid.RowSelectionModel.override({getSelectedIndex:function(){return this.grid.store.indexOf(this.selections.itemAt(0))}});var selectPanel=new Ext.Panel({xtype:"panel",id:"selectPanel",title:"TARGET",layout:"form",layoutConfig:{multi:!0},collapsible:!0,collapsed:!1,titleCollapse:!0,bodyStyle:"padding: 3;",items:[{xtype:"fieldset",id:"chooseBenefits",title:"Choose Benefit Variables",collapsible:!1,hidden:!1,labelWidth:75,items:[{xtype:"compositefield",fieldLabel:"Carbon:",id:"carbonBenefitLabel",items:[{xtype:"combo",id:"carbonBenefitChoose",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:115,listWidth:150,queryMode:"local",value:"Non-soil carbon",store:[["carbon","Non-soil carbon"],["carbon_total","Total carbon"],["carbon_soil","Carbon in soil"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}]}]},{xtype:"compositefield",fieldLabel:"Biodiversity:",id:"bioBenefitLabel",items:[{xtype:"combo",id:"bioBenefitChoose",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:115,listWidth:150,queryMode:"local",value:"Global RWRI",store:[["bio","Global RWRI"],["bio_loc","National RWRI"],["bio_count","Threat. species count"]],columns:[{header:"field1",dataIndex:"field1"},{header:"field2",dataIndex:"field2"}]}]}]},{xtype:"fieldset",id:"priorityBudget",title:"Choose Budget",collapsible:!1,items:[{layout:"hbox",unstyled:!0,items:[{xtype:"radio",id:"percentageRadio",checked:!0,boxLabel:"Percentage of total:",listeners:{check:function(e,t){t&&(Ext.getCmp("rawRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!1),Ext.getCmp("budget_raw").setDisabled(!0))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"budget_percentage",width:30,value:"10"},{xtype:"spacer",width:3},{xtype:"label",text:"(%)"}]},{layout:"hbox",unstyled:!0,style:"padding:10px 0px 0px 0px",items:[{xtype:"radio",id:"rawRadio",boxLabel:"Raw budget:",listeners:{check:function(e,t){t&&(Ext.getCmp("percentageRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!0),Ext.getCmp("budget_raw").setDisabled(!1))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"budget_raw",width:67,value:"10000000",disabled:!0},{xtype:"spacer",width:3},{xtype:"label",id:"currencyLabel",text:"($)"}]}]},{xtype:"tabpanel",id:"benefitTabPanel",activeTab:0,plain:!0,items:[{id:"combineTab",title:"Weight Benefits",padding:5,autoHeight:!0,items:[{layout:"auto",unstyled:!0,items:[{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"carbonweightfield",fieldLabel:'<div style="color: green; font-weight: bold">Carbon:</div>',labelSeparator:"",items:[{xtype:"numberfield",decimalPrecision:2,id:"weight1",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(0,100*Ext.getCmp("weight1").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"bioweightfield",fieldLabel:'<div style="color: red; font-weight: bold">Biodiversity:</div>',labelSeparator:"",items:[{xtype:"numberfield",decimalPrecision:2,id:"weight2",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,Ext.getCmp("weightMultiSlider").getValues()[0]+100*Ext.getCmp("weight2").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"hydroweightfield",fieldLabel:'<div style="color: blue; font-weight: bold">Hydrological:</div>',labelSeparator:"",items:[{xtype:"numberfield",decimalPrecision:2,id:"weight3",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,100*(1-Ext.getCmp("weight3").value))}}}]}]}]},new Ext.slider.MultiSlider({id:"weightMultiSlider",values:[33,66],increment:1,minValue:0,maxValue:100,constrainThumbs:!0,width:215,plugins:[new Ext.ux.slider.Highlight],listeners:{change:function(e,t,a){0==a.index&&(Ext.getCmp("weight1").setValue(e.getValues()[0]/100),Ext.getCmp("weight2").setValue((e.getValues()[1]-e.getValues()[0])/100)),1==a.index&&(Ext.getCmp("weight2").setValue((e.getValues()[1]-e.getValues()[0])/100),Ext.getCmp("weight3").setValue((100-e.getValues()[1])/100))}}}),{xtype:"panel",id:"selectedFillColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>',items:[{xtype:"colorpalette",id:"selectedFillColorPicker",color:"blue",handler:function(e,t){selectedFillColor=t,Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("selectedFillColorPanel").collapse(),prioritizationLayer.visibility&&updatePrioritization()}}]}]},{id:"compareTab",title:"Compare",height:100,layout:{type:"hbox",pack:"center",align:"middle"},padding:2,items:[{xtype:"combo",id:"compareObjectiveCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",width:150,value:"All Benefits",store:[[0,"All Benefits"],[1,"Carbon and Biodiversity"],[2,"Carbon and Hydro"],[3,"Biodiversity and Hydro"]],listeners:{select:function(e,t,a){prioritizationLayer.visibility&&updatePrioritization()}}}]}]},{xtype:"fieldset",id:"priorityOptions",title:"Options",layout:"form",labelWidth:170,collapsible:!1,items:[{xtype:"compositefield",fieldLabel:"Scale benefits by deforestation risk",id:"chkRiskLabel",items:[{xtype:"checkbox",id:"chkRisk",checked:!0}]},{xtype:"compositefield",fieldLabel:"Divide expected benefits by cost",id:"chkCostLabel",items:[{xtype:"checkbox",id:"chkCost",checked:!0}]},{xtype:"compositefield",fieldLabel:"Scale total costs by forest area",id:"chkAreaLabel",items:[{xtype:"checkbox",id:"chkArea",checked:!0}]},{xtype:"compositefield",fieldLabel:"Normalize benefits by mean instead of median",id:"chkMeanLabel",items:[{xtype:"checkbox",id:"chkMean",listeners:{change:function(e,t,a){1==curLanguage&&t&&Ext.Msg.alert("Warning","Normalizing by the mean rather than the median may make prioritization results particularly sensitive to outliers. (If you just clicked Submit, you may need to click again)."),2==curLanguage&&t&&Ext.Msg.alert("Aviso","La normalización de la media en lugar de la mediana puede hacer que los resultados de priorización particularmente sensible a los valores atípicos. (Si usted acaba de hacer clic en Entregar, es posible que tenga que hacer clic de nuevo).")}}}]},{xtype:"compositefield",fieldLabel:"Opacity:",id:"priorityOpacityLabel",items:[{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"gx_opacityslider",id:"priorityOpacitySlider",layer:prioritizationLayer,aggressive:!0,vertical:!1,width:200,value:90,x:15,y:150,plugins:new GeoExt.LayerOpacitySliderTip}]}],bbar:[{id:"submitprioritization",text:"<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){prioritizationLayer.setVisibility(!0),updatePrioritization()}},"->",{id:"clearprioritization",text:"<div style='color:black;font-size: 12'>Clear</div>",cls:"boldbutton",icon:"images/clear.gif",handler:function(){prioritizationLayer.setVisibility(!1),updateStyling()}}]}),exportPanel={id:"exportPanel",title:"EXPORT",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",hidden:!1,bodyStyle:"padding: 2;",items:[{xtype:"button",text:"<div style='color:black;font-size: 12'>Export Shapefile</div>",id:"shapefileButton",scale:"medium",icon:"images/download_shp.png",handler:function(){if(userLayerActive&&"mex_pred"==userDataSourceUOA||1==dataSourceNum||2==dataSourceNum)1==curLanguage&&alert("Unfortunately, shapefile download is not possible for datasets that use the Mexico predios. However, you can download your data and prioritization results in CSV format, including predio names."),2==curLanguage&&alert("Desafortunadamente, descarga shapefile no es posible para los conjuntos de datos que utilizan los predios México. Sin embargo, puede descargar los datos y resultados de priorización en formato CSV, incluyendo los nombres de predios.");else{var e="";if(updatePrioritization(),prioritizationLayer.visibility){e=userLayerActive?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_userdata&outputFormat=SHAPE-ZIP&format_options=filename:fctt_output.zip":"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize&outputFormat=SHAPE-ZIP&format_options=filename:fctt_output.zip",imgWait.style.visibility="visible";var t=document.createElement("form");t.method="POST",t.action=e;var a=document.createElement("input");a.type="hidden",a.name="viewParams",a.value=priorityParams,t.appendChild(a),document.body.appendChild(t),t.submit(),imgWait.style.visibility="hidden"}else 1==curLanguage&&Ext.Msg.alert("","You must run the prioritization tool before downloading the results."),2==curLanguage&&Ext.Msg.alert("",'Necesita ejecutar la herramienta "Focalizar" antes de descargar los resultados.')}}},{xtype:"button",text:"<div style='color:black;font-size: 12'>Export CSV</div>",id:"csvButton",scale:"medium",icon:"images/download_csv.png",handler:function(){var e="";if(updatePrioritization(),prioritizationLayer.visibility){e=userLayerActive?"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize_userdata&outputFormat=csv":"../../geoserver/"+workspaceName+"/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+workspaceName+":data_prioritize&outputFormat=csv";";geomZero:0",imgWait.style.visibility="visible";var t=document.createElement("form");t.method="POST",t.action=e;var a=document.createElement("input");a.type="hidden",a.name="viewParams",a.value=priorityParams+";geomZero:0",t.appendChild(a),document.body.appendChild(t),t.submit(),imgWait.style.visibility="hidden"}else 1==curLanguage&&Ext.Msg.alert("","You must run the prioritization tool before downloading the results."),2==curLanguage&&Ext.Msg.alert("",'Necesita ejecutar la herramienta "focalizar" antes de descargar los resultados.')}},{xtype:"button",id:"printButton",text:"<div style='color:black;font-size: 12'>Print/PDF</div>",scale:"medium",icon:"images/print.png",hidden:!1,handler:function(){if(1==isIE)1==curLanguage&&alert("Printing functionality is only supported in the Chrome and Firefox browsers at this time, not Internet Explorer. Please use one of these other browsers to access this feature."),2==curLanguage&&alert("La funcionalidad de impresión sólo se admite en los navegadores Chrome y Firefox en este momento, no Internet Explorer. Por favor, use uno de estos navegadores otras para acceder a esta función.");else if(1==gosm.getVisibility()&1==curLanguage&&alert("Note: at this time, the Microsoft Bing basemap is not supported for printing to PDF."),1==gosm.getVisibility()&2==curLanguage&&alert("Nota: en este momento, el mapa base Microsoft Bing no se admite para imprimir en PDF"),Ext.getCmp("printDialog")&&Ext.getCmp("printDialog").destroy(),1==curLanguage&&(e=new Ext.Window({autoHeight:!0,width:350,resizeable:!1,id:"printDialog",title:"Configure Print",items:[new GeoExt.PrintMapPanel({sourceMap:app.mapPanel,legend:legendPanel,printProvider:printProvider})],bbar:[{id:"createPDFIcon",text:"Create PDF",handler:function(){1==ghan.getVisibility()&e.items.get(0).currentZoom>8&&alert("Warning: the Forest Change basemap will not print at the current zoom level. To include the Forest Change basemap, please zoom out."),1==ghan.getVisibility()&&(printProvider.customParams.attributionText="Basemap: Hansen et al. 2014"),1==gosm.getVisibility()&&1==curLanguage&&(printProvider.customParams.attributionText="Basemap: © Microsoft Bing. Microsoft product screen shot(s) reprinted with permission from Microsoft Corporation"),1==gosm.getVisibility()&&2==curLanguage&&(printProvider.customParams.attributionText="Basemap: © Microsoft Bing. Microsoft product screen shot(s) reprinted with permission from Microsoft Corporation"),e.items.get(0).print({legend:legendPanel})}}]})).show(),2==curLanguage){var e=new Ext.Window({autoHeight:!0,width:450,resizeable:!1,id:"printDialog",title:"Configure Imprimir",items:[new GeoExt.PrintMapPanel({sourceMap:app.mapPanel,legend:legendPanel,printProvider:printProvider})],bbar:[{id:"createPDFIcon",text:"Crear PDF",handler:function(){1==ghan.getVisibility()&e.items.get(0).currentZoom>8&&alert("Advertencia: Cambiar el mapa base del bosque no se imprimirá en el nivel de zoom actual. Para incluir el basemap de Cambia Forestal, por favor disminuir el zoom."),1==ghan.getVisibility()&&(printProvider.customParams.attributionText="Basemap: Hansen et al. 2014"),1==gosm.getVisibility()&&1==curLanguage&&(printProvider.customParams.attributionText="Basemap: © Microsoft Bing. Microsoft product screen shot(s) reprinted with permission from Microsoft Corporation"),1==gosm.getVisibility()&&2==curLanguage&&(printProvider.customParams.attributionText="Basemap: © Microsoft Bing. Microsoft product screen shot(s) reprinted with permission from Microsoft Corporation"),e.items.get(0).print({legend:legendPanel})}}]});e.show()}}}]};toolItems.push(optionsPanel,regionPanel,colorByAttributePanel,selectPanel,exportPanel);