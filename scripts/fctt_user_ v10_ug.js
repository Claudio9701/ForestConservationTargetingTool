function registerEvents(a){a.events.register("loadstart",a,function(){app.mapPanel.body.dom.style.cursor="wait",imgWait.style.visibility="visible"}),a.events.register("tileloaded",a,function(){}),a.events.register("loadend",a,function(){app.mapPanel.body.dom.style.cursor="pointer",imgWait.style.visibility="hidden"})}function updateStyling(){0==Ext.getCmp("colorAttribute").getSelectionModel().selections.items.length&&Ext.getCmp("colorAttribute").getSelectionModel().selectRow(0);var a=Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name,b=1;"risk"==a&&(b=100);var c=[],d={method:"GET",async:!1},e='<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>'+dataSourceName+"_query</sld:Name><sld:UserStyle><sld:FeatureTypeStyle>";if(1==Ext.getCmp("methodCombo").selectedIndex&colorSchemeOn&fillOn){Ext.getCmp("numQuantiles").setValue(parseInt(Ext.getCmp("numQuantiles").getValue())),Ext.getCmp("numQuantiles").getValue()>0||Ext.getCmp("numQuantiles").setValue("10");for(var g=parseInt(Ext.getCmp("numQuantiles").getValue()),h=[],i=1;g>i;i++){d.url="../../geoserver/forestro_ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=forestro_ws:getQuantile&viewparams=theAttribute:"+a+";dataSource:"+dataSourceTableName,d.url+=";percentage:"+i/g,d.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold;var j=OpenLayers.Request.issue(d);h.push(Number(j.responseXML.documentElement.lastChild.firstChild.firstChild.textContent))}e+="<sld:Rule><Title>Below "+h[0].toPrecision(4)+"</Title><ogc:Filter><ogc:PropertyIsLessThan><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+h[0]+'</ogc:Literal></ogc:PropertyIsLessThan></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+lowColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&c.push(new OpenLayers.Rule({title:"Below "+(h[0]*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),2==curLanguage&&c.push(new OpenLayers.Rule({title:"Menos de "+(h[0]*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),linesOn&&(e+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>";for(var i=1;g-1>i;i++)e+="<sld:Rule><Title>["+h[i-1].toPrecision(4)+", "+h[i].toPrecision(4)+"]</Title><ogc:Filter><ogc:And>",c.push(new OpenLayers.Rule({title:"["+(h[i-1]*b).toPrecision(4)+", "+(h[i]*b).toPrecision(4)+"]"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e8,symbolizer:{fillColor:mixLowAndHighColors(i/(g-1))}})),e+="<ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+h[i-1]+"</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo>",e+="<ogc:PropertyIsLessThan><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+h[i]+"</ogc:Literal></ogc:PropertyIsLessThan>",e+='</ogc:And></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">'+mixLowAndHighColors(i/(g-1))+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(e+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>";e+="<sld:Rule><Title>At least "+h[g-2].toPrecision(4)+"</Title><ogc:Filter><ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>"+a+"</ogc:PropertyName><ogc:Literal>"+h[g-2]+'</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#'+highColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',1==curLanguage&&c.push(new OpenLayers.Rule({title:"Above "+(h[g-2]*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),2==curLanguage&&c.push(new OpenLayers.Rule({title:"M\xe1s de "+(h[g-2]*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),linesOn&&(e+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>"}if(Ext.getCmp("methodCombo").selectedIndex<1&colorSchemeOn&fillOn){d.url="../../geoserver/forestro_ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=forestro_ws:getMaxAvgMinWhere&viewparams=theAttribute:"+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+";dataSource:"+dataSourceTableName,d.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold;var j=OpenLayers.Request.issue(d),k=Number(j.responseXML.documentElement.lastChild.firstChild.firstChild.textContent),l=Number(j.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.textContent),m=Number(j.responseXML.documentElement.lastChild.firstChild.lastChild.textContent);e+='<sld:Rule><PolygonSymbolizer><Fill><CssParameter name="fill-opacity">1</CssParameter><CssParameter name="fill"><ogc:Function name="Interpolate"><ogc:PropertyName>'+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name+"</ogc:PropertyName>",e+="<ogc:Literal>"+k+"</ogc:Literal><ogc:Literal>#"+lowColor+"</ogc:Literal>",1==curLanguage&&c.push(new OpenLayers.Rule({title:"Low Value: "+(k*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),2==curLanguage&&c.push(new OpenLayers.Rule({title:"Valor Bajo: "+(k*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+lowColor}})),e+="<ogc:Literal>"+l+"</ogc:Literal><ogc:Literal>"+mixLowAndHighColors(.5)+"</ogc:Literal>",1==curLanguage&&c.push(new OpenLayers.Rule({title:" Middle Value: "+(l*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:mixLowAndHighColors(.5)}})),2==curLanguage&&c.push(new OpenLayers.Rule({title:" Valor Medio: "+(l*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:mixLowAndHighColors(.5)}})),e+="<ogc:Literal>"+m+"</ogc:Literal><ogc:Literal>#"+highColor+"</ogc:Literal>",e+="<ogc:Literal>color</ogc:Literal><ogc:Literal>cubic</ogc:Literal></ogc:Function>",1==curLanguage&&c.push(new OpenLayers.Rule({title:"High Value: "+(m*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),2==curLanguage&&c.push(new OpenLayers.Rule({title:"Valor Alto: "+(m*b).toPrecision(4)+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit,maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+highColor}})),e+='</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>',linesOn&&(e+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>"}!colorSchemeOn|!fillOn&&(e+="<sld:Rule><sld:Title>Conservation ROI Layer</sld:Title><PolygonSymbolizer>",fillOn&&(e+='<Fill><CssParameter name="fill">#'+defaultColor+'</CssParameter><CssParameter name="fill-opacity">1</CssParameter></Fill>'),linesOn&&(e+="<sld:Stroke/>"),e+="</PolygonSymbolizer></sld:Rule>",fillOn&&c.push(new OpenLayers.Rule({title:Ext.getCmp("datasource").getRawValue(),maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+defaultColor}})),fillOn||c.push(new OpenLayers.Rule({title:Ext.getCmp("datasource").getRawValue(),maxScaleDenominator:3e9,symbolizer:{fillColor:"#ffffff"}}))),e+="</sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>",dataLayer.mergeNewParams({viewparams:inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold}),dataLayer.mergeNewParams({sld_body:e}),app.mapPanel.map.getLayersByName("Marginality Legend").length>0&&app.mapPanel.map.removeLayer(marginalityLegendLayer),1==marginalityLayer.getVisibility()&&(o=[],1==curLanguage&&(marginalityLegendLayer.name="Mexico Marginality Index",o.push(new OpenLayers.Rule({title:"Lowest marginality",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Highest marginality",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),2==curLanguage&&(marginalityLegendLayer.name="\xcdndice de Marginalidad en Mexico",o.push(new OpenLayers.Rule({title:"M\xe1s baja marginalidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"M\xe1s alta marginalidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),marginalityLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:o})}),app.mapPanel.map.addLayer(marginalityLegendLayer),marginalityLegendLayer.name="Marginality Legend"),app.mapPanel.map.getLayersByName("Hansen Legend").length>0&&app.mapPanel.map.removeLayer(hansenLegendLayer),1==ghan.getVisibility()&&(o=[],1==curLanguage&&(hansenLegendLayer.name="Basemap: Forest Change 2000-2012",o.push(new OpenLayers.Rule({title:"Not Forested",maxScaleDenominator:3e9,symbolizer:{fillColor:"#000000"}})),o.push(new OpenLayers.Rule({title:"Forested in 2000",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"Loss between 2000 and 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"Gain between 2000 and 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Both Loss and Gain",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}}))),2==curLanguage&&(hansenLegendLayer.name="Basemap: Cambio Forestal 2000-2012",o.push(new OpenLayers.Rule({title:"No forestada",maxScaleDenominator:3e9,symbolizer:{fillColor:"#000000"}})),o.push(new OpenLayers.Rule({title:"Boscosa en 2000",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"P\xe9rdida entre 2000 y 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"Aumenta entre 2000 y 2012",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Ambos p\xe9rdida y aumenta ",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}}))),hansenLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:o})}),app.mapPanel.map.addLayer(hansenLegendLayer),hansenLegendLayer.name="Hansen Legend"),colorSchemeLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:c})}),app.mapPanel.map.getLayersByName("Color By Attribute Scheme").length>0&&app.mapPanel.map.removeLayer(colorSchemeLegendLayer),colorSchemeOn&&1==curLanguage&&(colorSchemeLegendLayer.name="Data Layer Colored By: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName),colorSchemeOn&&2==curLanguage&&(colorSchemeLegendLayer.name="Capa de Datos Matizada por: "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName);var n="Data Layer";if(2==curLanguage&&(n="Capa de Datos"),!colorSchemeOn|!fillOn&&(colorSchemeLegendLayer.name=n),app.mapPanel.map.addLayer(colorSchemeLegendLayer),colorSchemeLegendLayer.name="Color By Attribute Scheme",app.mapPanel.map.getLayersByName("Prioritization Legend").length>0&&app.mapPanel.map.removeLayer(prioritizationLegendLayer),1==prioritizationLayer.getVisibility()){var o=[];1==curLanguage&&(prioritizationLegendLayer.name="Targeting:","compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id?(0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"Carbon Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"Biodiversity Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"Hydrological Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Carbon and Biodiversity",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})),o.push(new OpenLayers.Rule({title:"Carbon and Hydrological",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FFFF"}})),o.push(new OpenLayers.Rule({title:"Biodiversity and Hydrological",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}})),o.push(new OpenLayers.Rule({title:"All Three Benefits",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"Carbon Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"Biodiversity Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"Carbon and Biodiversity",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"Carbon Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"Hydrological Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Carbon and Hydrological",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"Biodiversity Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"Hydrological Only",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Biodiversity and Hydrological",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})))):o.push(new OpenLayers.Rule({title:"Selected ("+Ext.getCmp("weight1").value+"/"+Ext.getCmp("weight2").value+"/"+Ext.getCmp("weight3").value+")",maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+selectedFillColor}}))),2==curLanguage&&(prioritizationLegendLayer.name="Focalizaci\xf3n:","compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id?(0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"S\xf3lo Carbono",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"S\xf3lo Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"S\xf3lo Hidrol\xf3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Carbono y Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})),o.push(new OpenLayers.Rule({title:"Carbono y Hidrol\xf3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FFFF"}})),o.push(new OpenLayers.Rule({title:"Biodiversidad y Hidrol\xf3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF00FF"}})),o.push(new OpenLayers.Rule({title:"Todos Tres Beneficios",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFFFF"}}))),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"S\xf3lo Carbono",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"S\xf3lo Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"Carbono y Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"S\xf3lo Carbono",maxScaleDenominator:3e9,symbolizer:{fillColor:"#00FF00"}})),o.push(new OpenLayers.Rule({title:"S\xf3lo Hidrol\xf3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Carbono y Hidrol\xf3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}}))),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(o.push(new OpenLayers.Rule({title:"S\xf3lo Biodiversidad",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FF0000"}})),o.push(new OpenLayers.Rule({title:"S\xf3lo Hidrol\xf3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#0000FF"}})),o.push(new OpenLayers.Rule({title:"Biodiversidad y Hidrol\xf3gico",maxScaleDenominator:3e9,symbolizer:{fillColor:"#FFFF00"}})))):o.push(new OpenLayers.Rule({title:"Seleccionado ("+Ext.getCmp("weight1").value+"/"+Ext.getCmp("weight2").value+"/"+Ext.getCmp("weight3").value+")",maxScaleDenominator:3e9,symbolizer:{fillColor:"#"+selectedFillColor}}))),prioritizationLegendLayer.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({},{rules:o})}),app.mapPanel.map.addLayer(prioritizationLegendLayer),prioritizationLegendLayer.name="Prioritization Legend"}}function updatePrioritization(){var a=prioritizationLayer.visibility;prioritizationLayer.setVisibility(!1),priorityParams="dataSource:"+dataSourceTableName+";locationParam:"+locationParamName+";budgetMax:",priorityParams+=Ext.getCmp("rawRadio").getValue()?Ext.getCmp("budget_raw").value:Ext.getCmp("budget_percentage").value/100+"*(SELECT MAX(cumcost) FROM BenefitBudget)",priorityParams+=";"+whereClauseStr+";"+inClauseStr+";forestThreshold:"+forestThreshold,priorityParams+=Ext.getCmp("chkRisk").getValue()?";riskVar:risk":";riskVar:1",priorityParams+=Ext.getCmp("chkCost").getValue()?";costVar:oppcost":";costVar:1","compareTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id?(prioritizationLayer.mergeNewParams({sld_body:null}),-1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&(Ext.getCmp("compareObjectiveCombo").selectedIndex=0),0==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CBH"}),1==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CB"}),2==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_CH"}),3==Ext.getCmp("compareObjectiveCombo").selectedIndex&&prioritizationLayer.mergeNewParams({styles:"data_prioritize_BH"})):("combineTab"==Ext.getCmp("benefitTabPanel").getActiveTab().id&&(priorityParams+=";weight1:"+Ext.getCmp("weight1").value,priorityParams+=";weight2:"+Ext.getCmp("weight2").value,priorityParams+=";weight3:"+Ext.getCmp("weight3").value),prioritizationLayer.mergeNewParams({sld_body:'<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0"><sld:NamedLayer><sld:Name>forestro_ws:data_prioritize</sld:Name><sld:UserStyle><sld:Name>forestro_ws:mredd_prioritize_Default</sld:Name><sld:Title/><sld:FeatureTypeStyle><sld:Rule><sld:Title>Polygon</sld:Title><ogc:Filter><ogc:PropertyIsEqualTo><ogc:PropertyName>selected</ogc:PropertyName><ogc:Literal>1</ogc:Literal></ogc:PropertyIsEqualTo></ogc:Filter><sld:PolygonSymbolizer><sld:Fill><sld:CssParameter name="fill">#'+selectedFillColor+"</sld:CssParameter></sld:Fill><sld:Stroke/></sld:PolygonSymbolizer></sld:Rule></sld:FeatureTypeStyle></sld:UserStyle></sld:NamedLayer></sld:StyledLayerDescriptor>"})),prioritizationLayer.mergeNewParams({viewparams:priorityParams}),0==app.mapPanel.map.getLayersByName("Prioritization Layer").length&&(app.mapPanel.map.getLayersByName("Selection").length>0&&app.mapPanel.map.removeLayer(selectLayer),app.mapPanel.map.addLayer(prioritizationLayer),app.mapPanel.map.addLayer(selectLayer)),prioritizationLayer.setVisibility(a),prioritizationLayer.redraw(),updateStyling()}function setDataSource(a){1==a&&(dataSourceName="forestro_ws:mredd",dataSourceTableName="mredd",locationParamName="sitio_id",nameAttribute="nom_na",idAttribute="fid_final",locationData=[[0,"Study Area"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoac\xe1n/Mexico"],[5,"Yucut\xe1n"],[6,"Chihuahua"]],spanishLocationData=[[0,"Zona de AATRs"],[1,"Jalisco"],[2,"Oaxaca"],[3,"Chiapas"],[4,"Michoac\xe1n/Mexico"],[5,"Yucut\xe1n"],[6,"Chihuahua"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)")),2==a&&(dataSourceName="forestro_ws:mredd_byregion",dataSourceTableName="mredd_byregion",locationParamName="region",nameAttribute="nombpred",idAttribute="fid_final",locationData=[[0,"Entire Country"],[1,"North West"],[2,"North"],[3,"North East"],[4,"Central West"],[5,"Central South"],[6,"South Pacific"],[7,"Gulf"],[8,"Peninsula"]],spanishLocationData=[[0,"Pa\xeds \xcdntegro"],[1,"Noroeste"],[2,"Norte"],[3,"Nordeste"],[4,"Centro-Oeste"],[5,"Centro Sur"],[6,"Pacifico Sur"],[7,"Golfo"],[8,"Pen\xednsula"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("(pes.)")),3==a&&(dataSourceName="forestro_ws:ca_aggregated",dataSourceTableName="fctt_aggregated_final",locationParamName="sitio_id",nameAttribute="",idAttribute="objectid",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xedses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)")),4==a&&(dataSourceName="forestro_ws:ca",dataSourceTableName="fctt_final",locationParamName="sitio_id",nameAttribute="",idAttribute="objectid",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xedses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!1,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)")),5==a&&(dataSourceName="forestro_ws:ca_admin",dataSourceTableName="fctt_admin_final",locationParamName="sitio_id",nameAttribute="",idAttribute="objectid",locationData=[[0,"All Countries"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],spanishLocationData=[[0,"Todos Pa\xedses"],[222,"El Salvador"],[591,"Panama"],[558,"Nicaragua"],[340,"Honduras"],[320,"Guatemala"],[214,"Dominican Republic"],[188,"Costa Rica"],[84,"Belize"]],linesOn=!0,"undefined"!=typeof Ext.getCmp("currencyLabel")&&Ext.getCmp("currencyLabel").setText("($)"))}function updateLanguage(){1==curLanguage&&(Ext.getCmp("appTitle").setText("Forest Conservation Targeting Tool (Beta)"),Ext.getCmp("appCopyright").setText("\xa9 2014 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission."),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-625),window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-550),Ext.getCmp("howToItem").setText("How To"),Ext.getCmp("instructionsItem").setText("Instructions"),Ext.getCmp("descriptionItem").setText("Description"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("User Questions"),Ext.getCmp("emailItem").setText("Email"),Ext.getCmp("aboutItem").setText("About"),Ext.getCmp("metadataItem").setText("Metadata"),Ext.getCmp("sponsorsItem").setText("Sponsors"),Ext.getCmp("teamItem").setText("Team"),Ext.getCmp("emailItem2").setText("Email"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("User Questions"),Ext.getCmp("userCommentsItem").setText("User Comments"),Ext.getCmp("emailItem3").setText("Email"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>"),Ext.getCmp("regionPanel").setTitle("DEFINE STUDY AREA"),Ext.getCmp("datasetLabel").label.update("Dataset:"),Ext.getCmp("datasource").bindStore([[5,"Central America Administrative"],[3,"Central America 10km"],[4,"Central America 1km"],[2,"Mexico Predios"],[1,"MREDD AATRs"]]),Ext.getCmp("datasource").setValue(Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field2),Ext.getCmp("regionLabel").label.update("Region:"),Ext.getCmp("regionSelectCombo").bindStore(locationData),Ext.getCmp("regionSelectCombo").setValue(Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field2),Ext.getCmp("siteZoomCombo").bindStore(locationData),Ext.getCmp("zoomtoLabel").label.update("Zoom To:"),Ext.getCmp("thresholdLabel").label.update("Minimum forest cover:"),Ext.getCmp("adminSelect").setTitle("By administrative boundary"),Ext.getCmp("manuallySelect").setTitle("Using manual selection tool"),Ext.getCmp("selectionMode").label.update("Selection mode:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Polygon"],[2,"Box"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("DISPLAY OPTIONS"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),Ext.getCmp("shpLinesLabel").label.update("Shape lines"),Ext.getCmp("shpFillLabel").label.update("Shape fill"),Ext.getCmp("opacityLabel").label.update("Opacity"),Ext.getCmp("margLayerLabel").label.update("Marginality Layer"),Ext.getCmp("basemapLabel").label.update("Base map type"),Ext.getCmp("basemapCombo").bindStore([[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satellite"],[4,"OpenStreetMap"],[5,"Forest Change(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Show Scale"),Ext.getCmp("panZoomLabel").label.update("Pan/Zoom Tool"),Ext.getCmp("colorByAttributePanel").setTitle("TARGETING DATA"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Low color</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">High color</div>'),Ext.getCmp("methodLabel").label.update("Method"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolate"],[1,"Quantiles"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Quantiles"),Ext.getCmp("colorAttribute").store=prioritizationVariables,Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("selectPanel").setTitle("TARGET"),Ext.getCmp("priorityBudget").setTitle("Choose Budget"),Ext.getCmp("percentageRadio").el.next("label").update("Percentage of total:"),Ext.getCmp("rawRadio").el.next("label").update("Raw budget:"),Ext.getCmp("combineTab").setTitle("Weight Benefits"),Ext.getCmp("carbonweightfield").label.update('<div style="color: green; font-weight: bold">Carbon:</div>'),Ext.getCmp("bioweightfield").label.update('<div style="color: red; font-weight: bold">Biodiversity:</div>'),Ext.getCmp("hydroweightfield").label.update('<div style="color: blue; font-weight: bold">Hydrological:</div>'),Ext.getCmp("compareTab").setTitle("Compare"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"All Benefits"],[1,"Carbon and Biodiversity"],[2,"Carbon and Hydro"],[3,"Biodiversity and Hydro"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),Ext.getCmp("chkRiskLabel").label.update("Include deforestation risk"),Ext.getCmp("chkCostLabel").label.update("Include cost"),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Clear</div>"),Ext.getCmp("printButton").setText("Print"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>"),Ext.getCmp("resetLegend").setText("Reset Legend Position"),Ext.getCmp("exportPanel").setTitle("EXPORT"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Export Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Export CSV</div>"),"undefined"!=typeof instructionsWindowSp&&(instructionsWindowSp.hidden||(instructionsWindow.show(),instructionsWindowSp.hide())),Ext.getCmp("myLegend").setTitle("Legend")),2==curLanguage&&(Ext.getCmp("appTitle").setText("Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal (Beta)"),Ext.getCmp("appCopyright").setText("\xa9 2014 Resources for the Future. Reservados todos los derechos. Ninguna porci\xf3n de los datos o el modelo puede ser usado sin permiso."),window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-375),Ext.getCmp("howToItem").setText("C\xf3mo"),Ext.getCmp("instructionsItem").setText("Instrucciones"),Ext.getCmp("descriptionItem").setText("Descripci\xf3n"),Ext.getCmp("faqItem").setText("FAQ"),Ext.getCmp("videoTutorialItem").setText("Video Tutorial"),Ext.getCmp("userQuestionsItem").setText("Preguntas de Usuarios"),Ext.getCmp("emailItem").setText("Correo"),Ext.getCmp("aboutItem").setText("Acerca de"),Ext.getCmp("metadataItem").setText("Metadatos"),Ext.getCmp("sponsorsItem").setText("Promotores"),Ext.getCmp("teamItem").setText("Equipo"),Ext.getCmp("emailItem2").setText("Correo"),Ext.getCmp("feedbackItem").setText("Feedback"),Ext.getCmp("userQuestionsItem2").setText("Preguntas de Usuarios"),Ext.getCmp("userCommentsItem").setText("Comentarios de Usuarios"),Ext.getCmp("emailItem3").setText("Correo"),Ext.getCmp("toolPanel").setTitle("<center><div style='color: black; font-weight: bold; font-size: 12px'>Caja de Herramientas</div>"),Ext.getCmp("regionPanel").setTitle("DEFINIR \xc1REA DE ESTUDIO"),Ext.getCmp("datasetLabel").label.update("Datos:"),Ext.getCmp("datasource").bindStore([[5,"Centroam\xe9rica Administrativa"],[3,"Centroam\xe9rica 10km"],[4,"Centroam\xe9rica 1km"],[2,"Predios de Mexico"],[1,"MREDD AATRs"]]),Ext.getCmp("datasource").setValue(Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field2),Ext.getCmp("regionLabel").label.update("Regi\xf3n:"),Ext.getCmp("regionSelectCombo").bindStore(spanishLocationData),Ext.getCmp("regionSelectCombo").setValue(Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field2),Ext.getCmp("siteZoomCombo").bindStore(spanishLocationData),Ext.getCmp("thresholdLabel").label.update("Cubierta forestal m\xednima:"),Ext.getCmp("zoomtoLabel").label.update("Ampliar a:"),Ext.getCmp("adminSelect").setTitle("Por l\xedmites administrativos"),Ext.getCmp("manuallySelect").setTitle("Seleccionar manualmente"),Ext.getCmp("selectionMode").label.update("Modo de selecci\xf3n:"),updateSelectionButtonLanguage(),Ext.getCmp("selectModeCombo").bindStore([[1,"Pol\xedgono"],[2,"Caja"]]),Ext.getCmp("selectModeCombo").setValue(Ext.getCmp("selectModeCombo").store.data.items[Ext.getCmp("selectModeCombo").selectedIndex].data.field2),Ext.getCmp("optionsPanel").setTitle("OPCIONES DE VISUALIZACI\xd3N"),Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Color de Relleno Predeterminada</div>'),Ext.getCmp("shpLinesLabel").label.update("L\xedneas poligonales"),Ext.getCmp("shpFillLabel").label.update("Relleno de forma"),Ext.getCmp("opacityLabel").label.update("Opacidad"),Ext.getCmp("margLayerLabel").label.update("Capa de Marginalidad"),Ext.getCmp("basemapLabel").label.update("Tipo de basemap"),Ext.getCmp("basemapCombo").bindStore([[0,"Ninguno"],[1,"Google F\xedsico"],[2,"Google H\xedbrido"],[3,"Google Sat\xe9lite"],[4,"OpenStreetMap"],[5,"Cambio Forestal(2000-2012)"]]),Ext.getCmp("basemapCombo").setValue(Ext.getCmp("basemapCombo").store.data.items[Ext.getCmp("basemapCombo").selectedIndex].data.field2),Ext.getCmp("showScaleLabel").label.update("Mostrar Escala"),Ext.getCmp("panZoomLabel").label.update("Ampliar/Recorrer"),Ext.getCmp("colorByAttributePanel").setTitle("DATOS DE FOCALIZACI\xd3N"),Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("methodLabel").label.update("M\xe9todo"),Ext.getCmp("methodCombo").bindStore([[0,"Interpolar"],[1,"Cuantilas"]]),Ext.getCmp("methodCombo").setValue(Ext.getCmp("methodCombo").store.data.items[Ext.getCmp("methodCombo").selectedIndex].data.field2),Ext.getCmp("quantilesLabel").label.update("# Cuantilas"),Ext.getCmp("colorAttribute").store=prioritizationVariablesSpanish,Ext.getCmp("colorAttribute").getView().refresh(),Ext.getCmp("updatedatavis").setText("<div style='color:green; font-weight: bold;font-size: 12'>Actualizar Visualizaci\xf3n</div>"),Ext.getCmp("cleardatavis").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("selectPanel").setTitle("FOCALIZAR"),Ext.getCmp("priorityBudget").setTitle("Elegir Presupuesto"),Ext.getCmp("percentageRadio").el.next("label").update("Porcentaje del total:"),Ext.getCmp("rawRadio").el.next("label").update("Prima:"),Ext.getCmp("combineTab").setTitle("Ponderar Beneficios"),Ext.getCmp("carbonweightfield").label.update('<div style="color: green; font-weight: bold">Carbono:</div>'),Ext.getCmp("bioweightfield").label.update('<div style="color: red; font-weight: bold">Biodiversidad:</div>'),Ext.getCmp("hydroweightfield").label.update('<div style="color: blue; font-weight: bold">Hidrol\xf3gico:</div>'),Ext.getCmp("compareTab").setTitle("Comparar"),Ext.getCmp("compareObjectiveCombo").bindStore([[0,"Todos Beneficios"],[1,"Carbono y Biodiversidad"],[2,"Carbon y Hidrol\xf3gico"],[3,"Biodiversidad y Hidrol\xf3gico"]]),Ext.getCmp("compareObjectiveCombo").setValue(Ext.getCmp("compareObjectiveCombo").store.data.items[Ext.getCmp("compareObjectiveCombo").selectedIndex].data.field2),Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("chkRiskLabel").label.update("Incluir riesgo de deforestaci\xf3n"),Ext.getCmp("chkCostLabel").label.update("Incluir costo"),Ext.getCmp("submitprioritization").setText("<div style='color:green; font-weight: bold;font-size: 12'>Entregar/Actualizar</div>"),Ext.getCmp("clearprioritization").setText("<div style='color:black;font-size: 12'>Borrar</div>"),Ext.getCmp("printButton").setText("Imprimir"),Ext.getCmp("resetButton").setText("<div style='color:blue;font-weight: bold;font-size: 12'>Restablecer Todo</div>"),Ext.getCmp("resetLegend").setText("Restablecer Leyenda"),Ext.getCmp("exportPanel").setTitle("EXPORTAR"),Ext.getCmp("shapefileButton").setText("<div style='color:black;font-size: 12'>Exportar Shapefile</div>"),Ext.getCmp("csvButton").setText("<div style='color:black;font-size: 12'>Exportar CSV</div>"),"undefined"!=typeof instructionsWindow&&(instructionsWindow.hidden||(instructionsWindow.hide(),instructionsWindowSp.show())),Ext.getCmp("myLegend").setTitle("Leyenda")),updateStyling(),updateOnZoom(app.mapPanel.map.getZoom())
}function updateSelectionButtonLanguage(){1==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selecci\xf3n</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),"<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Clear/Cancel</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>")),2==curLanguage&&("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Finalizar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Nueva Selecci\xf3n</div>"),"<div style='color:black;font-size: 12'>Clear/Cancel</div>"==Ext.getCmp("cancelclearselection").text&&Ext.getCmp("cancelclearselection").setText("<div style='color:black;font-size: 12'>Borrar/Cancelar</div>"),"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"==Ext.getCmp("selectsubmitselection").text&&Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Empezar a Seleccionar</div>"))}function componentToHex(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function hexToRgb(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}function mixLowAndHighColors(a){var b=Math.floor(a*hexToRgb(highColor).r+(1-a)*hexToRgb(lowColor).r),c=Math.floor(a*hexToRgb(highColor).g+(1-a)*hexToRgb(lowColor).g),d=Math.floor(a*hexToRgb(highColor).b+(1-a)*hexToRgb(lowColor).b);return rgbToHex(b,c,d)}function openPage(a,b){new Ext.Window({title:b,width:.6*window.innerWidth,height:.8*window.innerHeight,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:a}}]}).show()}function ClosePop(){mandatoryWindow.hide()}function zoomToRegion(a){var b={method:"GET",async:!1};b.url="../../geoserver/forestro_ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=forestro_ws:getExtents&viewparams=dataSource:"+dataSourceTableName;var c=Ext.getCmp("siteZoomCombo").store.data.items[a].data.field1;b.url+=";"+whereClauseStr+";forestThreshold:"+forestThreshold;var d=OpenLayers.Request.issue(b),e=new OpenLayers.Bounds;e.left=Number(d.responseXML.documentElement.lastChild.firstChild.firstChild.textContent),e.right=Number(d.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.textContent),e.top=Number(d.responseXML.documentElement.lastChild.firstChild.firstChild.nextSibling.nextSibling.textContent),e.bottom=Number(d.responseXML.documentElement.lastChild.firstChild.lastChild.textContent),(0!=c||2!=dataSourceNum)&&(e=e.scale(1.5)),app.mapPanel.map.zoomToExtent(e.transform("EPSG:4326","EPSG:900913"),!1)}function resetLegendPosition(){myLegend.show();var a=app.mapPanel.el.getTop()+5;myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,a]),Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-625),1==curLanguage&&window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-550),2==curLanguage&&window.innerWidth<1200&&Ext.getCmp("appTitleContainer").setWidth(window.innerWidth-375)}function updateOnZoom(a){8>a&&4==dataSourceNum&&(1==curLanguage&&(imgZoomEng.style.visibility="visible",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="visible"),dataLayer.setVisibility(!1)),(a>=8||4!=dataSourceNum)&&(1==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),2==curLanguage&&(imgZoomEng.style.visibility="hidden",imgZoomSpan.style.visibility="hidden"),dataLayer.setVisibility(!0)),a>9&&1==ghan.getVisibility()&&(ghan.setVisibility(!1),ghanActive=!0),9>=a&&1==ghanActive&&ghan.setVisibility(!0),a>18&&1==gosm.getVisibility()&&(gosm.setVisibility(!1),gosmActive=!0),18>=a&&1==gosmActive&&gosm.setVisibility(!0)}if(1==phpVarIsLoggedIn&0==phpVarIsLocalHost){var config={method:"GET",async:!1};config.url="http://"+phpVarLoginHeader+"@conservationroi.net/geoserver/wms?service=WMS&request=GetCapabilities";var getCapabilities=OpenLayers.Request.issue(config)}Ext.BLANK_IMAGE_URL="ext/resources/images/default/s.gif";var app,items=[],controls=[],toolItems=[],lowColor="0000FF",highColor="FF0000",defaultColor="003300",selectedFillColor="e2ff00",linesOn=!1,fillOn=!0,colorSchemeOn=!1,navigationMode=!0,tilesLeftToLoad=1,inClauseStr="idAttribute:1;inSet:1";whereClauseStr="whereParam:1;whereValue:1",priorityParams="",selectMode=1,ghanActive=!1,gosmActive=!1,forestThreshold=25;var curLanguage=2,dataSourceName,locationParamName,dataSourceTableName,nameAttribute,locationData,spanishLocationData,idAttribute,topBarHeight=40,imgWait=document.createElement("IMG");imgWait.src="images/loading.gif",imgWait.style.pointerEvents="none",imgWait.style.position="absolute",imgWait.style.top=225,imgWait.style.left=450,imgWait.style.zIndex=9999,imgWait.style.visibility="hidden";var imgZoomEng=document.createElement("IMG");imgZoomEng.src="images/zoomin_english.gif",imgZoomEng.style.pointerEvents="none",imgZoomEng.style.position="absolute",imgZoomEng.style.top=225,imgZoomEng.style.left=450,imgZoomEng.style.zIndex=9998,imgZoomEng.style.visibility="hidden";var imgZoomSpan=document.createElement("IMG");imgZoomSpan.src="images/zoomin_spanish.gif",imgZoomSpan.style.pointerEvents="none",imgZoomSpan.style.position="absolute",imgZoomSpan.style.top=225,imgZoomSpan.style.left=450,imgZoomSpan.style.zIndex=9998,imgZoomSpan.style.visibility="hidden";var dataSourceNum=5;setDataSource(dataSourceNum);var instructionsWindow=new Ext.Window({title:"Instructions",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define.html"}}],listeners:{minimize:{fn:function(){instructionsWindow.hide()}}}}),instructionsWindowSp=new Ext.Window({title:"Instrucciones",x:window.innerWidth-310,y:150,width:300,height:window.innerHeight-175,closable:!1,minimizable:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"documents/instructions_define_sp.html"}}],listeners:{minimize:{fn:function(){instructionsWindowSp.hide()}}}});Ext.onReady(function(){if(app=new Ext.Viewport({layout:"border",id:"app",border:0,items:[topbar,toolpanel,map,bottombar]}),Ext.getCmp("optionsPanel").collapse(),Ext.getCmp("colorByAttributePanel").collapse(),Ext.getCmp("selectPanel").collapse(),gphy.setVisibility(!0),ghyb.setVisibility(!1),gsat.setVisibility(!1),gosm.setVisibility(!1),ghan.setVisibility(!1),marginalityLayer.setVisibility(!1),prioritizationLayer.setVisibility(!1),updateStyling(),myLegend.show(),myLegend.alignTo(Ext.getBody(),"tr-tr",[-10,app.mapPanel.el.getTop()+5]),Ext.getCmp("regionSelectCombo").bindStore(locationData),Ext.getCmp("regionSelectCombo").setValue(0),Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("siteZoomCombo").bindStore(locationData),Ext.getCmp("siteZoomCombo").setValue(0),Ext.getCmp("siteZoomCombo").selectedIndex=0,Ext.getCmp("datasource").selectedIndex=0,Ext.getCmp("siteZoomCombo").selectedIndex=0,Ext.getCmp("selectModeCombo").selectedIndex=0,Ext.getCmp("basemapCombo").selectedIndex=1,Ext.getCmp("methodCombo").selectedIndex=0,Ext.getCmp("compareObjectiveCombo").selectedIndex=0,Ext.getCmp("topBar").getEl().dom.style.background="#4682B4",1==phpVarIsLoggedIn){1==curLanguage&&Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName),2==curLanguage&&Ext.getCmp("loginItem").setText("Logged in as "+phpVarUserName),Ext.getCmp("loginItem2").hide(),Ext.getCmp("registerItem").hide(),Ext.getCmp("userDashboardItem").show(),Ext.getCmp("logoutItem").show();for(var a=1;phpVarNumDataSets>a;a++){var b=a+5;Ext.getCmp("datasource").store.add(new Ext.data.Record({field1:b.toString(),field2:"User Layer: "+phpVarDataSetList[a]}))}Ext.getCmp("datasource").store.load()}else 1==curLanguage&&Ext.getCmp("loginItem").setText("Log in"),2==curLanguage&&Ext.getCmp("loginItem").setText("Log in"),Ext.getCmp("loginItem2").show(),Ext.getCmp("registerItem").show(),Ext.getCmp("userDashboardItem").hide(),Ext.getCmp("logoutItem").hide();registerEvents(dataLayer),registerEvents(prioritizationLayer),imgWait.style.top=(parseInt(app.mapPanel.body.dom.style.height)-128)/2,imgWait.style.left=(parseInt(app.mapPanel.body.dom.style.width)-128)/2,document.getElementById("map").appendChild(imgWait),imgZoomEng.style.top=50,imgZoomEng.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomEng),imgZoomSpan.style.top=50,imgZoomSpan.style.left=(parseInt(app.mapPanel.body.dom.style.width)-750)/2,document.getElementById("map").appendChild(imgZoomSpan);var c=new Ext.Window({title:"Encuesta de Usuarios",width:550,height:500,x:425,y:55,resizable:!0,draggable:!0,anchor:!0,layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",src:"http://conservationroi.net/survey/index.php/survey/index/sid/259836"}}]}).show();c.hide(),updateLanguage()}),Ext.chromeVersion=Ext.isChrome?parseInt(/chrome\/(\d{2})/.exec(navigator.userAgent.toLowerCase())[1],10):0/0,Ext.grid.ColumnModel.override({getTotalWidth:function(a){if(!this.totalWidth){var b=Ext.isChrome&&Ext.chromeVersion>18?2:0;this.totalWidth=0;for(var c=0,d=this.config.length;d>c;c++)(a||!this.isHidden(c))&&(this.totalWidth+=this.getColumnWidth(c)+b)}return this.totalWidth}});var printProvider=new GeoExt.data.PrintProvider({url:"/geoserver/pdf",method:"POST",capabilities:printCapabilities,timeout:1e5,customParams:{mapTitle:"",comment:""}});printPage=new GeoExt.data.PrintPage({printProvider:printProvider});var dpi=printProvider.dpis.getAt(printProvider.dpis.totalLength-1);printProvider.setDpi(dpi);var myLegend=new Ext.Window({id:"myLegend",title:"Legend",width:250,collapsible:!0,autoScroll:!0,layout:"anchor",closable:!1,monitorResize:!0,items:[legendPanel=new GeoExt.LegendPanel({defaults:{labelCls:"mylabel",style:"padding:5px",baseParams:{legend_options:"forceLabels:on"}},preferredTypes:["gx_vectorlegend"],dynamic:!0,bodyStyle:"padding:5px",autoScroll:!0,region:"west"})]}),gphy=new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),ghyb=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gsat=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,sphericalMercator:!0,isBaseLayer:!0,numZoomLevels:23,MAX_ZOOM_LEVEL:22}),gosm=new OpenLayers.Layer.OSM("OpenStreetMap",["http://otile1.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png"]),ghan=new OpenLayers.Layer.XYZ("Hansen Forest Cover","http://earthengine.google.org/static/hansen_2013/loss_forest_gain/${z}/${x}/${y}.png",{sphericalMercator:!0,attribution:"Hansen et al. 2014",isBaseLayer:!0}),dataLayer=new OpenLayers.Layer.WMS("Data Layer","/geoserver/wms",{layers:dataSourceName+"_query",transparent:!0},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!1,opacity:.65,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),marginalityLayer=new OpenLayers.Layer.WMS("Data Layer","/geoserver/wms",{layers:"forestro_ws:marginality",transparent:!0,styles:"marginality"},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!1,opacity:1,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:2500}}),selectLayer=new OpenLayers.Layer.Vector("Selection",{displayInLayerSwitcher:!1}),prioritizationLayer=new OpenLayers.Layer.WMS("Prioritization Results","/geoserver/wms",{layers:"forestro_ws:data_prioritize",transparent:!0},{singleTile:!0,transitionEffect:"resize",isBaseLayer:!1,displayInLayerSwitcher:!1,opacity:.65,projection:"EPSG:900913",tileOptions:{maxGetUrlLength:5e3}}),highlightedFeaturesCopy=selectLayer.clone(),colorSchemeLegendLayer=new OpenLayers.Layer.Vector("Color By Attribute Scheme",{isBaseLayer:!1,displayInLayerSwitcher:!0});colorSchemeLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var hansenLegendLayer=new OpenLayers.Layer.Vector("Hansen Legend",{isBaseLayer:!1,displayInLayerSwitcher:!0});hansenLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var prioritizationLegendLayer=new OpenLayers.Layer.Vector("Prioritization Legend",{isBaseLayer:!1,displayInLayerSwitcher:!0});prioritizationLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var marginalityLegendLayer=new OpenLayers.Layer.Vector("Marginality Legend",{isBaseLayer:!1,displayInLayerSwitcher:!0});marginalityLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))));var prioritizationVariables=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbon"," t/ha"],["biodiversi","Biodiversity"," RWRI"],["hydro","Hydrological Services Index",""],["risk","Deforestation Risk","%"],["oppcost","Cost"," ($ or pes)/ha"],["scenario1","Carbon  expected benefit per cost",""],["scenario2","Biodiversity expected benefit per cost",""],["scenario3","Hydro  expected benefit per cost",""]]}),prioritizationVariablesSpanish=new Ext.data.ArrayStore({fields:["name","displayName","unit"],data:[["carbon","Carbono"," t/ha"],["biodiversi","Biodiversidad"," RWRI"],["hydro","Indice de Servicios Hidrol\xf3gicos",""],["risk","Riesgo de Deforestaci\xf3n","%"],["oppcost","Costo"," ($ o pes)/ha"],["scenario1","Beneficio esperado de carbono por costo",""],["scenario2","Beneficio esperado biodiversidad  por costo",""],["scenario3","Beneficio esperado hidrol\xf3gico  por costo",""]]}),map={xtype:"gx_mappanel",id:"map",ref:"mapPanel",region:"center",fractionalZoom:!0,layers:[ghan,gosm,gsat,ghyb,gphy,marginalityLayer,dataLayer,selectLayer],map:{controls:controls,eventListeners:{zoomend:function(){updateOnZoom(this.getZoom())}}},extent:OpenLayers.Bounds.fromArray([-103e5,23e5,-75e5,76e4])};OpenLayers.Control.CustomNavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomBox({type:OpenLayers.Control.TYPE_TOGGLE,title:"Toggle Box Zoom Tool",zoomOnClick:!1})]),this.displayClass="olControlNavToolbar"},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return a}}),controls.push(navControl=new OpenLayers.Control.Navigation({zoomWheelEnabled:!0,mouseWheelOptions:{interval:250,cumulative:!1}}),panzoomControl=new OpenLayers.Control.PanZoom,attributionControl=new OpenLayers.Control.Attribution,keyboardPanZoomControl=new OpenLayers.Control.KeyboardDefaults,scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}),navZoomControl=new OpenLayers.Control.CustomNavToolbar,showCoordinates=new OpenLayers.Control.MousePosition({displayProjection:"ESPG:4326",separator:" | ",numDigits:2}));var myToolTip=new Ext.ToolTip,hoverControl=new OpenLayers.Control.WMSGetFeatureInfo({infoFormat:"application/vnd.ogc.gml",layers:[dataLayer],vendorParams:{radius:0},protocol:OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),autoActivate:!0,hover:!0,handlerOptions:{hover:{delay:500}},eventListeners:{getfeatureinfo:function(a){if(Ext.getCmp("colorAttribute").getSelectionModel().selections.items.length>0&a.features.length>0){var b=a.features[0].attributes[Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name];"risk"==Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.name&&(b=100*b),isNaN(b)||(b=Number(b).toPrecision(4));var c="Value of "+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.displayName+": "+b+Ext.getCmp("colorAttribute").getSelectionModel().selections.items[0].data.unit;myToolTip.destroy(),myToolTip=new Ext.ToolTip({html:c,dismissDelay:2e3}),myToolTip.showAt([a.xy.x+275,a.xy.y])}}}});controls.push(hoverControl);var selectBox=new OpenLayers.Control.GetFeature({id:"selectControl",protocol:OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),click:!1,clickTolerance:0,box:!0,multipleKey:"shiftKey",toggleKey:"ctrlKey"});selectBox.events.register("featureselected",this,function(a){selectLayer.addFeatures([a.feature])}),selectBox.events.register("featureunselected",this,function(a){selectLayer.removeFeatures([a.feature])});var selectPolygon=new OpenLayers.Control.DrawFeature(selectLayer,OpenLayers.Handler.Polygon);controls.push(selectBox,selectPolygon);var infoClick=new OpenLayers.Control.GetFeature({id:"infoClickControl",protocol:OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),click:!0,box:!1,toggle:!1,multiple:!1,single:!1,clickTolerance:0,maxFeatures:10,multipleKey:"shiftKey",autoActivate:!0});infoClick.events.register("featuresselected",this,function(a){var b=[];selectLayer.removeAllFeatures(),Ext.each(a.features,function(a){var c="";c=a.attributes[idAttribute],"string"==typeof a.attributes[nameAttribute]&&(c+=": "+a.attributes[nameAttribute]),b.push(new Ext.grid.PropertyGrid({xtype:"propertygrid",id:a.fid,title:c,source:a.attributes,autoActivate:!0,listeners:{beforeedit:{fn:function(){return!1}},expand:function(a){selectLayer.removeAllFeatures();for(var b=0;b<highlightedFeaturesCopy.features.length;b++)highlightedFeaturesCopy.features[b].fid==a.id&&selectLayer.addFeatures(highlightedFeaturesCopy.features[b]);selectLayer.redraw()}}})),selectLayer.addFeatures(a),highlightedFeaturesCopy=selectLayer.clone();for(var d=0;d<highlightedFeaturesCopy.features.length;d++)highlightedFeaturesCopy.features[d].fid=selectLayer.features[d].fid}),selectLayer.redraw(),Ext.getCmp("attributePanel")&&Ext.getCmp("attributePanel").destroy(),a.features.length>0&&new GeoExt.Popup({id:"attributePanel",title:"Feature Attributes",layout:"accordion",layoutConfig:{multi:!0},map:app.mapPanel,location:new OpenLayers.Pixel(150,425),panIn:!1,height:400,width:250,collapsible:!0,autoScroll:!0,collapsed:!0,titleCollapse:!0,items:b,listeners:{close:{fn:function(){selectLayer.removeAllFeatures(),highlightedFeaturesCopy.removeAllFeatures()}}}}).show()}),controls.push(infoClick);var clickControl=new OpenLayers.Control.WMSGetFeatureInfo({infoFormat:"application/vnd.ogc.gml",layers:[dataLayer],vendorParams:{radius:0},protocol:OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),autoActivate:!0,eventListeners:{getfeatureinfo:function(a){var b=[];selectLayer.removeAllFeatures(),Ext.each(a.features,function(a){var c="";c=a.attributes[idAttribute],"string"==typeof a.attributes[nameAttribute]&&(c+=": "+a.attributes[nameAttribute]),b.push(new Ext.grid.PropertyGrid({xtype:"propertygrid",id:a.fid,title:c,source:a.attributes,autoActivate:!0,listeners:{beforeedit:{fn:function(){return!1}},expand:function(a){selectLayer.removeAllFeatures();for(var b=0;b<highlightedFeaturesCopy.features.length;b++)highlightedFeaturesCopy.features[b].fid==a.id&&selectLayer.addFeatures(highlightedFeaturesCopy.features[b]);selectLayer.redraw()}}})),a.geometry.transform("EPSG:4326","EPSG:900913"),selectLayer.addFeatures(a),highlightedFeaturesCopy=selectLayer.clone();for(var d=0;d<highlightedFeaturesCopy.features.length;d++)highlightedFeaturesCopy.features[d].fid=selectLayer.features[d].fid}),selectLayer.redraw(),Ext.getCmp("attributePanel")&&Ext.getCmp("attributePanel").destroy(),a.features.length>0&&new GeoExt.Popup({id:"attributePanel",title:"Feature Attributes",layout:"accordion",layoutConfig:{multi:!0},map:app.mapPanel,location:new OpenLayers.Pixel(a.xy.x+150,a.xy.y+425),panIn:!1,height:400,width:250,collapsible:!0,autoScroll:!0,collapsed:!0,titleCollapse:!0,items:b,listeners:{close:{fn:function(){selectLayer.removeAllFeatures(),highlightedFeaturesCopy.removeAllFeatures()}}}}).show()}}}),bottombar={xtype:"container",id:"bottomBar",ref:"bottomBar",height:15,padding:0,region:"south",border:!1,style:"padding:2px 0px 0px 0px",items:[{xtype:"label",id:"appCopyright",text:"\xa9 2014 Resources for the Future. All rights reserved. No portion of the data or model may be used without permission.",style:"font: bold 9px arial; color: blue; text-align: center; display:inline-block",width:window.innerWidth}]},topbar={xtype:"toolbar",id:"topBar",ref:"topBar",height:topBarHeight,padding:0,region:"north",border:!1,style:"padding:0px 0px 0px 0px",cls:"topBar",items:[new Ext.Button({text:"How To",id:"howToItem",menu:[{text:"Description",id:"descriptionItem",listeners:{click:function(){1==curLanguage&&openPage("documents/description.pdf","Forest Conservation Targeting Tool Description"),2==curLanguage&&openPage("documents/description.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Descripci\xf3n")}}},{text:"Instructions",id:"instructionsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/instructions.pdf","Forest Conservation Targeting Tool Instructions"),2==curLanguage&&openPage("documents/instructions.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Instrucciones")}}},{text:"FAQ",id:"faqItem",listeners:{click:function(){1==curLanguage&&openPage("documents/faq.html","Forest Conservation Targeting Tool FAQ"),2==curLanguage&&openPage("documents/faq_sp.html","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - FAQ")}}},{text:"Video Tutorial",id:"videoTutorialItem",listeners:{click:function(){1==curLanguage&&openPage("documents/tutorial.html","Forest Conservation Targeting Tool Video Tutorial"),2==curLanguage&&openPage("documents/tutorial_sp.html","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Video Tutorial")}}},{text:"User Questions",id:"userQuestionsItem",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Preguntas de Usuarios")}}},{text:"Email",id:"emailItem",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"About",id:"aboutItem",menu:[{text:"Metadata",id:"metadataItem",listeners:{click:function(){1==curLanguage&&openPage("documents/metadata.pdf","Forest Conservation Targeting Tool Metadata"),2==curLanguage&&openPage("documents/metadata.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Metadatos")}}},{text:"Sponsors",id:"sponsorsItem",listeners:{click:function(){1==curLanguage&&openPage("documents/sponsors.pdf","Forest Conservation Targeting Tool Sponsors"),2==curLanguage&&openPage("documents/sponsors.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Promotores")}}},{text:"Team",id:"teamItem",listeners:{click:function(){1==curLanguage&&openPage("documents/team.pdf","Forest Conservation Targeting Tool Team"),2==curLanguage&&openPage("documents/team.pdf","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Equipo")}}},{text:"Email",id:"emailItem2",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Feedback",id:"feedbackItem",menu:[{text:"User Questions",id:"userQuestionsItem2",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/userquestions","Forest Conservation Targeting Tool User Questions"),2==curLanguage&&openPage("http://conservationroi.net/userquestions","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Preguntas de Usuarios")}}},{id:"userCommentsItem",id:"userCommentsItem",text:"User Comments",listeners:{click:function(){1==curLanguage&&openPage("http://conservationroi.net/usercomments","Forest Conservation Targeting Tool User Comments"),2==curLanguage&&openPage("http://conservationroi.net/usercomments","Herramienta Focalizaci\xf3n de Conservaci\xf3n Forestal - Comentarios de Usuarios")}}},{text:"Email",id:"emailItem3",listeners:{click:function(){window.location.href="mailto:support@conservationroi.net"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),new Ext.Button({text:"Log in",id:"loginItem",menu:[{text:"Log in",id:"loginItem2",listeners:{click:function(){window.location="../../usersystem/login_fctt.php"}}},{id:"userDashboardItem",text:"User Dashboard",listeners:{click:function(){1==curLanguage&&openPage("../../usersystem/userdashboard.php","User Dashboard"),2==curLanguage&&openPage("../../usersystem/userdashboard.php","Panel de Usuario")}}},{id:"registerItem",text:"Register",listeners:{click:function(){1==curLanguage&&openPage("../../usersystem/register.php","Register New User"),2==curLanguage&&openPage("../../usersystem/register.php","Registrar Nueva Usuario")}}},{id:"logoutItem",text:"Logout",listeners:{click:function(){window.location="../../usersystem/logout_fctt.php"}}}],listeners:{mouseover:function(){this.showMenu()},menutriggerout:function(){}}}),{xtype:"spacer",width:20},{xtype:"compositefield",fieldLabel:"Language/Idioma",items:[{xtype:"combo",id:"language",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:110,queryMode:"local",value:"Espa\xf1ol",store:[[1,"English"],[2,"Espa\xf1ol"]],listeners:{select:function(a,b,c){curLanguage=c+1,updateLanguage()}}}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},id:"appTitleContainer",style:"padding:5px 0px 0px 0px",width:window.innerWidth-625,height:topBarHeight,items:[{xtype:"label",id:"appTitle",text:"Forest Conservation Targeting Tool (Beta)",style:"font: bold "+topBarHeight/1.75+"px arial; color: white; text-align: center; display:inline-block"}]},"->",{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/nasa-logo.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.servir.net" target="_blank"><img src="images/Mesoamerica2.png" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:10},{xtype:"box",html:'<a href = "http://www.rff.org" target="_blank"><img src="images/rff_transparent.gif" height='+topBarHeight+"></img></a>",height:topBarHeight,align:"top"},{xtype:"spacer",width:5}]},toolpanel={id:"toolPanel",ref:"toolPanel",padding:0,region:"west",title:"<center><div style='color: black; font-weight: bold; font-size: 12px'>Tool Box</div>",bodyStyle:"background-image:url(images/panel2.jpg);background-size: cover",collapsible:!0,width:250,autoScroll:!0,items:toolItems,bbar:[{id:"resetButton",text:"<div style='color:blue;font-weight: bold;font-size: 12'>Reset All</div>",handler:function(){dataSourceNum=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1,setDataSource(dataSourceNum),app.mapPanel.map.getZoom()<8&&4==dataSourceNum&&dataLayer.setVisibility(!1),Ext.getCmp("chkLines").setValue(linesOn),whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",forestThreshold=25,Ext.getCmp("thresholdSlider").setValue(forestThreshold),dataLayer.mergeNewParams({layers:dataSourceName+"_query",viewparams:inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold}),prioritizationLayer.mergeNewParams({viewparams:"dataSource:"+dataSourceTableName+";"+inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold}),Ext.getCmp("regionSelectCombo").setValue(0),Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("siteZoomCombo").setValue(0),Ext.getCmp("siteZoomCombo").selectedIndex=0,Ext.getCmp("colorAttribute").getSelectionModel().clearSelections(),colorSchemeOn=!1,Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1),Ext.getCmp("chkCost").setValue(!0),Ext.getCmp("chkRisk").setValue(!0),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),infoClick.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),zoomToRegion(0),updateOnZoom(app.mapPanel.map.getZoom()),updateStyling(),dataLayer.redraw(),resetLegendPosition()}},{id:"printButton",text:"Print",hidden:!0,handler:function(){if(0==selectLayer.features.length){var a=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0));selectLayer.addFeatures([a]),colorSchemeLegendLayer.removeAllFeatures(),printPage.fit(app.mapPanel,!0),printProvider.print(app.mapPanel,printPage),colorSchemeLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0)))),selectLayer.removeFeatures(a)}else colorSchemeLegendLayer.removeAllFeatures(),printPage.fit(app.mapPanel,!0),printProvider.print(app.mapPanel,printPage),colorSchemeLegendLayer.addFeatures(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.Point(0,0))))}},"->",{id:"resetLegend",text:"Reset Legend Position",handler:function(){resetLegendPosition()}}]},alwaysOpenTopPanel={xtype:"panel",layout:"form",border:!1,padding:"5px",labelWidth:80,hidden:!0,items:[{xtype:"compositefield",fieldLabel:"Zoom To",id:"zoomtoLabel",hidden:!0,items:[{xtype:"combo",id:"siteZoomCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:140,value:"Study Area",store:locationData,queryMode:"local",listeners:{select:function(){zoomToRegion(Ext.getCmp("siteZoomCombo").selectedIndex)}}}]}]},regionPanel={id:"regionPanel",title:"DEFINE STUDY AREA",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 3px;",labelWidth:80,items:[{xtype:"compositefield",fieldLabel:"Dataset",id:"datasetLabel",items:[{xtype:"combo",id:"datasource",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:135,queryMode:"local",value:"Central America 10km",store:[[5,"Central America Administrative"],[3,"Central America 10km"],[4,"Central America 1km"],[2,"Mexico Predios"],[1,"MREDD AATRs"]],listeners:{select:function(){var d=dataSourceNum,e=Ext.getCmp("datasource").store.data.items[Ext.getCmp("datasource").selectedIndex].data.field1;e>5&&alert(e),d!=e&&(dataSourceNum=e,setDataSource(dataSourceNum),app.mapPanel.map.getZoom()<8&&4==dataSourceNum&&dataLayer.setVisibility(!1),1==curLanguage&&(Ext.getCmp("regionSelectCombo").bindStore(locationData),Ext.getCmp("siteZoomCombo").bindStore(locationData)),2==curLanguage&&(Ext.getCmp("regionSelectCombo").bindStore(spanishLocationData),Ext.getCmp("siteZoomCombo").bindStore(spanishLocationData)),inClauseStr="idAttribute:1;inSet:1",(3!=d&&4!=d&&5!=d||3!=e&&4!=e&&5!=e)&&(whereClauseStr="whereParam:1;whereValue:1",Ext.getCmp("regionSelectCombo").selectedIndex=0,Ext.getCmp("regionSelectCombo").setValue(0),Ext.getCmp("siteZoomCombo").setValue(0),Ext.getCmp("siteZoomCombo").selectedIndex=0,zoomToRegion(0)),dataLayer.mergeNewParams({layers:dataSourceName+"_query",viewparams:inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold}),prioritizationLayer.mergeNewParams({viewparams:"dataSource:"+dataSourceTableName+";"+inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold}),prioritizationLayer.setVisibility(!1),selectLayer.removeAllFeatures(),selectBox.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),infoClick.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(dataLayer),Ext.getCmp("chkLines").setValue(linesOn),updateOnZoom(app.mapPanel.map.getZoom()),dataLayer.redraw(),updateStyling(),1==dataSourceNum||2==dataSourceNum?Ext.getCmp("chkMarginality").setDisabled(!1):(Ext.getCmp("chkMarginality").setDisabled(!0),Ext.getCmp("chkMarginality").setValue(!1),marginalityLayer.setVisibility(!1)),prioritizationLayer.setVisibility(!1),prioritizationLayer.redraw())
}}}]},{xtype:"compositefield",fieldLabel:"Minimum Forest Cover",id:"thresholdLabel",hidden:!1,items:[{xtype:"slider",id:"thresholdSlider",aggressive:!0,vertical:!1,useTips:!1,value:25,maxValue:100,minValue:25,width:100,listeners:{change:function(a){Ext.getCmp("thresholdValueLabel").setText(a.getValue()+"%"),forestThreshold=a.getValue(),updatePrioritization()}}},{xtype:"label",id:"thresholdValueLabel",text:"25%",style:{padding:"3px 0px 0px 0px"}},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"panel",title:"By administrative boundary",id:"adminSelect",collapsible:!0,collapsed:!0,titleCollapse:!0,labelWidth:80,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"compositefield",fieldLabel:"Region",id:"regionLabel",items:[{xtype:"combo",id:"regionSelectCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:135,value:"Study Area",store:locationData,queryMode:"local",listeners:{select:function(){var d=Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field1;d>0?(whereClauseStr="whereParam:"+locationParamName+";whereValue:"+d,inClauseStr="idAttribute:1;inSet:1",dataLayer.mergeNewParams({viewparams:inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold}),prioritizationLayer.mergeNewParams({viewparams:"dataSource:"+dataSourceTableName+";"+inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold})):(whereClauseStr="whereParam:1;whereValue:1",inClauseStr="idAttribute:1;inSet:1",dataLayer.mergeNewParams({viewparams:inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold}),prioritizationLayer.mergeNewParams({viewparams:"dataSource:"+dataSourceTableName+";"+inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold})),prioritizationLayer.setVisibility(!1),zoomToRegion(Ext.getCmp("regionSelectCombo").selectedIndex),updateStyling()}}}]}]},{xtype:"panel",title:"Using manual selection tool",id:"manuallySelect",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",style:"padding 0px 0px 10px 0px",items:[{xtype:"compositefield",fieldLabel:"Selection Mode",id:"selectionMode",items:[{xtype:"combo",id:"selectModeCombo",selectedIndex:0,width:115,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",value:"Polygon",store:[[1,"Polygon"],[2,"Box"]],listeners:{select:function(a,b,c){selectMode=c+1,2==selectMode&&(Ext.Msg.alert("Note","Use of the Box/Manual Select Tool is not recommended for selecting more than 10,000 shapes. In this case, please use the Within Polygon or Upload Shapefile tool."),2==curLanguage&&Ext.Msg.alert("Nota","De usuario de la herramienta de selecci\xf3n Caja/Clic Manual no se recomienda para la selecci\xf3n de m\xe1s de 10,000 formas. En este caso, por favor, utilice la herramienta de Dentro Pol\xedgono o Subir Shapefile."))}}}]}],listeners:{expand:function(){"undefined"!=typeof instructionsWindow&&(1==curLanguage&&(instructionsWindow.show(),instructionsWindowSp.hide()),2==curLanguage&&(instructionsWindow.hide(),instructionsWindowSp.show()))}},bbar:[{xtype:"button",id:"selectsubmitselection",text:"<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){if(navigationMode)navigationMode=!1,1==selectMode&&selectPolygon.activate(),2==selectMode&&selectBox.activate(),hoverControl.deactivate(),infoClick.deactivate(),selectLayer.removeAllFeatures(),selectLayer.redraw(),dataLayer.redraw(),Ext.getCmp("attributePanel")&&(Ext.getCmp("attributePanel").removeAll(),Ext.getCmp("attributePanel").close()),Ext.getCmp("cancelclearselection").show(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Submit to Server</div>");else{if(1==selectMode){if(0==selectLayer.features.length&&(Ext.Msg.alert("Whoops!","No feature drawn. Please use the mouse to draw a study area polygon. Double-click to complete."),2==curLanguage&&Ext.Msg.alert("\xa1Ay!","Sin Caracter\xedsticas dibujadas. Utilice el rat\xf3n para dibujar una \xe1rea de estudio pol\xedgono. Haga doble clic para completar.")),1==selectLayer.features.length){var a=selectLayer.features[0];if(a.geometry.components[0].components.length<4)Ext.Msg.alert("Whoops!","Polygon must have at least three vertices."),2==curLanguage&&Ext.Msg.alert("\xa1Ay!","Pol\xedgono debe tener al menos tres v\xe9rtices.");else{a.geometry.transform("EPSG:900913","EPSG:4326"),whereClauseStr=a.geometry.toString(),whereClauseStr=whereClauseStr.replace("POLYGON","LINESTRING"),whereClauseStr=whereClauseStr.replace("((","("),whereClauseStr=whereClauseStr.replace("))",")"),whereClauseStr="whereValue:TRUE;whereParam:ST_Intersects(geom, (SELECT ST_MakePolygon(ST_GeomFromText('"+whereClauseStr+"',4326))))",whereClauseStr=whereClauseStr.replace(/,/g,"\\,"),inClauseStr="idAttribute:1;inSet:1";var b=inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold;dataLayer.mergeNewParams({viewparams:b})}}selectLayer.features.length>1&&(Ext.Msg.alert("Whoops!","Multiple features drawn. Limit is one."),2==curLanguage&&Ext.Msg.alert("\xa1Ay!","M\xfaltiples caracter\xedsticas dibujadas. Limit es una."))}if(2==selectMode){var c=[];Ext.iterate(selectBox.features,function(a,b){c.push(b.attributes[idAttribute])}),whereClauseStr="whereValue:1;whereParam1",inClauseStr="idAttribute:"+idAttribute+";inSet:"+c,inClauseStr=inClauseStr.replace(/,/g,"\\,"),0==c.length&&(Ext.Msg.alert("Whoops!","No features selected! Click on features or draw a box to select."),inClauseStr="idAttribute:1;inSet:1"),0==c.length&2==curLanguage&&(Ext.Msg.alert("\xa1Ay!","No hay caracter\xedsticas seleccionadas! Haga clic en las caracter\xedsticas o dibujar un cuadro para seleccionar."),inClauseStr="idAttribute:1;inSet:1"),c.length>0&&dataLayer.mergeNewParams({viewparams:whereClauseStr+";"+inClauseStr+";forestThreshold:"+forestThreshold})}Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Select New</div>"),navigationMode=!0,selectPolygon.deactivate(),selectBox.deactivate(),hoverControl.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),prioritizationLayer.setVisibility(!1),updateStyling(),dataLayer.redraw()}updateSelectionButtonLanguage()}},"->",{xtype:"button",id:"cancelclearselection",text:"<div style='color:black;font-size: 12'>Clear/Cancel</div>",icon:"images/clear.gif",hidden:!0,handler:function(){var a=Ext.getCmp("regionSelectCombo").store.data.items[Ext.getCmp("regionSelectCombo").selectedIndex].data.field1;0==a&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:1;whereValue:1",dataLayer.mergeNewParams({viewparams:inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold})),a>0&&(inClauseStr="idAttribute:1;inSet:1",whereClauseStr="whereParam:"+locationParamName+";whereValue:"+a,dataLayer.mergeNewParams({viewparams:inClauseStr+";"+whereClauseStr+";forestThreshold:"+forestThreshold})),Ext.iterate(selectBox.features,function(a){delete selectBox.features[a]}),selectBox.deactivate(),selectPolygon.deactivate(),inClauseStr="idAttribute:1;inSet:1",updateStyling(),navigationMode?(Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()):(navigationMode=!0,hoverControl.activate(),infoClick.activate(),selectLayer.removeAllFeatures(),Ext.getCmp("selectsubmitselection").setText("<div style='color:green; font-weight: bold;font-size: 12'>Begin Selecting</div>"),Ext.getCmp("cancelclearselection").hide()),updateSelectionButtonLanguage()}}]}]},optionsPanel={id:"optionsPanel",title:"DISPLAY OPTIONS",collapsible:!0,titleCollapse:!0,layout:"form",bodyStyle:"padding: 2;",items:[{xtype:"panel",id:"defaultColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>',items:[{xtype:"colorpalette",id:"defaultColorPicker",color:"blue",handler:function(a,b){defaultColor=b,Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Default Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("defaultColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+defaultColor+'; font-weight: bold">Color de Relleno Defecto</div>'),Ext.getCmp("defaultColorPanel").collapse(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape lines",id:"shpLinesLabel",items:[{xtype:"checkbox",id:"chkLines",checked:!1,handler:function(){linesOn=Ext.getCmp("chkLines").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Shape fill",id:"shpFillLabel",items:[{xtype:"checkbox",id:"chkFill",checked:!0,handler:function(){selectLayer.setVisibility(Ext.getCmp("chkFill").checked),fillOn=Ext.getCmp("chkFill").checked,updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Opacity",id:"opacityLabel",items:[{xtype:"gx_opacityslider",id:"opacitySlider",layer:dataLayer,changeVisibility:!0,aggressive:!0,vertical:!1,width:120,x:15,y:150,plugins:new GeoExt.LayerOpacitySliderTip},{xtype:"textfield",id:"blah",width:0,hidden:!0}]},{xtype:"compositefield",fieldLabel:"Marginality Layer",id:"margLayerLabel",items:[{xtype:"checkbox",id:"chkMarginality",checked:!1,disabled:!0,handler:function(){marginalityLayer.setVisibility(Ext.getCmp("chkMarginality").checked),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Base map type",id:"basemapLabel",items:[{xtype:"combo",id:"basemapCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:120,queryMode:"local",value:"Google Physical",store:[[0,"None"],[1,"Google Physical"],[2,"Google Hybrid"],[3,"Google Satelitte"],[4,"OpenStreetMap"],[5,"Forest Change(2000-2012)"]],listeners:{select:function(a,b,c){gphy.setVisibility(1==c),ghyb.setVisibility(2==c),gsat.setVisibility(3==c),gosm.setVisibility(4==c),ghan.setVisibility(5==c),gosmActive=4==c,ghanActive=5==c,updateOnZoom(app.mapPanel.map.getZoom()),updateStyling()}}}]},{xtype:"compositefield",fieldLabel:"Show Scale",id:"showScaleLabel",items:[{xtype:"checkbox",id:"chkScale",checked:!0,handler:function(){Ext.getCmp("chkScale").checked||app.mapPanel.map.removeControl(scaleControl),Ext.getCmp("chkScale").checked&&app.mapPanel.map.addControl(scaleControl=new OpenLayers.Control.ScaleLine({maxWidth:400}))}}]},{xtype:"compositefield",fieldLabel:"Pan/Zoom Tool",id:"panZoomLabel",items:[{xtype:"checkbox",id:"chkPanZoom",checked:!0,handler:function(){Ext.getCmp("chkPanZoom").checked||app.mapPanel.map.removeControl(panzoomControl),Ext.getCmp("chkPanZoom").checked&&app.mapPanel.map.addControl(panzoomControl=new OpenLayers.Control.PanZoom)}}]}]},colorByAttributePanel=new Ext.Panel({id:"colorByAttributePanel",title:"TARGETING DATA",collapsible:!0,titleCollapse:!0,layout:"form",labelWidth:80,bodyStyle:"padding: 3;",items:[{xtype:"panel",id:"lowColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 0px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Low Color</div>',items:[{xtype:"colorpalette",id:"lowColorPicker",color:"blue",handler:function(a,b){lowColor=b,Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Low Color</div>'),2==curLanguage&&Ext.getCmp("lowColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+lowColor+'; font-weight: bold">Color Bajo</div>'),Ext.getCmp("lowColorPanel").collapse(),Ext.getCmp("highColorPanel").expand(),updateStyling()}}]},{xtype:"panel",id:"highColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding:0px 0px 10px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">High Color</div>',items:[{xtype:"colorpalette",id:"highColorPicker",color:"red",handler:function(a,b){highColor=b,Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">High Color</div>'),2==curLanguage&&Ext.getCmp("highColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+highColor+'; font-weight: bold">Color Alto</div>'),Ext.getCmp("highColorPanel").collapse(),Ext.getCmp("attribute").expand(),updateStyling()}}]},{xtype:"compositefield",fieldLabel:"Method",id:"methodLabel",items:[{xtype:"combo",id:"methodCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",width:120,queryMode:"local",value:"Interpolate",store:[[0,"Interpolate"],[1,"Quantiles"]],listeners:{select:function(a,b,c){updateStyling(),Ext.getCmp("numQuantiles").setDisabled(0==c)}}}]},{xtype:"compositefield",fieldLabel:"# Quantiles",id:"quantilesLabel",disabled:!0,items:[{xtype:"numberfield",id:"numQuantiles",width:40,value:"3",listeners:{change:function(){updateStyling()}}}]},new Ext.grid.GridPanel({id:"colorAttribute",title:"Variables",store:prioritizationVariables,cm:new Ext.grid.ColumnModel([{id:"displayName",dataIndex:"displayName",sortable:!0}]),sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),autoExpandColumn:"displayName",height:200})],bbar:[{id:"updatedatavis",hidden:!0,text:"<div style='color:green; font-weight: bold;font-size: 12'>Update Data Visualization</div>",cls:"boldbutton",icon:"images/refresh.gif",handler:function(){colorSchemeOn=!0,updateStyling()}},"->",{id:"cleardatavis",text:"<div style='color:black;font-size: 12'>Clear</div>",icon:"images/clear.gif",handler:function(){colorSchemeOn=!1,updateStyling()}}]});Ext.getCmp("colorAttribute").on("rowclick",function(){colorSchemeOn=!0,updateStyling()},this);var selectPanel=new Ext.Panel({xtype:"panel",id:"selectPanel",title:"TARGET",layout:"form",layoutConfig:{multi:!0},collapsible:!0,collapsed:!1,titleCollapse:!0,bodyStyle:"padding: 3;",items:[{xtype:"fieldset",id:"priorityBudget",title:"Choose Budget",collapsible:!1,items:[{layout:"hbox",unstyled:!0,items:[{xtype:"radio",id:"percentageRadio",checked:!0,boxLabel:"Percentage of total:",listeners:{check:function(a,b){b&&(Ext.getCmp("rawRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!1),Ext.getCmp("budget_raw").setDisabled(!0))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"budget_percentage",width:30,value:"10"},{xtype:"spacer",width:3},{xtype:"label",text:"(%)"}]},{layout:"hbox",unstyled:!0,style:"padding:10px 0px 0px 0px",items:[{xtype:"radio",id:"rawRadio",boxLabel:"Raw budget:",listeners:{check:function(a,b){b&&(Ext.getCmp("percentageRadio").setValue(!1),Ext.getCmp("budget_percentage").setDisabled(!0),Ext.getCmp("budget_raw").setDisabled(!1))}}},{xtype:"spacer",width:3},{xtype:"numberfield",id:"budget_raw",width:67,value:"10000000",disabled:!0},{xtype:"spacer",width:3},{xtype:"label",id:"currencyLabel",text:"($)"}]}]},{xtype:"tabpanel",id:"benefitTabPanel",activeTab:0,plain:!0,items:[{id:"combineTab",title:"Weight Benefits",padding:5,autoHeight:!0,items:[{layout:"auto",unstyled:!0,items:[{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"carbonweightfield",fieldLabel:'<div style="color: green; font-weight: bold">Carbon:</div>',labelSeparator:"",items:[{xtype:"numberfield",id:"weight1",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(0,100*Ext.getCmp("weight1").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"bioweightfield",fieldLabel:'<div style="color: red; font-weight: bold">Biodiversity:</div>',labelSeparator:"",items:[{xtype:"numberfield",id:"weight2",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,Ext.getCmp("weightMultiSlider").getValues()[0]+100*Ext.getCmp("weight2").value)}}}]}]},{layout:"form",unstyled:!0,items:[{xtype:"spacer",width:17},{xtype:"compositefield",id:"hydroweightfield",fieldLabel:'<div style="color: blue; font-weight: bold">Hydrological:</div>',labelSeparator:"",items:[{xtype:"numberfield",id:"weight3",width:40,value:".33",listeners:{change:function(){Ext.getCmp("weightMultiSlider").setValue(1,100*(1-Ext.getCmp("weight3").value))}}}]}]}]},new Ext.slider.MultiSlider({id:"weightMultiSlider",values:[33.33,66.67],increment:1,minValue:0,maxValue:100,constrainThumbs:!0,width:215,plugins:[new Ext.ux.slider.Highlight],listeners:{change:function(a){a.getValues()[0]>a.getValues()[1]&&a.setValue(0,a.getValues()[1]),Ext.getCmp("weight1").setValue(a.getValues()[0]/100),Ext.getCmp("weight2").setValue((a.getValues()[1]-a.getValues()[0])/100),Ext.getCmp("weight3").setValue((100-a.getValues()[1])/100)}}}),{xtype:"panel",id:"selectedFillColorPanel",collapsible:!0,collapsed:!0,titleCollapse:!0,style:"padding 0px 0px 10px 0px",title:'<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>',items:[{xtype:"colorpalette",id:"selectedFillColorPicker",color:"blue",handler:function(a,b){selectedFillColor=b,Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Selected Shape Fill Color</div>'),2==curLanguage&&Ext.getCmp("selectedFillColorPanel").setTitle('<center><div style="text-shadow: 2px 2px 8px #000000;color: '+selectedFillColor+'; font-weight: bold">Color de Relleno Seleccionado</div>'),Ext.getCmp("selectedFillColorPanel").collapse(),prioritizationLayer.visibility&&updatePrioritization()}}]}]},{id:"compareTab",title:"Compare",height:100,layout:{type:"hbox",pack:"center",align:"middle"},padding:2,items:[{xtype:"combo",id:"compareObjectiveCombo",selectedIndex:0,allowBlank:!1,editable:!1,triggerAction:"all",queryMode:"local",width:150,value:"All Benefits",store:[[0,"All Benefits"],[1,"Carbon and Biodiversity"],[2,"Carbon and Hydro"],[3,"Biodiversity and Hydro"]],listeners:{select:function(){prioritizationLayer.visibility&&updatePrioritization()}}}]}]},{xtype:"fieldset",id:"priorityOptions",title:"Options",layout:"form",labelWidth:170,collapsible:!1,items:[{xtype:"compositefield",fieldLabel:"Include deforestation risk",id:"chkRiskLabel",items:[{xtype:"checkbox",id:"chkRisk",checked:!0}]},{xtype:"compositefield",fieldLabel:"Include cost",id:"chkCostLabel",items:[{xtype:"checkbox",id:"chkCost",checked:!0}]}]}],bbar:[{id:"submitprioritization",text:"<div style='color:green; font-weight: bold;font-size: 12'>Submit/Update</div>",cls:"boldbutton",icon:"images/submit.gif",handler:function(){prioritizationLayer.setVisibility(!0),updatePrioritization()}},"->",{id:"clearprioritization",text:"<div style='color:black;font-size: 12'>Clear</div>",cls:"boldbutton",icon:"images/clear.gif",handler:function(){prioritizationLayer.setVisibility(!1),updateStyling()}}]}),exportPanel={id:"exportPanel",title:"EXPORT",collapsible:!0,collapsed:!0,titleCollapse:!0,layout:"form",hidden:!0,bodyStyle:"padding: 2;",items:[{xtype:"button",text:"<div style='color:black;font-size: 12'>Export Shapefile</div>",id:"shapefileButton",scale:"medium",icon:"images/download_shp.png",handler:function(){updatePrioritization(),window.location="../../geoserver/forestro_ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=forestro_ws:data_prioritize&viewParams="+priorityParams+"&outputFormat=SHAPE-ZIP"}},{xtype:"button",text:"<div style='color:black;font-size: 12'>Export CSV</div>",id:"csvButton",scale:"medium",icon:"images/download_csv.png",handler:function(){updatePrioritization(),window.location="../../geoserver/forestro_ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=forestro_ws:data_prioritize&viewParams="+priorityParams+"&outputFormat=csv"}}]};toolItems.push(alwaysOpenTopPanel,optionsPanel,regionPanel,colorByAttributePanel,selectPanel,exportPanel);